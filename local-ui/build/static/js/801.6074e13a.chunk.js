"use strict";(self.webpackChunkdss_edge_ui=self.webpackChunkdss_edge_ui||[]).push([[801],{422(e,t,n){n(43),n(579)},647(e,t,n){n.d(t,{Ce:()=>p,LM:()=>h,Td:()=>x,Xj:()=>y,Ze:()=>d,c_:()=>g,ek:()=>v,ff:()=>l,hc:()=>u,hz:()=>m,i7:()=>f,lM:()=>c});var r=n(555),s=n(986),o=(n(43),n(579));const a=["size","color","children","style"],i=e=>{let{size:t=16,color:n="currentColor",children:i,style:c}=e,l=(0,s.A)(e,a);return(0,o.jsx)("svg",(0,r.A)((0,r.A)({width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:(0,r.A)({display:"inline-block",verticalAlign:"middle"},c)},l),{},{children:i}))},c=e=>(0,o.jsxs)(i,(0,r.A)((0,r.A)({},e),{},{children:[(0,o.jsx)("polyline",{points:"3 6 5 6 21 6"}),(0,o.jsx)("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})),l=e=>(0,o.jsxs)(i,(0,r.A)((0,r.A)({},e),{},{children:[(0,o.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,o.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})),d=e=>(0,o.jsxs)(i,(0,r.A)((0,r.A)({},e),{},{children:[(0,o.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,o.jsx)("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})),h=e=>(0,o.jsxs)(i,(0,r.A)((0,r.A)({},e),{},{children:[(0,o.jsx)("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),(0,o.jsx)("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})),u=e=>(0,o.jsxs)(i,(0,r.A)((0,r.A)({},e),{},{children:[(0,o.jsx)("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),(0,o.jsx)("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),(0,o.jsx)("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})),f=e=>(0,o.jsxs)(i,(0,r.A)((0,r.A)({},e),{},{children:[(0,o.jsx)("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),(0,o.jsx)("circle",{cx:"12",cy:"13",r:"4"})]})),p=e=>(0,o.jsxs)(i,(0,r.A)((0,r.A)({},e),{},{children:[(0,o.jsx)("polygon",{points:"23 7 16 12 23 17 23 7"}),(0,o.jsx)("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})]})),x=e=>(0,o.jsxs)(i,(0,r.A)((0,r.A)({},e),{},{children:[(0,o.jsx)("polyline",{points:"21 8 21 21 3 21 3 8"}),(0,o.jsx)("rect",{x:"1",y:"3",width:"22",height:"5"}),(0,o.jsx)("line",{x1:"10",y1:"12",x2:"14",y2:"12"})]})),g=e=>(0,o.jsx)(i,(0,r.A)((0,r.A)({},e),{},{children:(0,o.jsx)("polyline",{points:"9 18 15 12 9 6"})})),m=e=>(0,o.jsx)(i,(0,r.A)((0,r.A)({},e),{},{children:(0,o.jsx)("path",{d:"M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"})})),y=e=>(0,o.jsx)(i,(0,r.A)((0,r.A)({},e),{},{children:(0,o.jsx)("path",{d:"M4 14h6v6M20 10h-6V4M14 10l7-7M3 21l7-7"})})),v=e=>(0,o.jsx)(i,(0,r.A)((0,r.A)({},e),{},{children:(0,o.jsx)("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})}))},768(e,t,n){n.d(t,{Ay:()=>a,nC:()=>o});var r=n(722);let s="";if("undefined"!==typeof window){const e=window.location.href.match(/(\/api\/proxy\/[^\/]+)/);e?s=e[1]:window.location.hash.includes("#/")&&(s="")}const o=r.A.create({baseURL:s}),a=o},801(e,t,n){n.r(t),n.d(t,{default:()=>w});var r=n(555),s=n(43),o=n(768),a=n(216),i=(n(777),n(579));const c="".concat(window.location.origin,"/rtc"),l=new Map;async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sub";const n="".concat(e,"_").concat(t);if(l.has(n)){const e=l.get(n);return e.refs++,console.log("[SmartDual] Reusing ".concat(n,", refs: ").concat(e.refs)),e}console.log("[SmartDual] Creating WebRTC for ".concat(n));const r=new RTCPeerConnection({iceServers:[]}),s=new MediaStream;r.ontrack=e=>{console.log("[SmartDual] Track received for ".concat(n)),s.addTrack(e.track)},r.addTransceiver("video",{direction:"recvonly"});try{const e=await r.createOffer();await r.setLocalDescription(e);const t=await fetch("".concat(c,"/api/webrtc?src=").concat(n),{method:"POST",headers:{"Content-Type":"application/sdp"},body:e.sdp});if(!t.ok)throw new Error("WebRTC failed: ".concat(t.status));const o=await t.text();await r.setRemoteDescription({type:"answer",sdp:o});const a={pc:r,media:s,refs:1};return l.set(n,a),a}catch(o){throw r.close(),o}}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sub";const n="".concat(e,"_").concat(t),r=l.get(n);r&&(r.refs--,console.log("[SmartDual] Released ".concat(n,", refs: ").concat(r.refs)),r.refs<=0&&setTimeout(()=>{const e=l.get(n);e&&e.refs<=0&&(console.log("[SmartDual] Closing idle ".concat(n)),e.pc.close(),l.delete(n))},5e3))}function u(e){let{camId:t,isFullscreen:n,isHidden:o,isHovered:a,style:c}=e;const l=(0,s.useRef)(null),[u,f]=(0,s.useState)(null),[p,x]=(0,s.useState)(null),[g,m]=(0,s.useState)("sub");return(0,s.useEffect)(()=>{if(o||!t)return;let e,r=!0;return d(t,"sub").then(s=>{r?(e=s,f(s),l.current&&!n&&(l.current.srcObject=s.media,l.current.play().catch(()=>{}))):h(t,"sub")}).catch(e=>{console.error("[SmartDual] Error for sub ".concat(t,":"),e)}),()=>{r=!1,e&&h(t,"sub")}},[t,o,n]),(0,s.useEffect)(()=>{let e,r;return n&&!o&&t?d(t,"hd").then(e=>{r=e,x(e),l.current&&(l.current.srcObject=e.media,l.current.play().catch(()=>{}),m("main"))}).catch(e=>console.error("[SmartDual] Error for main ".concat(t,":"),e)):a&&!o&&t&&!n?e=setTimeout(()=>{console.log("[SmartDual] Hover sustained - pre-connecting main for ".concat(t)),d(t,"hd").then(e=>{r=e,x(e)}).catch(e=>console.error("[SmartDual] Error for main ".concat(t,":"),e))},800):!p||n||a||(h(t,"hd"),x(null)),()=>{e&&clearTimeout(e),r&&h(t,"hd")}},[a,n,t,o]),(0,s.useEffect)(()=>{l.current&&(n&&p?(console.log("[SmartDual] Switching to MAIN for ".concat(t)),l.current.srcObject=p.media,l.current.play().catch(()=>{}),m("main")):!n&&u&&(console.log("[SmartDual] Switching to SUB for ".concat(t)),l.current.srcObject=u.media,l.current.play().catch(()=>{}),m("sub")))},[n,u,p,t]),(0,i.jsxs)("div",{style:(0,r.A)((0,r.A)({},c),{},{position:"relative",background:"#000",width:"100%",height:"100%"}),children:[(0,i.jsx)("video",{ref:l,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"fill"}}),!1]})}n(422);var f=n(647);const p={position:"relative",width:"100%",height:"100%",background:"#000",display:"flex",flexDirection:"column",overflow:"hidden",border:"1px solid #333",borderRadius:2},x={background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,255,255,0.2)",color:"rgba(255,255,255,0.9)",borderRadius:4,width:28,height:28,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",marginRight:2};function g(e){let{cam:t}=e;const n=s.useRef(null),r=s.useRef(null),[o,a]=(0,s.useState)({w:0,h:0});return s.useEffect(()=>{const e=new ResizeObserver(e=>{for(const t of e){const{width:e,height:n}=t.contentRect;a({w:Math.round(e),h:Math.round(n)})}});return n.current&&e.observe(n.current),()=>e.disconnect()},[]),s.useEffect(()=>{var e,n;const s=r.current;if(!s||0===o.w)return;const a=s.getContext("2d");a.clearRect(0,0,o.w,o.h);const i=(null===(e=t.ai_server)||void 0===e?void 0:e.zones)||[];0===i.length&&null!==(n=t.ai_server)&&void 0!==n&&n.roi&&i.push({points:t.ai_server.roi});i.forEach(e=>{e.points&&(e=>{if(!e||0===e.length)return;a.beginPath();const t=e[0][0]>1?e[0][0]:e[0][0]*o.w,n=e[0][1]>1?e[0][1]:e[0][1]*o.h;a.moveTo(t,n);for(let r=1;r<e.length;r++){const t=e[r][0]>1?e[r][0]:e[r][0]*o.w,n=e[r][1]>1?e[r][1]:e[r][1]*o.h;a.lineTo(t,n)}a.closePath(),a.fillStyle="rgba(0, 255, 0, 0.15)",a.strokeStyle="#00ff00",a.lineWidth=2,a.fill(),a.stroke()})(e.points)})},[t,o]),(0,i.jsx)("div",{ref:n,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:5},children:(0,i.jsx)("canvas",{ref:r,width:o.w,height:o.h,style:{width:"100%",height:"100%",display:"block",background:"transparent"}})})}function m(e){let{cam:t,isMaximized:n,isHidden:r,onUpdate:o,onMaximise:c,isArmed:l,health:d}=e;const h=(0,a.Zp)(),[m,y]=(0,s.useState)(!1),[v,b]=(0,s.useState)("hd"),[w,j]=(0,s.useState)(null);s.useEffect(()=>{const e=()=>j(null);return window.addEventListener("click",e),()=>window.removeEventListener("click",e)},[]);const k=!1!==t.record,A=!!d&&d.connected;return(0,i.jsxs)("div",{style:p,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),onContextMenu:e=>{e.preventDefault(),j({x:e.pageX,y:e.pageY})},children:[w&&(0,i.jsxs)("div",{style:{position:"fixed",top:w.y,left:w.x,background:"#222",border:"1px solid #444",borderRadius:6,padding:"4px 0",zIndex:1e3,minWidth:160,boxShadow:"0 4px 20px rgba(0,0,0,0.5)"},children:[(0,i.jsxs)("div",{style:{padding:"8px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:8,fontSize:13,color:"#fff"},onMouseEnter:e=>e.target.style.background="#333",onMouseLeave:e=>e.target.style.background="transparent",onClick:()=>h("/settings?tab=hardware&camId=".concat(t.id)),children:[(0,i.jsx)(f.Ze,{size:14,color:"#aaa"})," Set\u0103ri Camer\u0103 (HW)"]}),(0,i.jsxs)("div",{style:{padding:"8px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:8,fontSize:13,color:"#fff"},onMouseEnter:e=>e.target.style.background="#333",onMouseLeave:e=>e.target.style.background="transparent",onClick:()=>h("/settings?tab=channels&camId=".concat(t.id)),children:[(0,i.jsx)(f.Ce,{size:14,color:"#aaa"})," Set\u0103ri Canal (AI)"]})]}),(0,i.jsxs)("div",{style:{flex:1,position:"relative",background:"#000",cursor:"pointer",width:"100%"},onClick:()=>!n&&c(t),children:[(0,i.jsx)(u,{camId:t.id,isFullscreen:n,isHovered:m,isHidden:r,style:{width:"100%",height:"100%"}}),l&&(0,i.jsx)(g,{cam:t}),(0,i.jsxs)("div",{style:{position:"absolute",bottom:0,left:0,right:0,padding:8,display:"flex",justifyContent:"space-between",alignItems:"flex-end",opacity:m||n?1:0,transition:"opacity 0.2s",pointerEvents:m||n?"auto":"none",zIndex:10},children:[(0,i.jsx)("div",{style:{display:"flex",gap:4},children:(0,i.jsx)("button",{style:x,title:"View Archive / Playback",onClick:e=>{e.stopPropagation(),h("/playback?camId=".concat(t.id))},children:(0,i.jsx)(f.Td,{size:14})})}),(0,i.jsx)("div",{style:{display:"flex",gap:4},children:(0,i.jsx)("button",{style:x,title:n?"Minimize":"Maximize",onClick:e=>{null===e||void 0===e||e.stopPropagation(),c(t)},children:n?(0,i.jsx)(f.Xj,{size:14}):(0,i.jsx)(f.hz,{size:14})})})]})]}),(0,i.jsxs)("div",{style:{height:32,background:l?"rgba(0, 230, 118, 0.1)":"#111",borderTop:"1px solid #333",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 8px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1,overflow:"hidden"},children:[(0,i.jsx)("div",{style:{width:10,height:10,borderRadius:"50%",background:A?"#00e676":"#f44336",boxShadow:A?"0 0 8px #00e676":"none"}}),(0,i.jsx)("div",{title:l?"Armed (AI ON)":"Disarmed (AI OFF)",children:(0,i.jsx)(f.ek,{size:16,color:l?"#00e676":"#555",fill:l?"rgba(0,230,118,0.2)":"none"})}),(0,i.jsx)("span",{style:{fontSize:13,fontWeight:"600",color:l?"#fff":"#aaa",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.name||t.ip}),k&&(0,i.jsx)("div",{style:{width:6,height:6,borderRadius:"50%",background:"#f44336",animation:"pulse 1.5s infinite"},title:"Recording"})]}),(0,i.jsx)("div",{style:{fontSize:9,color:"#444",fontWeight:"bold",letterSpacing:.5},children:n?"MAIN STREAM":"SUB STREAM"})]}),(0,i.jsx)("style",{children:"\n                @keyframes pulse {\n                    0% { opacity: 1; transform: scale(1); }\n                    50% { opacity: 0.5; transform: scale(1.2); }\n                    100% { opacity: 1; transform: scale(1); }\n                }\n            "})]})}const y=s.memo(m);var v=n(28);const b="#cccccc";function w(){const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)("Checking..."),[c,l]=(0,s.useState)(null),[d,h]=(0,s.useState)(8),[u,f]=(0,s.useState)({}),[p,x]=(0,s.useState)({});(0,s.useEffect)(()=>{const e=()=>{o.nC.get("arming/debug").then(e=>{const t={};e.data&&e.data.cameras&&e.data.cameras.forEach(e=>t[e.id]=e.isArmed),f(t)}).catch(()=>{})};e();const t=setInterval(e,5e3);return()=>clearInterval(t)},[]),(0,s.useEffect)(()=>{const e=()=>o.nC.get("cameras/config").then(e=>t(e.data)).catch(console.error);e();const n=()=>{o.nC.get("status").then(e=>{var t;const n=!0===e.data.online||"Connected"===e.data.status||(null===(t=e.data.system)||void 0===t?void 0:t.uptime)>0;if(a(n?"Connected":"Disconnected"),e.data.cameras){const t={};e.data.cameras.forEach(e=>t[e.id]=(0,r.A)((0,r.A)({},e),{},{connected:"ONLINE"===e.status})),x(t)}}).catch(()=>a("Disconnected"))};n();const s=setInterval(e,1e4),i=setInterval(n,3e3);return()=>{clearInterval(s),clearInterval(i)}},[]);const[g,m]=(0,s.useState)(new Date),[w,j]=(0,s.useState)(null);(0,s.useEffect)(()=>{o.nC.get("/system/time").then(e=>{var t,n;null!==(t=e.data)&&void 0!==t&&null!==(n=t.raw)&&void 0!==n&&n["Time zone"]&&j(e.data.raw["Time zone"].split(" ")[0])}).catch(()=>{});const e=setInterval(()=>m(new Date),1e3);return()=>clearInterval(e)},[]);const k=async(n,s)=>{const a=e.map(e=>e.id===n?(0,r.A)((0,r.A)({},e),s):e);t(a);try{await o.nC.post("cameras/config",a)}catch(i){console.error(i)}},A=(()=>{if(c)return{cols:"1fr",rows:"1fr"};switch(d){case 1:return{cols:"1fr",rows:"1fr"};case 4:return{cols:"repeat(2, 1fr)",rows:"repeat(2, 1fr)"};case 6:return{cols:"repeat(3, 1fr)",rows:"repeat(2, 1fr)"};case 8:return{cols:"repeat(4, 1fr)",rows:"repeat(2, 1fr)"};case 9:return{cols:"repeat(3, 1fr)",rows:"repeat(3, 1fr)"};case 16:return{cols:"repeat(4, 1fr)",rows:"repeat(4, 1fr)"};case 24:return{cols:"repeat(6, 1fr)",rows:"repeat(4, 1fr)"};case 25:return{cols:"repeat(5, 1fr)",rows:"repeat(5, 1fr)"};case 32:return{cols:"repeat(8, 1fr)",rows:"repeat(4, 1fr)"};default:const e=Math.ceil(Math.sqrt(d)),t=Math.ceil(d/e);return{cols:"repeat(".concat(e,", 1fr)"),rows:"repeat(".concat(t,", 1fr)")}}})(),S=c?1:d;return(0,i.jsxs)("div",{className:"live-page",style:{width:"100%",height:"100%",background:"#0d0d0d",color:b,overflow:"hidden",display:"flex",flexDirection:"column"},children:[!c&&(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 8px",background:"#1a1a1a",borderBottom:"1px solid #333",height:"32px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:15},children:[(0,i.jsxs)("div",{style:{fontWeight:"bold",fontSize:13,color:"#fff",display:"flex",alignItems:"center",gap:5},children:[(0,i.jsx)("div",{style:{width:8,height:8,borderRadius:"50%",background:"Connected"===n?"#4caf50":"#f44336"}}),"LIVE VIEW"]}),(0,i.jsx)("div",{style:{display:"flex",gap:1},children:[1,4,6,8,9,12,16,24,32].map(e=>(0,i.jsx)("button",{onClick:()=>h(e),style:{border:"none",background:d===e?"#007acc":"#333",color:"#fff",width:26,height:20,cursor:"pointer",fontSize:10,fontWeight:d===e?"bold":"normal",marginRight:1},children:e},e))})]}),(0,i.jsx)("div",{style:{fontSize:11,color:"#666"},children:(e=>{if(!e)return"";return function(e,t){if(!e)return"--:--:--";const n=t?{zone:t}:{};return v.c9.fromMillis(e,n).toFormat("HH:mm:ss")}(e instanceof Date?e.getTime():e,w)})(g)})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:A.cols,gridTemplateRows:A.rows,gap:c?0:2,flex:1,background:"#000",padding:c?0:2,overflow:"hidden"},children:[e.map((e,t)=>{const n=c?e.id===c.id:t<S;return(0,i.jsx)("div",{style:{display:n?"flex":"none",flexDirection:"column",position:"relative",width:"100%",height:"100%",background:"#000",overflow:"hidden",border:"none",padding:0},onDoubleClick:()=>l(c?null:e),children:(0,i.jsx)(y,{cam:e,isMaximized:c&&c.id===e.id,isHidden:!n,onUpdate:k,onMaximise:()=>l(e),isArmed:u[e.id],health:p[e.id]})},e.id)}),!c&&Array.from({length:Math.max(0,S-e.length)}).map((e,t)=>(0,i.jsx)("div",{style:{background:"#111",border:"1px dashed #333",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)("span",{style:{color:"#333",fontSize:10},children:"NO SIGNAL"})},"empty-".concat(t)))]}),(0,i.jsx)("style",{children:"\n                /* Robust Absolute Positioning for Video */\n                .camera-card-container {\n                    position: relative;\n                    width: 100%;\n                    height: 100%;\n                    overflow: hidden;\n                }\n                video, img, canvas, video-stream-mse {\n                    position: absolute !important;\n                    top: 0; left: 0;\n                    width: 100% !important; \n                    height: 100% !important;\n                    object-fit: contain !important;\n                    background: #000;\n                    border: none !important;\n                }\n                \n                /* Scrollbar hide */\n                ::-webkit-scrollbar { width: 6px; height: 6px; }\n                ::-webkit-scrollbar-track { background: #111; }\n                ::-webkit-scrollbar-thumb { background: #333; }\n            "})]})}}}]);
//# sourceMappingURL=801.6074e13a.chunk.js.map