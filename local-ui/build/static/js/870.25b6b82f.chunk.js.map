{"version":3,"file":"static/js/870.25b6b82f.chunk.js","mappings":"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","sources":["api.js","pages/Playback.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\n// Use relative path or detect Proxy base\r\nlet baseURL = \"\";\r\nif (typeof window !== 'undefined') {\r\n    // Check for proxy in full URL (HashRouter compatibility)\r\n    const match = window.location.href.match(/(\\/api\\/proxy\\/[^\\/]+)/);\r\n    if (match) {\r\n        baseURL = match[1];\r\n    } else if (window.location.hash.includes(\"#/\")) {\r\n        // Fallback for local dev or direct access\r\n        baseURL = \"\";\r\n    }\r\n}\r\n\r\nconst API = axios.create({\r\n    baseURL: baseURL\r\n});\r\n\r\nexport { API, baseURL };\r\nexport default API;\r\n","import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport API from '../api';\r\n\r\nconst DAY_MS = 86400000;\r\nconst HOUR_MS = 3600000;\r\nconst MIN_MS = 60000;\r\n\r\nconst Playback = () => {\r\n    // 0. URL PARAMS\r\n    const urlParams = new URLSearchParams(window.location.hash.split('?')[1]);\r\n    const initCam = urlParams.get('camId');\r\n\r\n    // STATE\r\n    const [cameras, setCameras] = useState([]);\r\n    const [camId, setCamId] = useState(initCam || '');\r\n    const [timelineSegments, setTimelineSegments] = useState([]);\r\n    const [serverDayStart, setServerDayStart] = useState(0);\r\n    const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [stats, setStats] = useState({ first: null, last: null });\r\n\r\n    // TIMELINE UI STATE\r\n    const [zoom, setZoom] = useState(1); // 1 = 24h visible\r\n    const [offsetMs, setOffsetMs] = useState(0); // Offset in ms from dayStart\r\n    const [playheadMs, setPlayheadMs] = useState(null); // Relative to dayStart\r\n    const [seekInfo, setSeekInfo] = useState(null); // For displaying \"Seeking to: ...\"\r\n\r\n    // REFS\r\n    const videoRef = useRef(null);\r\n    const canvasRef = useRef(null);\r\n    const lastSeekBaseTs = useRef(0); // Store start_ts of the segment we seeked to\r\n\r\n    // 1. LOAD CAMERAS\r\n    useEffect(() => {\r\n        API.get('/cameras').then(res => {\r\n            setCameras(res.data);\r\n            if (!camId && res.data.length > 0) setCamId(res.data[0].id);\r\n        }).catch(err => console.error(\"Cameras load error\", err));\r\n    }, [camId]);\r\n\r\n    // 1.5. LOAD STATS\r\n    useEffect(() => {\r\n        if (!camId) return;\r\n        API.get(`/playback/stats/${camId}?_t=${Date.now()}`)\r\n            .then(res => setStats(res.data))\r\n            .catch(console.error);\r\n    }, [camId]);\r\n\r\n    // 2. LOAD SEGMENTS\r\n    useEffect(() => {\r\n        if (!camId) return;\r\n        API.get(`/playback/timeline-day/${camId}/${selectedDate}?_ts=${Date.now()}`)\r\n            .then(res => {\r\n                const { segments, dayStart } = res.data;\r\n                setServerDayStart(dayStart);\r\n                setTimelineSegments(segments || []);\r\n                // Reset timeline on date change\r\n                setOffsetMs(0);\r\n                setZoom(1);\r\n            })\r\n            .catch(err => console.error(\"Timeline error\", err));\r\n    }, [camId, selectedDate]);\r\n\r\n    // 3. UTILS FOR CANVAS\r\n    const timeToX = (ms, width) => {\r\n        const visibleMs = DAY_MS / zoom;\r\n        return ((ms - offsetMs) / visibleMs) * width;\r\n    };\r\n\r\n    const xToTime = (x, width) => {\r\n        const visibleMs = DAY_MS / zoom;\r\n        return offsetMs + (x / width) * visibleMs;\r\n    };\r\n\r\n    const formatTime = (ms) => {\r\n        const totalSeconds = Math.floor(ms / 1000);\r\n        const h = Math.floor(totalSeconds / 3600);\r\n        const m = Math.floor((totalSeconds % 3600) / 60);\r\n        const s = totalSeconds % 60;\r\n        return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    // 4. DRAW TIMELINE\r\n    const draw = useCallback(() => {\r\n        const canvas = canvasRef.current;\r\n        if (!canvas || !serverDayStart) return;\r\n\r\n        const ctx = canvas.getContext('2d');\r\n        const width = canvas.width;\r\n        const height = canvas.height;\r\n        const visibleMs = DAY_MS / zoom;\r\n\r\n        // Clear\r\n        ctx.fillStyle = '#111';\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        // --- GRID ---\r\n        let step;\r\n        if (visibleMs > 12 * HOUR_MS) step = HOUR_MS;\r\n        else if (visibleMs > 3 * HOUR_MS) step = 30 * MIN_MS;\r\n        else if (visibleMs > 1 * HOUR_MS) step = 10 * MIN_MS;\r\n        else step = 1 * MIN_MS;\r\n\r\n        ctx.lineWidth = 1;\r\n        for (let t = Math.floor(offsetMs / step) * step; t < offsetMs + visibleMs; t += step) {\r\n            const x = timeToX(t, width);\r\n            if (x < 0 || x > width) continue;\r\n\r\n            ctx.strokeStyle = '#333';\r\n            ctx.beginPath();\r\n            ctx.moveTo(x, 0);\r\n            ctx.lineTo(x, height);\r\n            ctx.stroke();\r\n\r\n            // Label\r\n            if (t % HOUR_MS === 0 || visibleMs < 4 * HOUR_MS) {\r\n                ctx.fillStyle = '#888';\r\n                ctx.font = '10px Arial';\r\n                const h = Math.floor(t / HOUR_MS);\r\n                const m = Math.floor((t % HOUR_MS) / MIN_MS);\r\n                if (t >= 0 && t <= DAY_MS) {\r\n                    ctx.fillText(`${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`, x + 2, 12);\r\n                }\r\n            }\r\n        }\r\n\r\n        // --- SEGMENTS (Green) ---\r\n        ctx.fillStyle = '#2ecc71';\r\n        timelineSegments.forEach(s => {\r\n            const sStart = Number(s.start_ts) - serverDayStart;\r\n            const sEnd = (s.end_ts === 0 ? Date.now() : Number(s.end_ts)) - serverDayStart;\r\n\r\n            const x1 = timeToX(sStart, width);\r\n            const x2 = timeToX(sEnd, width);\r\n            const w = Math.max(x2 - x1, 1);\r\n\r\n            if (x1 + w < 0 || x1 > width) return;\r\n            ctx.fillRect(x1, 25, w, 25);\r\n        });\r\n\r\n        // --- PLAYHEAD (Red) ---\r\n        if (playheadMs !== null) {\r\n            const px = timeToX(playheadMs, width);\r\n            if (px >= 0 && px <= width) {\r\n                ctx.strokeStyle = 'red';\r\n                ctx.lineWidth = 2;\r\n                ctx.beginPath();\r\n                ctx.moveTo(px, 0);\r\n                ctx.lineTo(px, height);\r\n                ctx.stroke();\r\n\r\n                // Little triangle at top\r\n                ctx.fillStyle = 'red';\r\n                ctx.beginPath();\r\n                ctx.moveTo(px - 5, 0);\r\n                ctx.lineTo(px + 5, 0);\r\n                ctx.lineTo(px, 8);\r\n                ctx.fill();\r\n            }\r\n        }\r\n    }, [timelineSegments, serverDayStart, zoom, offsetMs, playheadMs]);\r\n\r\n    useEffect(() => {\r\n        draw();\r\n    }, [draw]);\r\n\r\n    // 5. UPDATE PLAYHEAD FROM VIDEO\r\n    useEffect(() => {\r\n        const interval = setInterval(() => {\r\n            if (videoRef.current && !videoRef.current.paused && lastSeekBaseTs.current > 0) {\r\n                const currentAbsoluteTs = lastSeekBaseTs.current + (videoRef.current.currentTime * 1000);\r\n                const relativeMs = currentAbsoluteTs - serverDayStart;\r\n                setPlayheadMs(relativeMs);\r\n            }\r\n        }, 500);\r\n        return () => clearInterval(interval);\r\n    }, [serverDayStart]);\r\n\r\n    // 6. ZOOM HANDLER\r\n    const handleWheel = (e) => {\r\n        e.preventDefault();\r\n        const canvas = canvasRef.current;\r\n        const rect = canvas.getBoundingClientRect();\r\n        const mouseX = e.clientX - rect.left;\r\n        const mouseTime = xToTime(mouseX, rect.width);\r\n\r\n        const delta = e.deltaY > 0 ? 1.2 : 0.8;\r\n        let newZoom = Math.min(100, Math.max(1, zoom * (e.deltaY > 0 ? 0.8 : 1.2)));\r\n\r\n        const newVisibleMs = DAY_MS / newZoom;\r\n        let newOffset = mouseTime - (mouseX / rect.width) * newVisibleMs;\r\n\r\n        // Clamping\r\n        newOffset = Math.max(-newVisibleMs * 0.1, Math.min(DAY_MS - newVisibleMs * 0.9, newOffset));\r\n\r\n        setZoom(newZoom);\r\n        setOffsetMs(newOffset);\r\n    };\r\n\r\n    // 7. CLICK HANDLER\r\n    const handleCanvasClick = (e) => {\r\n        if (!serverDayStart) return;\r\n        const canvas = canvasRef.current;\r\n        const rect = canvas.getBoundingClientRect();\r\n        const x = e.clientX - rect.left;\r\n        const clickedRelativeMs = xToTime(x, rect.width);\r\n        const absoluteTs = Math.floor(serverDayStart + clickedRelativeMs);\r\n\r\n        setPlayheadMs(clickedRelativeMs);\r\n        setSeekInfo(`Seeking to: ${selectedDate} ${formatTime(clickedRelativeMs)}`);\r\n\r\n        loadPlayback(absoluteTs);\r\n    };\r\n\r\n    const loadPlayback = (ts) => {\r\n        if (videoRef.current) {\r\n            const url = `${API.defaults.baseURL}/playback/stream/${camId}?ts=${ts}&_nocache=${Date.now()}`;\r\n            console.log(`[Player] Loading: ${url}`);\r\n\r\n            // We need to know which segment we started from to track playhead accurately\r\n            // For now, assume the seek timestamp is the base\r\n            lastSeekBaseTs.current = ts;\r\n\r\n            videoRef.current.src = url;\r\n            videoRef.current.load();\r\n            videoRef.current.play().catch(e => console.error(\"Play error:\", e));\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"playback-page\" style={{ padding: 20, background: '#1a1a1a', color: '#eee', minHeight: '100vh' }}>\r\n            {/* TOOLBAR */}\r\n            <div style={{ marginBottom: 15, display: 'flex', gap: 15, alignItems: 'center', flexWrap: 'wrap' }}>\r\n                <div style={{ display: 'flex', flexDirection: 'column' }}>\r\n                    <label style={{ fontSize: 11, color: '#888' }}>Camera</label>\r\n                    <select\r\n                        value={camId}\r\n                        onChange={e => setCamId(e.target.value)}\r\n                        style={{ padding: '6px 10px', background: '#333', color: '#fff', border: '1px solid #555', borderRadius: 4 }}\r\n                    >\r\n                        {cameras.map(c => <option key={c.id} value={c.id}>{c.name || c.ip}</option>)}\r\n                    </select>\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', flexDirection: 'column' }}>\r\n                    <label style={{ fontSize: 11, color: '#888' }}>Date</label>\r\n                    <input\r\n                        type=\"date\"\r\n                        value={selectedDate}\r\n                        onChange={e => setSelectedDate(e.target.value)}\r\n                        style={{ padding: '5px 10px', background: '#333', color: '#fff', border: '1px solid #555', borderRadius: 4 }}\r\n                    />\r\n                </div>\r\n\r\n                <button\r\n                    onClick={() => window.location.reload()}\r\n                    style={{\r\n                        marginTop: 15,\r\n                        padding: '7px 15px',\r\n                        cursor: 'pointer',\r\n                        background: '#2ecc71',\r\n                        color: '#000',\r\n                        border: 'none',\r\n                        borderRadius: 4,\r\n                        fontWeight: 'bold'\r\n                    }}\r\n                >\r\n                    Refresh\r\n                </button>\r\n\r\n                <div style={{ flex: 1 }}></div>\r\n\r\n                {seekInfo && (\r\n                    <div style={{ color: '#f1c40f', fontWeight: 'bold', fontSize: 14, background: 'rgba(0,0,0,0.3)', padding: '5px 15px', borderRadius: 20 }}>\r\n                        {seekInfo}\r\n                    </div>\r\n                )}\r\n\r\n                {stats.first && stats.first > 1700000000000 && (\r\n                    <div style={{ fontSize: 12, color: '#2ecc71', textAlign: 'right' }}>\r\n                        <div>Archive range:</div>\r\n                        <div style={{ fontWeight: 'bold' }}>\r\n                            {new Date(stats.first).toLocaleString()} - {new Date(stats.last).toLocaleString()}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* PLAYER */}\r\n            <div className=\"video-container\" style={{ background: '#000', borderRadius: 8, overflow: 'hidden', boxShadow: '0 10px 30px rgba(0,0,0,0.5)', width: '100%', height: '65vh', marginBottom: 15 }}>\r\n                <video\r\n                    ref={videoRef}\r\n                    id=\"player\"\r\n                    controls\r\n                    autoPlay\r\n                    style={{ width: '100%', height: '100%' }}\r\n                    onError={(e) => console.error(\"Video element error:\", e)}\r\n                />\r\n            </div>\r\n\r\n            {/* TIMELINE */}\r\n            <div\r\n                className=\"timeline-container\"\r\n                style={{\r\n                    width: '100%',\r\n                    height: 80,\r\n                    position: 'relative',\r\n                    border: '1px solid #333',\r\n                    borderRadius: 4,\r\n                    overflow: 'hidden'\r\n                }}\r\n            >\r\n                <canvas\r\n                    ref={canvasRef}\r\n                    id=\"timeline\"\r\n                    width={2000}\r\n                    height={80}\r\n                    style={{ width: '100%', height: '100%', cursor: 'crosshair' }}\r\n                    onClick={handleCanvasClick}\r\n                    onWheel={handleWheel}\r\n                />\r\n            </div>\r\n\r\n            <div style={{ marginTop: 10, display: 'flex', justifyContent: 'space-between', color: '#666', fontSize: 11 }}>\r\n                <div>* Use mouse wheel to ZOOM. Click to SEEK.</div>\r\n                <div>Zoom: {zoom.toFixed(1)}x</div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Playback;\r\n"],"names":["baseURL","window","match","location","href","hash","includes","API","axios","create","DAY_MS","HOUR_MS","MIN_MS","Playback","initCam","URLSearchParams","split","get","cameras","setCameras","useState","camId","setCamId","timelineSegments","setTimelineSegments","serverDayStart","setServerDayStart","selectedDate","setSelectedDate","Date","toISOString","stats","setStats","first","last","zoom","setZoom","offsetMs","setOffsetMs","playheadMs","setPlayheadMs","seekInfo","setSeekInfo","videoRef","useRef","canvasRef","lastSeekBaseTs","useEffect","then","res","data","length","id","catch","err","console","error","concat","now","segments","dayStart","timeToX","ms","width","xToTime","x","draw","useCallback","canvas","current","ctx","getContext","height","visibleMs","step","fillStyle","fillRect","lineWidth","t","Math","floor","strokeStyle","beginPath","moveTo","lineTo","stroke","font","h","m","fillText","String","padStart","forEach","s","sStart","Number","start_ts","sEnd","end_ts","x1","x2","w","max","px","fill","interval","setInterval","paused","currentAbsoluteTs","currentTime","clearInterval","loadPlayback","ts","url","defaults","log","src","load","play","e","_jsxs","className","style","padding","background","color","minHeight","children","marginBottom","display","gap","alignItems","flexWrap","flexDirection","_jsx","fontSize","value","onChange","target","border","borderRadius","map","c","name","ip","type","onClick","reload","marginTop","cursor","fontWeight","flex","textAlign","toLocaleString","overflow","boxShadow","ref","controls","autoPlay","onError","position","rect","getBoundingClientRect","clientX","left","clickedRelativeMs","absoluteTs","totalSeconds","toString","formatTime","onWheel","preventDefault","mouseX","mouseTime","deltaY","newZoom","min","newVisibleMs","newOffset","justifyContent","toFixed"],"ignoreList":[],"sourceRoot":""}