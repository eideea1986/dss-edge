{"ast":null,"code":"import React,{useEffect,useState,useRef,useCallback}from\"react\";import{useSearchParams}from\"react-router-dom\";import API from\"../api\";import Hls from'hls.js';/* STYLES */import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const styles=\"\\n* { box-sizing: border-box; margin: 0; padding: 0; }\\nbody { background: #1a1a1a; color: #ccc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }\\n.playback-page { height: 100vh; display: flex; flex-direction: column; background: #1a1a1a; }\\n\\n/* HEADER */\\n.playback-header { \\n    height: 48px; background: #111; border-bottom: 1px solid #333; \\n    display: flex; align-items: center; padding: 0 16px; gap: 16px; \\n}\\n.header-title { font-size: 14px; font-weight: 600; color: #fff; margin-right: auto; }\\n.date-selector { \\n    background: #222; border: 1px solid #444; color: #fff; \\n    padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 13px;\\n    display: flex; align-items: center; gap: 8px;\\n}\\n.date-selector:hover { background: #333; border-color: #666; }\\n\\n/* CALENDAR POPUP */\\n.calendar-popup {\\n    position: absolute; top: 50px; left: 50%; transform: translateX(-50%);\\n    width: 280px; background: #222; border: 1px solid #555; border-radius: 6px;\\n    box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 2000;\\n    padding: 10px;\\n}\\n.cal-header { display: flex; justify-content: space-between; margin-bottom: 10px; color: #fff; }\\n.cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }\\n.cal-day { \\n    height: 30px; display: flex; align-items: center; justify-content: center; \\n    font-size: 12px; border-radius: 3px; cursor: default; color: #555;\\n}\\n.cal-day.has-data { \\n    color: #4da6ff; font-weight: bold; cursor: pointer; background: rgba(77, 166, 255, 0.1); \\n}\\n.cal-day.has-data:hover { background: #4da6ff; color: #000; }\\n.cal-day.selected { background: #fff; color: #000; border: 1px solid #4da6ff; }\\n.cal-btn { background: none; border: none; color: #aaa; cursor: pointer; }\\n.cal-btn:hover { color: #fff; }\\n\\n/* VIDEO */\\n.video-viewport { flex: 1; background: #000; position: relative; display:flex; align-items:center; justify-content:center; }\\nvideo { width: 100%; height: 100%; object-fit: contain; }\\n\\n/* CONTROLS & TIMELINE */\\n.timeline-area { height: 100px; background: #0f0f0f; border-top: 1px solid #333; position: relative; user-select: none; cursor: crosshair; }\\n.time-ticks { position: absolute; top: 0; width: 100%; height: 20px; display: flex; pointer-events: none; }\\n.tick { flex: 1; border-left: 1px solid #333; font-size: 10px; color: #666; padding-left: 2px; }\\n.segments-track { position: absolute; top: 25px; bottom: 0; width: 100%; background: rgba(255,255,255,0.01); }\\n.segment { position: absolute; top: 5px; height: 30px; background: #1f9d55; min-width: 2px; opacity: 0.9; }\\n.playhead { position: absolute; top: 0; bottom: 0; width: 2px; background: #f00; z-index: 50; pointer-events: none; }\\n.controls { height: 40px; background: #111; display: flex; align-items: center; gap: 10px; padding: 0 10px; border-top: 1px solid #222; }\\n.btn { background: #333; color: #eee; border: 1px solid #444; padding: 4px 12px; cursor: pointer; font-size: 12px; }\\n.btn:hover { background: #444; }\\n.btn-primary { background: #0055aa; border-color: #004488; }\\n.backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; }\\n\";export default function Playback(){const[params]=useSearchParams();const camId=params.get(\"camId\");const[selectedDate,setSelectedDate]=useState(()=>{const d=new Date();const offset=d.getTimezoneOffset()*60000;return new Date(d.getTime()-offset).toISOString().split('T')[0];});const[timelineSegments,setTimelineSegments]=useState([]);const[serverDayStart,setServerDayStart]=useState(0);const[isPlaying,setIsPlaying]=useState(false);// Calendar State\nconst[showCal,setShowCal]=useState(false);const[calYear,setCalYear]=useState(new Date().getFullYear());const[calMonth,setCalMonth]=useState(new Date().getMonth()+1);const[daysWithData,setDaysWithData]=useState([]);const videoRef=useRef(null);const hlsRef=useRef(null);const cursorRef=useRef(null);const timelineRef=useRef(null);// FETCH CALENDAR DATA\nuseEffect(()=>{if(!showCal||!camId)return;API.get(\"/playback/calendar-month/\".concat(camId,\"/\").concat(calYear,\"/\").concat(calMonth,\"?_ts=\").concat(Date.now())).then(res=>setDaysWithData(res.data.days||[])).catch(console.error);},[showCal,calYear,calMonth,camId]);// FETCH TIMELINE\nuseEffect(()=>{if(!camId||!selectedDate)return;console.log(\"Fetching timeline: \".concat(selectedDate));API.get(\"/playback/timeline-day/\".concat(camId,\"/\").concat(selectedDate,\"?_ts=\").concat(Date.now())).then(res=>{const{segments:raw,dayStart}=res.data;setServerDayStart(dayStart);const dayEnd=dayStart+86400000;const norm=raw.map(e=>{const s=Math.max(Number(e.start_ts),dayStart);const end=Math.min(Number(e.end_ts),dayEnd);if(end<=s)return null;return{left:(s-dayStart)/86400000,width:(end-s)/86400000,ts:Number(e.start_ts)};}).filter(Boolean);setTimelineSegments(norm);}).catch(console.error);},[camId,selectedDate]);// PLAYBACK LOGIC (DIRECT FRAGMENTED MP4)\nconst play=useCallback(startTime=>{if(!startTime)return;if(videoRef.current){setLastPlaybackStart(startTime);// STORE START TS\nconst streamUrl=\"\".concat(API.defaults.baseURL,\"/playback/stream/\").concat(camId,\"?start=\").concat(startTime,\"&_t=\").concat(Date.now());console.log(\"[Playback] Loading: \".concat(streamUrl));videoRef.current.src=streamUrl;videoRef.current.play().then(()=>setIsPlaying(true)).catch(console.error);}},[camId]);const handleVideoEnded=()=>{console.log(\"[Playback] Segment ended. Finding next...\");if(!lastPlaybackStart||!timelineSegments.length)return;// Estimate end time based on duration (or just search > start)\n// If we played a full segment, we are at start + duration.\n// Actually, simplest is: Find the segment that started at lastPlaybackStart, get next.\nlet foundIndex=-1;// Search approx\nfor(let i=0;i<timelineSegments.length;i++){// Toleranta 1s\nif(Math.abs(timelineSegments[i].ts-lastPlaybackStart)<5000){// Changed s.start_ts to s.ts based on norm mapping\nfoundIndex=i;break;}// Or if we started in middle?\n// This part needs to be careful, as timelineSegments only has start_ts, not end_ts\n// The 'norm' mapping only stores 'ts' which is e.start_ts\n// To properly check if we started in the middle, we'd need the original raw segments or calculate end_ts\n// For now, let's rely on finding the exact start or the next one.\n// If the original raw segments were available, we could do:\n// if (timelineSegments[i].original_start_ts <= lastPlaybackStart && timelineSegments[i].original_end_ts > lastPlaybackStart) {\n//     foundIndex = i;\n//     break;\n// }\n}if(foundIndex!==-1&&foundIndex<timelineSegments.length-1){const nextSeg=timelineSegments[foundIndex+1];console.log(\"[Playback] Auto-advancing to next segment: \".concat(nextSeg.ts));// Changed nextSeg.start_ts to nextSeg.ts\nplay(nextSeg.ts);// Changed nextSeg.start_ts to nextSeg.ts\n}else{// Brute force find next > lastPlaybackStart\nconst next=timelineSegments.find(s=>s.ts>lastPlaybackStart+1000);// Changed s.start_ts to s.ts\nif(next)play(next.ts);// Changed next.start_ts to next.ts\nelse setIsPlaying(false);}};const stop=()=>{if(videoRef.current){videoRef.current.pause();videoRef.current.removeAttribute('src');videoRef.current.load();}setIsPlaying(false);};// DRAW TIMELINE (USER FIXED LOGIC)\nuseEffect(()=>{const canvas=timelineRef.current;if(!canvas||!serverDayStart)return;const ctx=canvas.getContext('2d');const width=canvas.width;const height=canvas.height;// Clear\nctx.clearRect(0,0,width,height);// Background\nctx.fillStyle='#1e1e1e';ctx.fillRect(0,0,width,height);// Hours\nctx.strokeStyle='#444';ctx.lineWidth=1;ctx.beginPath();for(let h=0;h<=24;h++){const x=h/24*width;ctx.moveTo(x,0);ctx.lineTo(x,height);// Label\nctx.fillStyle='#888';ctx.fillText(\"\".concat(h,\":00\"),x+2,12);}ctx.stroke();// SEGMENTS (TRASSIR STYLE)\nif(timelineSegments&&timelineSegments.length>0){const DAY_MS=86400000;const pxPerSec=width/(24*3600);// pixels per second\n// 1. FILTER & NORMALIZE\nconst daySegments=timelineSegments.map(s=>{// Ensure TS are numbers\nconst sStart=Number(s.start_ts);const sEndRaw=Number(s.end_ts);// Handle open-ended segments (0) -> until now or end of day\nconst sEnd=sEndRaw===0?Math.min(Date.now(),serverDayStart+DAY_MS):sEndRaw;const start=Math.max(sStart,serverDayStart);const end=Math.min(sEnd,serverDayStart+DAY_MS);if(end<=start)return null;return{startSec:(start-serverDayStart)/1000,endSec:(end-serverDayStart)/1000};}).filter(Boolean);// 2. DRAW\nctx.fillStyle='#00ff00';// Green Bar\ndaySegments.forEach(s=>{const x=s.startSec*pxPerSec;const w=Math.max((s.endSec-s.startSec)*pxPerSec,2);// Min 2px\n// Draw in bottom half\nctx.fillRect(x,height/2,w,height/2);});}// CURSOR (If Playing)\n// We can draw cursor here or use DOM element. \n// Logic kept in DOM element for smooth updates, so no change needed here for cursor.\n},[timelineSegments,serverDayStart]);// SEEK HANDLER (ABSOLUTE)\nconst handleSeek=e=>{if(!serverDayStart)return;const rect=timelineRef.current.getBoundingClientRect();const width=rect.width;const x=e.clientX-rect.left;// Ratio 0..1\nconst ratio=Math.max(0,Math.min(1,x/width));// Absolute Timestamp\nconst clickedMs=Math.floor(serverDayStart+ratio*86400000);console.log(\"[Timeline] Seek to \".concat(new Date(clickedMs).toLocaleTimeString(),\" (\").concat(clickedMs,\")\"));// Move Cursor Visual\nif(cursorRef.current)cursorRef.current.style.left=ratio*100+\"%\";play(clickedMs);};// CALENDAR RENDER\nconst renderCalendar=()=>{const daysInMonth=new Date(calYear,calMonth,0).getDate();const firstDay=new Date(calYear,calMonth-1,1).getDay();// 0(Sun)..6(Sat)\nconst offset=firstDay===0?6:firstDay-1;// Mon=0\nconst grid=[];for(let i=0;i<offset;i++)grid.push(/*#__PURE__*/_jsx(\"div\",{},\"empty-\".concat(i)));for(let d=1;d<=daysInMonth;d++){const hasData=daysWithData.includes(d);const isSelected=d===new Date(selectedDate).getDate()&&calMonth===new Date(selectedDate).getMonth()+1;grid.push(/*#__PURE__*/_jsx(\"div\",{className:\"cal-day \".concat(hasData?'has-data':'',\" \").concat(isSelected?'selected':''),onClick:()=>{if(hasData){const m=String(calMonth).padStart(2,'0');const day=String(d).padStart(2,'0');setSelectedDate(\"\".concat(calYear,\"-\").concat(m,\"-\").concat(day));setShowCal(false);}},children:d},d));}return grid;};return/*#__PURE__*/_jsxs(\"div\",{className:\"playback-page\",children:[/*#__PURE__*/_jsx(\"style\",{children:styles}),showCal&&/*#__PURE__*/_jsx(\"div\",{className:\"backdrop\",onClick:()=>setShowCal(false)}),/*#__PURE__*/_jsxs(\"div\",{className:\"playback-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:()=>window.location.href='/',children:\"\\u2190 Back\"}),/*#__PURE__*/_jsx(\"div\",{className:\"header-title\",children:camId}),/*#__PURE__*/_jsxs(\"div\",{className:\"date-selector\",onClick:()=>setShowCal(!showCal),children:[\"\\uD83D\\uDCC5 \",selectedDate]}),showCal&&/*#__PURE__*/_jsxs(\"div\",{className:\"calendar-popup\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cal-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"cal-btn\",onClick:()=>setCalMonth(m=>m===1?12:m-1),children:\"\\u25C0\"}),/*#__PURE__*/_jsxs(\"span\",{children:[calYear,\" - \",calMonth]}),/*#__PURE__*/_jsx(\"button\",{className:\"cal-btn\",onClick:()=>setCalMonth(m=>m===12?1:m+1),children:\"\\u25B6\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cal-grid\",children:[['L','M','M','J','V','S','D'].map(d=>/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',fontSize:10,color:'#666'},children:d},d)),renderCalendar()]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"video-viewport\",children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,controls:true,autoPlay:true,muted:true,playsInline:true})}),/*#__PURE__*/_jsxs(\"div\",{className:\"controls\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>timelineSegments[0]&&play(timelineSegments[0].ts),children:\"Play All\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:stop,children:\"Stop\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"timeline-area\",ref:timelineRef,onClick:handleSeek,children:[/*#__PURE__*/_jsx(\"div\",{className:\"time-ticks\",children:Array.from({length:24},(_,i)=>i).map(h=>/*#__PURE__*/_jsx(\"div\",{className:\"tick\",children:h},h))}),/*#__PURE__*/_jsx(\"div\",{className:\"segments-track\",children:timelineSegments.map((s,i)=>/*#__PURE__*/_jsx(\"div\",{className:\"segment\",style:{left:\"\".concat(s.left*100,\"%\"),width:\"\".concat(s.width*100,\"%\")}},i))}),/*#__PURE__*/_jsx(\"div\",{ref:cursorRef,className:\"playhead\",style:{left:'0%'}})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useRef","useCallback","useSearchParams","API","Hls","jsx","_jsx","jsxs","_jsxs","styles","Playback","params","camId","get","selectedDate","setSelectedDate","d","Date","offset","getTimezoneOffset","getTime","toISOString","split","timelineSegments","setTimelineSegments","serverDayStart","setServerDayStart","isPlaying","setIsPlaying","showCal","setShowCal","calYear","setCalYear","getFullYear","calMonth","setCalMonth","getMonth","daysWithData","setDaysWithData","videoRef","hlsRef","cursorRef","timelineRef","concat","now","then","res","data","days","catch","console","error","log","segments","raw","dayStart","dayEnd","norm","map","e","s","Math","max","Number","start_ts","end","min","end_ts","left","width","ts","filter","Boolean","play","startTime","current","setLastPlaybackStart","streamUrl","defaults","baseURL","src","handleVideoEnded","lastPlaybackStart","length","foundIndex","i","abs","nextSeg","next","find","stop","pause","removeAttribute","load","canvas","ctx","getContext","height","clearRect","fillStyle","fillRect","strokeStyle","lineWidth","beginPath","h","x","moveTo","lineTo","fillText","stroke","DAY_MS","pxPerSec","daySegments","sStart","sEndRaw","sEnd","start","startSec","endSec","forEach","w","handleSeek","rect","getBoundingClientRect","clientX","ratio","clickedMs","floor","toLocaleTimeString","style","renderCalendar","daysInMonth","getDate","firstDay","getDay","grid","push","hasData","includes","isSelected","className","onClick","m","String","padStart","day","children","window","location","href","textAlign","fontSize","color","ref","controls","autoPlay","muted","playsInline","Array","from","_"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/pages/Playback.js"],"sourcesContent":["import React, { useEffect, useState, useRef, useCallback } from \"react\";\r\nimport { useSearchParams } from \"react-router-dom\";\r\nimport API from \"../api\";\r\nimport Hls from 'hls.js';\r\n\r\n/* STYLES */\r\nconst styles = `\r\n* { box-sizing: border-box; margin: 0; padding: 0; }\r\nbody { background: #1a1a1a; color: #ccc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }\r\n.playback-page { height: 100vh; display: flex; flex-direction: column; background: #1a1a1a; }\r\n\r\n/* HEADER */\r\n.playback-header { \r\n    height: 48px; background: #111; border-bottom: 1px solid #333; \r\n    display: flex; align-items: center; padding: 0 16px; gap: 16px; \r\n}\r\n.header-title { font-size: 14px; font-weight: 600; color: #fff; margin-right: auto; }\r\n.date-selector { \r\n    background: #222; border: 1px solid #444; color: #fff; \r\n    padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 13px;\r\n    display: flex; align-items: center; gap: 8px;\r\n}\r\n.date-selector:hover { background: #333; border-color: #666; }\r\n\r\n/* CALENDAR POPUP */\r\n.calendar-popup {\r\n    position: absolute; top: 50px; left: 50%; transform: translateX(-50%);\r\n    width: 280px; background: #222; border: 1px solid #555; border-radius: 6px;\r\n    box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 2000;\r\n    padding: 10px;\r\n}\r\n.cal-header { display: flex; justify-content: space-between; margin-bottom: 10px; color: #fff; }\r\n.cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }\r\n.cal-day { \r\n    height: 30px; display: flex; align-items: center; justify-content: center; \r\n    font-size: 12px; border-radius: 3px; cursor: default; color: #555;\r\n}\r\n.cal-day.has-data { \r\n    color: #4da6ff; font-weight: bold; cursor: pointer; background: rgba(77, 166, 255, 0.1); \r\n}\r\n.cal-day.has-data:hover { background: #4da6ff; color: #000; }\r\n.cal-day.selected { background: #fff; color: #000; border: 1px solid #4da6ff; }\r\n.cal-btn { background: none; border: none; color: #aaa; cursor: pointer; }\r\n.cal-btn:hover { color: #fff; }\r\n\r\n/* VIDEO */\r\n.video-viewport { flex: 1; background: #000; position: relative; display:flex; align-items:center; justify-content:center; }\r\nvideo { width: 100%; height: 100%; object-fit: contain; }\r\n\r\n/* CONTROLS & TIMELINE */\r\n.timeline-area { height: 100px; background: #0f0f0f; border-top: 1px solid #333; position: relative; user-select: none; cursor: crosshair; }\r\n.time-ticks { position: absolute; top: 0; width: 100%; height: 20px; display: flex; pointer-events: none; }\r\n.tick { flex: 1; border-left: 1px solid #333; font-size: 10px; color: #666; padding-left: 2px; }\r\n.segments-track { position: absolute; top: 25px; bottom: 0; width: 100%; background: rgba(255,255,255,0.01); }\r\n.segment { position: absolute; top: 5px; height: 30px; background: #1f9d55; min-width: 2px; opacity: 0.9; }\r\n.playhead { position: absolute; top: 0; bottom: 0; width: 2px; background: #f00; z-index: 50; pointer-events: none; }\r\n.controls { height: 40px; background: #111; display: flex; align-items: center; gap: 10px; padding: 0 10px; border-top: 1px solid #222; }\r\n.btn { background: #333; color: #eee; border: 1px solid #444; padding: 4px 12px; cursor: pointer; font-size: 12px; }\r\n.btn:hover { background: #444; }\r\n.btn-primary { background: #0055aa; border-color: #004488; }\r\n.backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; }\r\n`;\r\n\r\nexport default function Playback() {\r\n    const [params] = useSearchParams();\r\n    const camId = params.get(\"camId\");\r\n\r\n    const [selectedDate, setSelectedDate] = useState(() => {\r\n        const d = new Date();\r\n        const offset = d.getTimezoneOffset() * 60000;\r\n        return new Date(d.getTime() - offset).toISOString().split('T')[0];\r\n    });\r\n\r\n    const [timelineSegments, setTimelineSegments] = useState([]);\r\n    const [serverDayStart, setServerDayStart] = useState(0);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n\r\n    // Calendar State\r\n    const [showCal, setShowCal] = useState(false);\r\n    const [calYear, setCalYear] = useState(new Date().getFullYear());\r\n    const [calMonth, setCalMonth] = useState(new Date().getMonth() + 1);\r\n    const [daysWithData, setDaysWithData] = useState([]);\r\n\r\n    const videoRef = useRef(null);\r\n    const hlsRef = useRef(null);\r\n    const cursorRef = useRef(null);\r\n    const timelineRef = useRef(null);\r\n\r\n    // FETCH CALENDAR DATA\r\n    useEffect(() => {\r\n        if (!showCal || !camId) return;\r\n        API.get(`/playback/calendar-month/${camId}/${calYear}/${calMonth}?_ts=${Date.now()}`)\r\n            .then(res => setDaysWithData(res.data.days || []))\r\n            .catch(console.error);\r\n    }, [showCal, calYear, calMonth, camId]);\r\n\r\n    // FETCH TIMELINE\r\n    useEffect(() => {\r\n        if (!camId || !selectedDate) return;\r\n        console.log(`Fetching timeline: ${selectedDate}`);\r\n        API.get(`/playback/timeline-day/${camId}/${selectedDate}?_ts=${Date.now()}`)\r\n            .then(res => {\r\n                const { segments: raw, dayStart } = res.data;\r\n                setServerDayStart(dayStart);\r\n                const dayEnd = dayStart + 86400000;\r\n\r\n                const norm = raw.map(e => {\r\n                    const s = Math.max(Number(e.start_ts), dayStart);\r\n                    const end = Math.min(Number(e.end_ts), dayEnd);\r\n                    if (end <= s) return null;\r\n                    return { left: (s - dayStart) / 86400000, width: (end - s) / 86400000, ts: Number(e.start_ts) };\r\n                }).filter(Boolean);\r\n\r\n                setTimelineSegments(norm);\r\n            })\r\n            .catch(console.error);\r\n    }, [camId, selectedDate]);\r\n\r\n    // PLAYBACK LOGIC (DIRECT FRAGMENTED MP4)\r\n    const play = useCallback((startTime) => {\r\n        if (!startTime) return;\r\n\r\n        if (videoRef.current) {\r\n            setLastPlaybackStart(startTime); // STORE START TS\r\n            const streamUrl = `${API.defaults.baseURL}/playback/stream/${camId}?start=${startTime}&_t=${Date.now()}`;\r\n            console.log(`[Playback] Loading: ${streamUrl}`);\r\n            videoRef.current.src = streamUrl;\r\n            videoRef.current.play().then(() => setIsPlaying(true)).catch(console.error);\r\n        }\r\n    }, [camId]);\r\n\r\n    const handleVideoEnded = () => {\r\n        console.log(\"[Playback] Segment ended. Finding next...\");\r\n        if (!lastPlaybackStart || !timelineSegments.length) return;\r\n\r\n        // Estimate end time based on duration (or just search > start)\r\n        // If we played a full segment, we are at start + duration.\r\n        // Actually, simplest is: Find the segment that started at lastPlaybackStart, get next.\r\n\r\n        let foundIndex = -1;\r\n        // Search approx\r\n        for (let i = 0; i < timelineSegments.length; i++) {\r\n            // Toleranta 1s\r\n            if (Math.abs(timelineSegments[i].ts - lastPlaybackStart) < 5000) { // Changed s.start_ts to s.ts based on norm mapping\r\n                foundIndex = i;\r\n                break;\r\n            }\r\n            // Or if we started in middle?\r\n            // This part needs to be careful, as timelineSegments only has start_ts, not end_ts\r\n            // The 'norm' mapping only stores 'ts' which is e.start_ts\r\n            // To properly check if we started in the middle, we'd need the original raw segments or calculate end_ts\r\n            // For now, let's rely on finding the exact start or the next one.\r\n            // If the original raw segments were available, we could do:\r\n            // if (timelineSegments[i].original_start_ts <= lastPlaybackStart && timelineSegments[i].original_end_ts > lastPlaybackStart) {\r\n            //     foundIndex = i;\r\n            //     break;\r\n            // }\r\n        }\r\n\r\n        if (foundIndex !== -1 && foundIndex < timelineSegments.length - 1) {\r\n            const nextSeg = timelineSegments[foundIndex + 1];\r\n            console.log(`[Playback] Auto-advancing to next segment: ${nextSeg.ts}`); // Changed nextSeg.start_ts to nextSeg.ts\r\n            play(nextSeg.ts); // Changed nextSeg.start_ts to nextSeg.ts\r\n        } else {\r\n            // Brute force find next > lastPlaybackStart\r\n            const next = timelineSegments.find(s => s.ts > lastPlaybackStart + 1000); // Changed s.start_ts to s.ts\r\n            if (next) play(next.ts); // Changed next.start_ts to next.ts\r\n            else setIsPlaying(false);\r\n        }\r\n    };\r\n\r\n    const stop = () => {\r\n        if (videoRef.current) {\r\n            videoRef.current.pause();\r\n            videoRef.current.removeAttribute('src');\r\n            videoRef.current.load();\r\n        }\r\n        setIsPlaying(false);\r\n    };\r\n\r\n    // DRAW TIMELINE (USER FIXED LOGIC)\r\n    useEffect(() => {\r\n        const canvas = timelineRef.current;\r\n        if (!canvas || !serverDayStart) return;\r\n        const ctx = canvas.getContext('2d');\r\n        const width = canvas.width;\r\n        const height = canvas.height;\r\n\r\n        // Clear\r\n        ctx.clearRect(0, 0, width, height);\r\n\r\n        // Background\r\n        ctx.fillStyle = '#1e1e1e';\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        // Hours\r\n        ctx.strokeStyle = '#444';\r\n        ctx.lineWidth = 1;\r\n        ctx.beginPath();\r\n        for (let h = 0; h <= 24; h++) {\r\n            const x = (h / 24) * width;\r\n            ctx.moveTo(x, 0);\r\n            ctx.lineTo(x, height);\r\n            // Label\r\n            ctx.fillStyle = '#888';\r\n            ctx.fillText(`${h}:00`, x + 2, 12);\r\n        }\r\n        ctx.stroke();\r\n\r\n        // SEGMENTS (TRASSIR STYLE)\r\n        if (timelineSegments && timelineSegments.length > 0) {\r\n            const DAY_MS = 86400000;\r\n            const pxPerSec = width / (24 * 3600); // pixels per second\r\n\r\n            // 1. FILTER & NORMALIZE\r\n            const daySegments = timelineSegments.map(s => {\r\n                // Ensure TS are numbers\r\n                const sStart = Number(s.start_ts);\r\n                const sEndRaw = Number(s.end_ts);\r\n                // Handle open-ended segments (0) -> until now or end of day\r\n                const sEnd = sEndRaw === 0 ? Math.min(Date.now(), serverDayStart + DAY_MS) : sEndRaw;\r\n\r\n                const start = Math.max(sStart, serverDayStart);\r\n                const end = Math.min(sEnd, serverDayStart + DAY_MS);\r\n\r\n                if (end <= start) return null;\r\n\r\n                return {\r\n                    startSec: (start - serverDayStart) / 1000,\r\n                    endSec: (end - serverDayStart) / 1000\r\n                };\r\n            }).filter(Boolean);\r\n\r\n            // 2. DRAW\r\n            ctx.fillStyle = '#00ff00'; // Green Bar\r\n            daySegments.forEach(s => {\r\n                const x = s.startSec * pxPerSec;\r\n                const w = Math.max((s.endSec - s.startSec) * pxPerSec, 2); // Min 2px\r\n\r\n                // Draw in bottom half\r\n                ctx.fillRect(x, height / 2, w, height / 2);\r\n            });\r\n        }\r\n\r\n        // CURSOR (If Playing)\r\n        // We can draw cursor here or use DOM element. \r\n        // Logic kept in DOM element for smooth updates, so no change needed here for cursor.\r\n\r\n    }, [timelineSegments, serverDayStart]);\r\n\r\n    // SEEK HANDLER (ABSOLUTE)\r\n    const handleSeek = (e) => {\r\n        if (!serverDayStart) return;\r\n        const rect = timelineRef.current.getBoundingClientRect();\r\n        const width = rect.width;\r\n        const x = e.clientX - rect.left;\r\n\r\n        // Ratio 0..1\r\n        const ratio = Math.max(0, Math.min(1, x / width));\r\n\r\n        // Absolute Timestamp\r\n        const clickedMs = Math.floor(serverDayStart + ratio * 86400000);\r\n\r\n        console.log(`[Timeline] Seek to ${new Date(clickedMs).toLocaleTimeString()} (${clickedMs})`);\r\n\r\n        // Move Cursor Visual\r\n        if (cursorRef.current) cursorRef.current.style.left = (ratio * 100) + \"%\";\r\n\r\n        play(clickedMs);\r\n    };\r\n\r\n\r\n    // CALENDAR RENDER\r\n    const renderCalendar = () => {\r\n        const daysInMonth = new Date(calYear, calMonth, 0).getDate();\r\n        const firstDay = new Date(calYear, calMonth - 1, 1).getDay(); // 0(Sun)..6(Sat)\r\n        const offset = firstDay === 0 ? 6 : firstDay - 1; // Mon=0\r\n\r\n        const grid = [];\r\n        for (let i = 0; i < offset; i++) grid.push(<div key={`empty-${i}`} />);\r\n\r\n        for (let d = 1; d <= daysInMonth; d++) {\r\n            const hasData = daysWithData.includes(d);\r\n            const isSelected = (d === new Date(selectedDate).getDate()) &&\r\n                (calMonth === new Date(selectedDate).getMonth() + 1);\r\n\r\n            grid.push(\r\n                <div key={d}\r\n                    className={`cal-day ${hasData ? 'has-data' : ''} ${isSelected ? 'selected' : ''}`}\r\n                    onClick={() => {\r\n                        if (hasData) {\r\n                            const m = String(calMonth).padStart(2, '0');\r\n                            const day = String(d).padStart(2, '0');\r\n                            setSelectedDate(`${calYear}-${m}-${day}`);\r\n                            setShowCal(false);\r\n                        }\r\n                    }}\r\n                >\r\n                    {d}\r\n                </div>\r\n            );\r\n        }\r\n        return grid;\r\n    };\r\n\r\n    return (\r\n        <div className=\"playback-page\">\r\n            <style>{styles}</style>\r\n            {showCal && <div className=\"backdrop\" onClick={() => setShowCal(false)} />}\r\n\r\n            <div className=\"playback-header\">\r\n                <button className=\"btn\" onClick={() => window.location.href = '/'}>‚Üê Back</button>\r\n                <div className=\"header-title\">{camId}</div>\r\n\r\n                <div className=\"date-selector\" onClick={() => setShowCal(!showCal)}>\r\n                    üìÖ {selectedDate}\r\n                </div>\r\n\r\n                {showCal && (\r\n                    <div className=\"calendar-popup\">\r\n                        <div className=\"cal-header\">\r\n                            <button className=\"cal-btn\" onClick={() => setCalMonth(m => m === 1 ? 12 : m - 1)}>‚óÄ</button>\r\n                            <span>{calYear} - {calMonth}</span>\r\n                            <button className=\"cal-btn\" onClick={() => setCalMonth(m => m === 12 ? 1 : m + 1)}>‚ñ∂</button>\r\n                        </div>\r\n                        <div className=\"cal-grid\">\r\n                            {['L', 'M', 'M', 'J', 'V', 'S', 'D'].map(d => <div key={d} style={{ textAlign: 'center', fontSize: 10, color: '#666' }}>{d}</div>)}\r\n                            {renderCalendar()}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"video-viewport\">\r\n                <video ref={videoRef} controls autoPlay muted playsInline />\r\n            </div>\r\n\r\n            <div className=\"controls\">\r\n                <button className=\"btn btn-primary\" onClick={() => timelineSegments[0] && play(timelineSegments[0].ts)}>Play All</button>\r\n                <button className=\"btn\" onClick={stop}>Stop</button>\r\n            </div>\r\n\r\n            <div className=\"timeline-area\" ref={timelineRef} onClick={handleSeek}>\r\n                <div className=\"time-ticks\">\r\n                    {Array.from({ length: 24 }, (_, i) => i).map(h => <div key={h} className=\"tick\">{h}</div>)}\r\n                </div>\r\n                <div className=\"segments-track\">\r\n                    {timelineSegments.map((s, i) => (\r\n                        <div key={i} className=\"segment\" style={{ left: `${s.left * 100}%`, width: `${s.width * 100}%` }} />\r\n                    ))}\r\n                </div>\r\n                <div ref={cursorRef} className=\"playhead\" style={{ left: '0%' }} />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}