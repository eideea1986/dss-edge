{"ast":null,"code":"import _objectSpread from\"I:/dispecerat/github_release/dss-edge/local-ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";export default function RecorderPlayer(_ref){let{camId,streamType,style}=_ref;const videoRef=useRef(null);const hlsRef=useRef(null);useEffect(()=>{const video=videoRef.current;if(!video)return;// Direct path - no API prefix needed since we're on same origin\nconst hlsUrl=\"/api/playback/live/\".concat(camId,\".m3u8\");const initHls=()=>{if(window.Hls&&window.Hls.isSupported()){if(hlsRef.current)hlsRef.current.destroy();const hls=new window.Hls({debug:false,// Disable for production\nenableWorker:true,// CRITICAL: Live streaming configuration\n// This tells HLS.js to continuously poll for new segments\nliveSyncDurationCount:3,// Stay 3 segments from live edge\nliveMaxLatencyDurationCount:10,// Max 10 segments behind\nliveDurationInfinity:true,// Playlist has no end\n// Buffer settings for smooth playback\nmaxBufferLength:20,maxMaxBufferLength:40,backBufferLength:10,// Manifest loading\nmanifestLoadingTimeOut:10000,manifestLoadingMaxRetry:10,manifestLoadingRetryDelay:500,// Level loading  \nlevelLoadingTimeOut:10000,levelLoadingMaxRetry:10,levelLoadingRetryDelay:500});hls.loadSource(hlsUrl);hls.attachMedia(video);hls.on(window.Hls.Events.MANIFEST_PARSED,()=>{console.log('[RecorderPlayer] Manifest parsed, starting playback');video.play().catch(e=>console.warn(\"Autoplay block\",e));});hls.on(window.Hls.Events.ERROR,(event,data)=>{if(data.fatal){console.error('[RecorderPlayer] Fatal HLS Error:',data.type,data.details);switch(data.type){case window.Hls.ErrorTypes.NETWORK_ERROR:console.log('[RecorderPlayer] Network error, trying to recover...');hls.startLoad();break;case window.Hls.ErrorTypes.MEDIA_ERROR:console.log('[RecorderPlayer] Media error, trying to recover...');hls.recoverMediaError();break;default:console.error('[RecorderPlayer] Unrecoverable error, destroying player');hls.destroy();break;}}});hlsRef.current=hls;}else if(video.canPlayType('application/vnd.apple.mpegurl')){// Safari Native\nvideo.src=hlsUrl;video.addEventListener('loadedmetadata',()=>{video.play();});}};// Load Hls.js if not available\nif(!window.Hls&&typeof Hls==='undefined'){const script=document.createElement('script');script.src=\"https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js\";script.onload=initHls;document.head.appendChild(script);}else{initHls();}return()=>{if(hlsRef.current)hlsRef.current.destroy();};},[camId]);return/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},style),{},{position:'relative',background:'#000',overflow:'hidden'}),children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,style:{width:'100%',height:'100%',objectFit:'contain',// FIX: Keep aspect ratio, fit within container\ndisplay:'block'},autoPlay:true,muted:true,playsInline:true})});}","map":{"version":3,"names":["React","useEffect","useRef","jsx","_jsx","RecorderPlayer","_ref","camId","streamType","style","videoRef","hlsRef","video","current","hlsUrl","concat","initHls","window","Hls","isSupported","destroy","hls","debug","enableWorker","liveSyncDurationCount","liveMaxLatencyDurationCount","liveDurationInfinity","maxBufferLength","maxMaxBufferLength","backBufferLength","manifestLoadingTimeOut","manifestLoadingMaxRetry","manifestLoadingRetryDelay","levelLoadingTimeOut","levelLoadingMaxRetry","levelLoadingRetryDelay","loadSource","attachMedia","on","Events","MANIFEST_PARSED","console","log","play","catch","e","warn","ERROR","event","data","fatal","error","type","details","ErrorTypes","NETWORK_ERROR","startLoad","MEDIA_ERROR","recoverMediaError","canPlayType","src","addEventListener","script","document","createElement","onload","head","appendChild","_objectSpread","position","background","overflow","children","ref","width","height","objectFit","display","autoPlay","muted","playsInline"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/components/RecorderPlayer.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\n\r\nexport default function RecorderPlayer({ camId, streamType, style }) {\r\n    const videoRef = useRef(null);\r\n    const hlsRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        const video = videoRef.current;\r\n        if (!video) return;\r\n\r\n        // Direct path - no API prefix needed since we're on same origin\r\n        const hlsUrl = `/api/playback/live/${camId}.m3u8`;\r\n\r\n        const initHls = () => {\r\n            if (window.Hls && window.Hls.isSupported()) {\r\n                if (hlsRef.current) hlsRef.current.destroy();\r\n\r\n                const hls = new window.Hls({\r\n                    debug: false, // Disable for production\r\n                    enableWorker: true,\r\n\r\n                    // CRITICAL: Live streaming configuration\r\n                    // This tells HLS.js to continuously poll for new segments\r\n                    liveSyncDurationCount: 3, // Stay 3 segments from live edge\r\n                    liveMaxLatencyDurationCount: 10, // Max 10 segments behind\r\n                    liveDurationInfinity: true, // Playlist has no end\r\n\r\n                    // Buffer settings for smooth playback\r\n                    maxBufferLength: 20,\r\n                    maxMaxBufferLength: 40,\r\n                    backBufferLength: 10,\r\n\r\n                    // Manifest loading\r\n                    manifestLoadingTimeOut: 10000,\r\n                    manifestLoadingMaxRetry: 10,\r\n                    manifestLoadingRetryDelay: 500,\r\n\r\n                    // Level loading  \r\n                    levelLoadingTimeOut: 10000,\r\n                    levelLoadingMaxRetry: 10,\r\n                    levelLoadingRetryDelay: 500,\r\n                });\r\n\r\n                hls.loadSource(hlsUrl);\r\n                hls.attachMedia(video);\r\n\r\n                hls.on(window.Hls.Events.MANIFEST_PARSED, () => {\r\n                    console.log('[RecorderPlayer] Manifest parsed, starting playback');\r\n                    video.play().catch(e => console.warn(\"Autoplay block\", e));\r\n                });\r\n\r\n                hls.on(window.Hls.Events.ERROR, (event, data) => {\r\n                    if (data.fatal) {\r\n                        console.error('[RecorderPlayer] Fatal HLS Error:', data.type, data.details);\r\n                        switch (data.type) {\r\n                            case window.Hls.ErrorTypes.NETWORK_ERROR:\r\n                                console.log('[RecorderPlayer] Network error, trying to recover...');\r\n                                hls.startLoad();\r\n                                break;\r\n                            case window.Hls.ErrorTypes.MEDIA_ERROR:\r\n                                console.log('[RecorderPlayer] Media error, trying to recover...');\r\n                                hls.recoverMediaError();\r\n                                break;\r\n                            default:\r\n                                console.error('[RecorderPlayer] Unrecoverable error, destroying player');\r\n                                hls.destroy();\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                hlsRef.current = hls;\r\n            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {\r\n                // Safari Native\r\n                video.src = hlsUrl;\r\n                video.addEventListener('loadedmetadata', () => {\r\n                    video.play();\r\n                });\r\n            }\r\n        };\r\n\r\n        // Load Hls.js if not available\r\n        if (!window.Hls && typeof Hls === 'undefined') {\r\n            const script = document.createElement('script');\r\n            script.src = \"https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js\";\r\n            script.onload = initHls;\r\n            document.head.appendChild(script);\r\n        } else {\r\n            initHls();\r\n        }\r\n\r\n        return () => {\r\n            if (hlsRef.current) hlsRef.current.destroy();\r\n        };\r\n    }, [camId]);\r\n\r\n    return (\r\n        <div style={{ ...style, position: 'relative', background: '#000', overflow: 'hidden' }}>\r\n            <video\r\n                ref={videoRef}\r\n                style={{\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    objectFit: 'contain', // FIX: Keep aspect ratio, fit within container\r\n                    display: 'block'\r\n                }}\r\n                autoPlay\r\n                muted\r\n                playsInline\r\n            />\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}