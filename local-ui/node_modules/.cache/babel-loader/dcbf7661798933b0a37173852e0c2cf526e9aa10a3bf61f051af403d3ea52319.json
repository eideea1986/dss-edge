{"ast":null,"code":"import _objectSpread from\"I:/dispecerat/github_release/dss-edge/local-ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useRef,useLayoutEffect}from\"react\";import{useSearchParams,useNavigate}from\"react-router-dom\";import API from\"../api\";import PlaybackController,{PlayerStates}from\"../services/PlaybackController\";// --- ENTERPRISE THEME ---\nimport{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const btnStyle={background:\"#444\",color:\"#fff\",border:\"none\",padding:\"4px 8px\",borderRadius:3,cursor:\"pointer\"};const THEME={bg:\"#1e1e1e\",sidebar:\"#252526\",header:\"#2d2d2d\",text:\"#ffffff\",accent:\"#2196f3\",segment:\"#4caf50\",segmentEvent:\"#2196f3\",rulerBg:\"#252526\",playhead:\"#ff9800\",panelBorder:\"#3e3e42\",selectedItem:\"#37373d\"};export default function PlaybackModern(){var _cameras$find;const[searchParams]=useSearchParams();const navigate=useNavigate();const camId=searchParams.get(\"camId\");// --- STATE ---\nconst[cameras,setCameras]=useState([]);const[selectedDate,setSelectedDate]=useState(new Date().toISOString().split('T')[0]);const[playerState,setPlayerState]=useState(PlayerStates.IDLE);// --- TIMELINE STATE ---\nconst[currentTimeMs,setCurrentTimeMs]=useState(Date.now());const[viewportStartMs,setViewportStartMs]=useState(new Date().setHours(0,0,0,0));const[zoomPxPerSec,setZoomPxPerSec]=useState(1000/86400);// Fit Day Default\nconst[containerWidth,setContainerWidth]=useState(1000);const[segments,setSegments]=useState([]);const[isLoadingData,setIsLoadingData]=useState(false);const videoRef=useRef(null);const playerRef=useRef(null);const timelineRef=useRef(null);const dragRef=useRef({isDragging:false,startX:0,startViewTime:0});const[recRange,setRecRange]=useState({start:null,end:null});// --- DATA SETUP ---\nuseEffect(()=>{// Fetch Camera List\nAPI.get('/cameras').then(res=>{const list=Array.isArray(res.data)?res.data:[];setCameras(list);}).catch(console.error);},[]);// Fetch Recording Range\nuseEffect(()=>{if(!camId)return;API.get(\"/api/playback/range/\".concat(camId)).then(res=>{setRecRange(res.data);}).catch(console.error);},[camId]);// ... existing useEffects ...\nuseEffect(()=>{if(selectedDate){const start=new Date(selectedDate).setHours(0,0,0,0);setViewportStartMs(start);// Set Current Time to middle of day or Start? Start (00:00) makes sense for review.\nsetCurrentTimeMs(start+86400000/2);// Noon\n}},[selectedDate]);useLayoutEffect(()=>{if(!timelineRef.current)return;// ResizeObserver for robust width detection\nconst ro=new ResizeObserver(entries=>{for(let entry of entries){if(entry.contentRect.width>0)setContainerWidth(entry.contentRect.width);}});ro.observe(timelineRef.current);// Initial set\nsetContainerWidth(timelineRef.current.clientWidth||1000);return()=>ro.disconnect();},[]);useEffect(()=>{if(videoRef.current&&camId){playerRef.current=new PlaybackController(videoRef.current,camId,s=>setPlayerState(s));return()=>{var _playerRef$current;return(_playerRef$current=playerRef.current)===null||_playerRef$current===void 0?void 0:_playerRef$current.destroy();};}},[camId]);useEffect(()=>{if(!camId||!selectedDate)return;const fetchData=async()=>{setIsLoadingData(true);setSegments([]);try{const res=await API.get(\"/api/playback/timeline-day/\".concat(camId,\"/\").concat(selectedDate));const data=res.data;const serverDayStart=data.dayStart;const localDayStart=new Date(selectedDate).setHours(0,0,0,0);let correction=0;if(serverDayStart>0){correction=localDayStart-serverDayStart;}const segs=(data.segments||[]).map(s=>({start:Number(s.start_ts)+correction,end:Number(s.end_ts)+correction,type:'normal'})).sort((a,b)=>a.start-b.start);setSegments(segs);if(playerRef.current)playerRef.current.loadSegments(segs);setViewportStartMs(localDayStart);if(containerWidth>0)setZoomPxPerSec(containerWidth/86400);}catch(e){console.error(e);}finally{setIsLoadingData(false);}};fetchData();},[camId,selectedDate,containerWidth]);// --- SYNC LOOP ---\nuseEffect(()=>{const i=setInterval(()=>{if(playerState===PlayerStates.PLAYING&&playerRef.current){const now=playerRef.current.getCurrentTime();if(Math.abs(now-currentTimeMs)>200)setCurrentTimeMs(now);// Gap Skip\nconst currentSeg=segments.find(s=>now>=s.start&&now<s.end);if(currentSeg&&currentSeg.end-now<500){const nextSeg=segments.find(s=>s.start>=currentSeg.end);if(nextSeg&&nextSeg.start-currentSeg.end>1000){playerRef.current.seekTo(nextSeg.start);}}}},100);return()=>clearInterval(i);},[playerState,currentTimeMs,segments]);// --- ACTIONS ---\nconst handleCameraClick=id=>{navigate(\"/playback?camId=\".concat(id));};const performSeek=ts=>{var _playerRef$current2;setCurrentTimeMs(ts);(_playerRef$current2=playerRef.current)===null||_playerRef$current2===void 0?void 0:_playerRef$current2.seekTo(ts);};const fitDay=()=>{const start=new Date(selectedDate).setHours(0,0,0,0);setViewportStartMs(start);setZoomPxPerSec(containerWidth/86400);};// --- MOUSE HANDLERS (Constrained Pan) ---\nconst handleMouseDown=e=>{dragRef.current={isDragging:true,startX:e.clientX,startViewTime:viewportStartMs};};const handleMouseMove=e=>{if(!dragRef.current.isDragging)return;const dx=e.clientX-dragRef.current.startX;const dt=-(dx/zoomPxPerSec)*1000;let newStart=dragRef.current.startViewTime+dt;// CONSTRAIN TO DAY BOUNDARIES (User Request: \"Nu trece de la o zi la alta\")\nconst dayStart=new Date(selectedDate).setHours(0,0,0,0);const dayEnd=dayStart+86400000;// Allow zooming but keep view within day range roughly\n// If zoomed in, we can pan. But don't pan past 00:00 or 24:00 relative to container?\n// Actually, just clamp strictly.\nif(newStart<dayStart)newStart=dayStart;if(newStart>dayEnd-containerWidth/zoomPxPerSec*1000){// newStart cannot ensure end > dayEnd completely if zoomed out?\n// If zoomed out Max (fit day), newStart is dayStart.\n// If zoomed in, restrict right edge.\n// Let's just create a soft clamp for left side 00:00\n}setViewportStartMs(newStart);};const handleMouseUp=e=>{dragRef.current.isDragging=false;if(Math.abs(e.clientX-dragRef.current.startX)<5){const rect=timelineRef.current.getBoundingClientRect();const clickX=e.clientX-rect.left;const ts=viewportStartMs+clickX/zoomPxPerSec*1000;performSeek(ts);}};const handleWheel=e=>{if(e.target.closest('.timeline-area')){e.preventDefault();const rect=timelineRef.current.getBoundingClientRect();const mouseX=e.clientX-rect.left;const timeUnderMouse=viewportStartMs+mouseX/zoomPxPerSec*1000;const factor=e.deltaY>0?0.9:1.1;const newZoom=Math.max(containerWidth/86400,Math.min(5.0,zoomPxPerSec*factor));// Calc new start to keep mouse time static\nlet newStart=timeUnderMouse-mouseX/newZoom*1000;// Constrain\nconst dayStart=new Date(selectedDate).setHours(0,0,0,0);if(newStart<dayStart)newStart=dayStart;setZoomPxPerSec(newZoom);setViewportStartMs(newStart);}};// --- RENDER HELPERS ---\nconst timeToPx=t=>(t-viewportStartMs)/1000*zoomPxPerSec;const renderRuler=()=>{const ticks=[];const stepMs=3600*1000;// Fixed 1 Hour ticks for \"0-24\" stability\nconst dayStart=new Date(selectedDate).setHours(0,0,0,0);for(let i=0;i<=24;i++){const t=dayStart+i*stepMs;const x=timeToPx(t);if(x<-20||x>containerWidth)continue;ticks.push(/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',left:x,top:0,height:25,borderLeft:'1px solid #666'},children:/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',top:2,left:4,fontSize:11,color:'#aaa'},children:[i,\":00\"]})},i));}return ticks;};return/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',width:'100%',height:'100%',background:THEME.bg,color:THEME.text},children:[/*#__PURE__*/_jsxs(\"div\",{style:{width:250,background:THEME.sidebar,borderSizing:'border-box',borderRight:\"1px solid \".concat(THEME.panelBorder),display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(\"div\",{style:{padding:\"12px 16px\",fontWeight:'bold',borderBottom:\"1px solid \".concat(THEME.panelBorder),color:THEME.accent,fontSize:12,letterSpacing:1},children:\"CHANNELS\"}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,overflowY:'auto'},children:[cameras.map(cam=>/*#__PURE__*/_jsx(\"div\",{onClick:()=>handleCameraClick(cam.id),style:{padding:'10px 16px',cursor:'pointer',fontSize:13,borderBottom:\"1px solid rgba(255,255,255,0.02)\",background:camId===cam.id?THEME.selectedItem:'transparent',color:camId===cam.id?THEME.accent:'#aaa',borderLeft:camId===cam.id?\"3px solid \".concat(THEME.accent):'3px solid transparent'},children:cam.name||cam.id},cam.id)),cameras.length===0&&/*#__PURE__*/_jsx(\"div\",{style:{padding:10,color:'#888'},children:\"No cameras found\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,display:'flex',flexDirection:'column',overflow:'hidden'},children:[/*#__PURE__*/_jsxs(\"header\",{style:{height:44,background:THEME.header,display:'flex',alignItems:'center',padding:'0 12px',borderBottom:\"1px solid \".concat(THEME.panelBorder),gap:15},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/live'),style:_objectSpread(_objectSpread({},btnStyle),{},{background:'transparent',padding:'4px 8px',fontSize:16}),title:\"Back to Live\",children:\"\\u2B05\\uFE0F\"}),/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:'bold',color:THEME.accent,fontSize:14},children:\"ARHIV\\u0102 VMS\"}),camId&&/*#__PURE__*/_jsx(\"span\",{style:{fontSize:13,background:'rgba(255,255,255,0.05)',padding:'2px 8px',borderRadius:4},children:((_cameras$find=cameras.find(c=>c.id===camId))===null||_cameras$find===void 0?void 0:_cameras$find.name)||camId}),recRange.start&&/*#__PURE__*/_jsxs(\"span\",{style:{fontSize:11,color:'#888'},children:[\"(\",new Date(recRange.start).toLocaleDateString(),\" - \",new Date(recRange.end).toLocaleDateString(),\")\"]}),/*#__PURE__*/_jsx(\"div\",{style:{flex:1}}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:selectedDate,onChange:e=>setSelectedDate(e.target.value),style:{background:'#333',color:'#fff',border:'1px solid #444',borderRadius:4,padding:'4px 8px',fontSize:12}})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,position:'relative',background:'#000',overflow:'hidden',minHeight:0},children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,style:{position:'absolute',top:0,left:0,width:'100%',height:'100%',objectFit:'contain'}}),!camId&&/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',top:'50%',left:'50%',transform:'translate(-50%, -50%)',color:'#aaa'},children:\"Select a Camera\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{height:48,background:'#252526',display:'flex',alignItems:'center',padding:'0 10px',gap:10},children:[/*#__PURE__*/_jsx(\"button\",{style:btnStyle,onClick:()=>performSeek(currentTimeMs-5000),children:\"\\u23EA\"}),/*#__PURE__*/_jsx(\"button\",{style:btnStyle,onClick:()=>{var _playerRef$current3,_playerRef$current4;return playerState===PlayerStates.PLAYING?(_playerRef$current3=playerRef.current)===null||_playerRef$current3===void 0?void 0:_playerRef$current3.pause():(_playerRef$current4=playerRef.current)===null||_playerRef$current4===void 0?void 0:_playerRef$current4.play();},children:playerState===PlayerStates.PLAYING?\"PAUSE\":\"PLAY\"}),/*#__PURE__*/_jsx(\"button\",{style:btnStyle,onClick:()=>performSeek(currentTimeMs+5000),children:\"\\u23E9\"}),/*#__PURE__*/_jsx(\"span\",{style:{flex:1,textAlign:'center',fontFamily:'monospace'},children:new Date(currentTimeMs).toLocaleTimeString()}),/*#__PURE__*/_jsx(\"button\",{style:btnStyle,onClick:fitDay,children:\"24H\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"timeline-area\",ref:timelineRef,style:{height:100,background:THEME.rulerBg,position:'relative',overflow:'hidden'},onMouseUp:handleMouseUp,onMouseLeave:handleMouseUp,onMouseMove:handleMouseMove,onMouseDown:handleMouseDown,onWheel:handleWheel,children:[/*#__PURE__*/_jsx(\"div\",{style:{height:25,borderBottom:'1px solid #444'},children:renderRuler()}),/*#__PURE__*/_jsx(\"div\",{style:{position:'relative',top:5,height:40},children:segments.map((s,i)=>{const x=timeToPx(s.start);const w=Math.max(2,(s.end-s.start)/1000*zoomPxPerSec);if(x+w<0||x>containerWidth)return null;return/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',left:x,width:w,height:'100%',background:THEME.segment}},i);})}),/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',left:timeToPx(currentTimeMs),top:0,bottom:0,width:2,background:THEME.playhead,zIndex:10}})]})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useRef","useLayoutEffect","useSearchParams","useNavigate","API","PlaybackController","PlayerStates","jsxs","_jsxs","jsx","_jsx","btnStyle","background","color","border","padding","borderRadius","cursor","THEME","bg","sidebar","header","text","accent","segment","segmentEvent","rulerBg","playhead","panelBorder","selectedItem","PlaybackModern","_cameras$find","searchParams","navigate","camId","get","cameras","setCameras","selectedDate","setSelectedDate","Date","toISOString","split","playerState","setPlayerState","IDLE","currentTimeMs","setCurrentTimeMs","now","viewportStartMs","setViewportStartMs","setHours","zoomPxPerSec","setZoomPxPerSec","containerWidth","setContainerWidth","segments","setSegments","isLoadingData","setIsLoadingData","videoRef","playerRef","timelineRef","dragRef","isDragging","startX","startViewTime","recRange","setRecRange","start","end","then","res","list","Array","isArray","data","catch","console","error","concat","current","ro","ResizeObserver","entries","entry","contentRect","width","observe","clientWidth","disconnect","s","_playerRef$current","destroy","fetchData","serverDayStart","dayStart","localDayStart","correction","segs","map","Number","start_ts","end_ts","type","sort","a","b","loadSegments","e","i","setInterval","PLAYING","getCurrentTime","Math","abs","currentSeg","find","nextSeg","seekTo","clearInterval","handleCameraClick","id","performSeek","ts","_playerRef$current2","fitDay","handleMouseDown","clientX","handleMouseMove","dx","dt","newStart","dayEnd","handleMouseUp","rect","getBoundingClientRect","clickX","left","handleWheel","target","closest","preventDefault","mouseX","timeUnderMouse","factor","deltaY","newZoom","max","min","timeToPx","t","renderRuler","ticks","stepMs","x","push","style","position","top","height","borderLeft","children","fontSize","display","borderSizing","borderRight","flexDirection","fontWeight","borderBottom","letterSpacing","flex","overflowY","cam","onClick","name","length","overflow","alignItems","gap","_objectSpread","title","c","toLocaleDateString","value","onChange","minHeight","ref","objectFit","transform","_playerRef$current3","_playerRef$current4","pause","play","textAlign","fontFamily","toLocaleTimeString","className","onMouseUp","onMouseLeave","onMouseMove","onMouseDown","onWheel","w","bottom","zIndex"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/pages/PlaybackModern.js"],"sourcesContent":["import React, { useEffect, useState, useRef, useLayoutEffect } from \"react\";\r\nimport { useSearchParams, useNavigate } from \"react-router-dom\";\r\nimport API from \"../api\";\r\nimport PlaybackController, { PlayerStates } from \"../services/PlaybackController\";\r\n\r\n// --- ENTERPRISE THEME ---\r\nconst btnStyle = { background: \"#444\", color: \"#fff\", border: \"none\", padding: \"4px 8px\", borderRadius: 3, cursor: \"pointer\" };\r\n\r\nconst THEME = {\r\n    bg: \"#1e1e1e\",\r\n    sidebar: \"#252526\",\r\n    header: \"#2d2d2d\",\r\n    text: \"#ffffff\",\r\n    accent: \"#2196f3\",\r\n    segment: \"#4caf50\",\r\n    segmentEvent: \"#2196f3\",\r\n    rulerBg: \"#252526\",\r\n    playhead: \"#ff9800\",\r\n    panelBorder: \"#3e3e42\",\r\n    selectedItem: \"#37373d\"\r\n};\r\n\r\nexport default function PlaybackModern() {\r\n    const [searchParams] = useSearchParams();\r\n    const navigate = useNavigate();\r\n    const camId = searchParams.get(\"camId\");\r\n\r\n    // --- STATE ---\r\n    const [cameras, setCameras] = useState([]);\r\n    const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [playerState, setPlayerState] = useState(PlayerStates.IDLE);\r\n\r\n    // --- TIMELINE STATE ---\r\n    const [currentTimeMs, setCurrentTimeMs] = useState(Date.now());\r\n    const [viewportStartMs, setViewportStartMs] = useState(new Date().setHours(0, 0, 0, 0));\r\n    const [zoomPxPerSec, setZoomPxPerSec] = useState(1000 / 86400); // Fit Day Default\r\n    const [containerWidth, setContainerWidth] = useState(1000);\r\n    const [segments, setSegments] = useState([]);\r\n    const [isLoadingData, setIsLoadingData] = useState(false);\r\n\r\n    const videoRef = useRef(null);\r\n    const playerRef = useRef(null);\r\n    const timelineRef = useRef(null);\r\n    const dragRef = useRef({ isDragging: false, startX: 0, startViewTime: 0 });\r\n\r\n    const [recRange, setRecRange] = useState({ start: null, end: null });\r\n\r\n    // --- DATA SETUP ---\r\n    useEffect(() => {\r\n        // Fetch Camera List\r\n        API.get('/cameras').then(res => {\r\n            const list = Array.isArray(res.data) ? res.data : [];\r\n            setCameras(list);\r\n        }).catch(console.error);\r\n    }, []);\r\n\r\n    // Fetch Recording Range\r\n    useEffect(() => {\r\n        if (!camId) return;\r\n        API.get(`/api/playback/range/${camId}`).then(res => {\r\n            setRecRange(res.data);\r\n        }).catch(console.error);\r\n    }, [camId]);\r\n\r\n    // ... existing useEffects ...\r\n\r\n    useEffect(() => {\r\n        if (selectedDate) {\r\n            const start = new Date(selectedDate).setHours(0, 0, 0, 0);\r\n            setViewportStartMs(start);\r\n            // Set Current Time to middle of day or Start? Start (00:00) makes sense for review.\r\n            setCurrentTimeMs(start + 86400000 / 2); // Noon\r\n        }\r\n    }, [selectedDate]);\r\n\r\n    useLayoutEffect(() => {\r\n        if (!timelineRef.current) return;\r\n        // ResizeObserver for robust width detection\r\n        const ro = new ResizeObserver(entries => {\r\n            for (let entry of entries) {\r\n                if (entry.contentRect.width > 0) setContainerWidth(entry.contentRect.width);\r\n            }\r\n        });\r\n        ro.observe(timelineRef.current);\r\n        // Initial set\r\n        setContainerWidth(timelineRef.current.clientWidth || 1000);\r\n        return () => ro.disconnect();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (videoRef.current && camId) {\r\n            playerRef.current = new PlaybackController(videoRef.current, camId, (s) => setPlayerState(s));\r\n            return () => playerRef.current?.destroy();\r\n        }\r\n    }, [camId]);\r\n\r\n    useEffect(() => {\r\n        if (!camId || !selectedDate) return;\r\n        const fetchData = async () => {\r\n            setIsLoadingData(true);\r\n            setSegments([]);\r\n            try {\r\n                const res = await API.get(`/api/playback/timeline-day/${camId}/${selectedDate}`);\r\n                const data = res.data;\r\n                const serverDayStart = data.dayStart;\r\n\r\n                const localDayStart = new Date(selectedDate).setHours(0, 0, 0, 0);\r\n                let correction = 0;\r\n                if (serverDayStart > 0) {\r\n                    correction = localDayStart - serverDayStart;\r\n                }\r\n\r\n                const segs = (data.segments || []).map(s => ({\r\n                    start: Number(s.start_ts) + correction,\r\n                    end: Number(s.end_ts) + correction,\r\n                    type: 'normal'\r\n                })).sort((a, b) => a.start - b.start);\r\n\r\n                setSegments(segs);\r\n                if (playerRef.current) playerRef.current.loadSegments(segs);\r\n\r\n                setViewportStartMs(localDayStart);\r\n                if (containerWidth > 0) setZoomPxPerSec(containerWidth / 86400);\r\n\r\n            } catch (e) { console.error(e); } finally { setIsLoadingData(false); }\r\n        };\r\n        fetchData();\r\n    }, [camId, selectedDate, containerWidth]);\r\n\r\n    // --- SYNC LOOP ---\r\n    useEffect(() => {\r\n        const i = setInterval(() => {\r\n            if (playerState === PlayerStates.PLAYING && playerRef.current) {\r\n                const now = playerRef.current.getCurrentTime();\r\n                if (Math.abs(now - currentTimeMs) > 200) setCurrentTimeMs(now);\r\n\r\n                // Gap Skip\r\n                const currentSeg = segments.find(s => now >= s.start && now < s.end);\r\n                if (currentSeg && (currentSeg.end - now) < 500) {\r\n                    const nextSeg = segments.find(s => s.start >= currentSeg.end);\r\n                    if (nextSeg && nextSeg.start - currentSeg.end > 1000) {\r\n                        playerRef.current.seekTo(nextSeg.start);\r\n                    }\r\n                }\r\n            }\r\n        }, 100);\r\n        return () => clearInterval(i);\r\n    }, [playerState, currentTimeMs, segments]);\r\n\r\n    // --- ACTIONS ---\r\n    const handleCameraClick = (id) => {\r\n        navigate(`/playback?camId=${id}`);\r\n    };\r\n\r\n    const performSeek = (ts) => {\r\n        setCurrentTimeMs(ts);\r\n        playerRef.current?.seekTo(ts);\r\n    };\r\n\r\n    const fitDay = () => {\r\n        const start = new Date(selectedDate).setHours(0, 0, 0, 0);\r\n        setViewportStartMs(start);\r\n        setZoomPxPerSec(containerWidth / 86400);\r\n    };\r\n\r\n    // --- MOUSE HANDLERS (Constrained Pan) ---\r\n    const handleMouseDown = (e) => {\r\n        dragRef.current = { isDragging: true, startX: e.clientX, startViewTime: viewportStartMs };\r\n    };\r\n\r\n    const handleMouseMove = (e) => {\r\n        if (!dragRef.current.isDragging) return;\r\n        const dx = e.clientX - dragRef.current.startX;\r\n        const dt = -(dx / zoomPxPerSec) * 1000;\r\n\r\n        let newStart = dragRef.current.startViewTime + dt;\r\n\r\n        // CONSTRAIN TO DAY BOUNDARIES (User Request: \"Nu trece de la o zi la alta\")\r\n        const dayStart = new Date(selectedDate).setHours(0, 0, 0, 0);\r\n        const dayEnd = dayStart + 86400000;\r\n\r\n        // Allow zooming but keep view within day range roughly\r\n        // If zoomed in, we can pan. But don't pan past 00:00 or 24:00 relative to container?\r\n        // Actually, just clamp strictly.\r\n        if (newStart < dayStart) newStart = dayStart;\r\n        if (newStart > dayEnd - (containerWidth / zoomPxPerSec * 1000)) {\r\n            // newStart cannot ensure end > dayEnd completely if zoomed out?\r\n            // If zoomed out Max (fit day), newStart is dayStart.\r\n            // If zoomed in, restrict right edge.\r\n            // Let's just create a soft clamp for left side 00:00\r\n        }\r\n        setViewportStartMs(newStart);\r\n    };\r\n\r\n    const handleMouseUp = (e) => {\r\n        dragRef.current.isDragging = false;\r\n        if (Math.abs(e.clientX - dragRef.current.startX) < 5) {\r\n            const rect = timelineRef.current.getBoundingClientRect();\r\n            const clickX = e.clientX - rect.left;\r\n            const ts = viewportStartMs + (clickX / zoomPxPerSec) * 1000;\r\n            performSeek(ts);\r\n        }\r\n    };\r\n\r\n    const handleWheel = (e) => {\r\n        if (e.target.closest('.timeline-area')) {\r\n            e.preventDefault();\r\n            const rect = timelineRef.current.getBoundingClientRect();\r\n            const mouseX = e.clientX - rect.left;\r\n            const timeUnderMouse = viewportStartMs + (mouseX / zoomPxPerSec) * 1000;\r\n            const factor = e.deltaY > 0 ? 0.9 : 1.1;\r\n            const newZoom = Math.max(containerWidth / 86400, Math.min(5.0, zoomPxPerSec * factor));\r\n\r\n            // Calc new start to keep mouse time static\r\n            let newStart = timeUnderMouse - (mouseX / newZoom) * 1000;\r\n\r\n            // Constrain\r\n            const dayStart = new Date(selectedDate).setHours(0, 0, 0, 0);\r\n            if (newStart < dayStart) newStart = dayStart;\r\n\r\n            setZoomPxPerSec(newZoom);\r\n            setViewportStartMs(newStart);\r\n        }\r\n    };\r\n\r\n    // --- RENDER HELPERS ---\r\n    const timeToPx = (t) => (t - viewportStartMs) / 1000 * zoomPxPerSec;\r\n\r\n    const renderRuler = () => {\r\n        const ticks = [];\r\n        const stepMs = (3600 * 1000); // Fixed 1 Hour ticks for \"0-24\" stability\r\n        const dayStart = new Date(selectedDate).setHours(0, 0, 0, 0);\r\n\r\n        for (let i = 0; i <= 24; i++) {\r\n            const t = dayStart + i * stepMs;\r\n            const x = timeToPx(t);\r\n            if (x < -20 || x > containerWidth) continue;\r\n            ticks.push(\r\n                <div key={i} style={{ position: 'absolute', left: x, top: 0, height: 25, borderLeft: '1px solid #666' }}>\r\n                    <div style={{ position: 'absolute', top: 2, left: 4, fontSize: 11, color: '#aaa' }}>{i}:00</div>\r\n                </div>\r\n            );\r\n        }\r\n        return ticks;\r\n    };\r\n\r\n    return (\r\n        <div style={{ display: 'flex', width: '100%', height: '100%', background: THEME.bg, color: THEME.text }}>\r\n\r\n            {/* SIDEBAR - CAMERA LIST */}\r\n            <div style={{ width: 250, background: THEME.sidebar, borderSizing: 'border-box', borderRight: `1px solid ${THEME.panelBorder}`, display: 'flex', flexDirection: 'column' }}>\r\n                <div style={{ padding: \"12px 16px\", fontWeight: 'bold', borderBottom: `1px solid ${THEME.panelBorder}`, color: THEME.accent, fontSize: 12, letterSpacing: 1 }}>CHANNELS</div>\r\n                <div style={{ flex: 1, overflowY: 'auto' }}>\r\n                    {cameras.map(cam => (\r\n                        <div key={cam.id}\r\n                            onClick={() => handleCameraClick(cam.id)}\r\n                            style={{\r\n                                padding: '10px 16px', cursor: 'pointer', fontSize: 13,\r\n                                borderBottom: `1px solid rgba(255,255,255,0.02)`,\r\n                                background: camId === cam.id ? THEME.selectedItem : 'transparent',\r\n                                color: camId === cam.id ? THEME.accent : '#aaa',\r\n                                borderLeft: camId === cam.id ? `3px solid ${THEME.accent}` : '3px solid transparent'\r\n                            }}>\r\n                            {cam.name || cam.id}\r\n                        </div>\r\n                    ))}\r\n                    {cameras.length === 0 && <div style={{ padding: 10, color: '#888' }}>No cameras found</div>}\r\n                </div>\r\n            </div>\r\n\r\n            {/* MAIN CONTENT */}\r\n            <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>\r\n                <header style={{ height: 44, background: THEME.header, display: 'flex', alignItems: 'center', padding: '0 12px', borderBottom: `1px solid ${THEME.panelBorder}`, gap: 15 }}>\r\n                    <button\r\n                        onClick={() => navigate('/live')}\r\n                        style={{ ...btnStyle, background: 'transparent', padding: '4px 8px', fontSize: 16 }}\r\n                        title=\"Back to Live\"\r\n                    >\r\n                        ⬅️\r\n                    </button>\r\n                    <span style={{ fontWeight: 'bold', color: THEME.accent, fontSize: 14 }}>ARHIVĂ VMS</span>\r\n                    {camId && (\r\n                        <span style={{ fontSize: 13, background: 'rgba(255,255,255,0.05)', padding: '2px 8px', borderRadius: 4 }}>\r\n                            {cameras.find(c => c.id === camId)?.name || camId}\r\n                        </span>\r\n                    )}\r\n                    {recRange.start && (\r\n                        <span style={{ fontSize: 11, color: '#888' }}>\r\n                            ({new Date(recRange.start).toLocaleDateString()} - {new Date(recRange.end).toLocaleDateString()})\r\n                        </span>\r\n                    )}\r\n                    <div style={{ flex: 1 }} />\r\n                    <input type=\"date\" value={selectedDate} onChange={e => setSelectedDate(e.target.value)}\r\n                        style={{ background: '#333', color: '#fff', border: '1px solid #444', borderRadius: 4, padding: '4px 8px', fontSize: 12 }} />\r\n                </header>\r\n\r\n                <div style={{ flex: 1, position: 'relative', background: '#000', overflow: 'hidden', minHeight: 0 }}>\r\n                    <video ref={videoRef} style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', objectFit: 'contain' }} />\r\n                    {!camId && <div style={{ position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', color: '#aaa' }}>Select a Camera</div>}\r\n                </div>\r\n\r\n                <div style={{ height: 48, background: '#252526', display: 'flex', alignItems: 'center', padding: '0 10px', gap: 10 }}>\r\n                    <button style={btnStyle} onClick={() => performSeek(currentTimeMs - 5000)}>⏪</button>\r\n                    <button style={btnStyle} onClick={() => playerState === PlayerStates.PLAYING ? playerRef.current?.pause() : playerRef.current?.play()}>\r\n                        {playerState === PlayerStates.PLAYING ? \"PAUSE\" : \"PLAY\"}\r\n                    </button>\r\n                    <button style={btnStyle} onClick={() => performSeek(currentTimeMs + 5000)}>⏩</button>\r\n                    <span style={{ flex: 1, textAlign: 'center', fontFamily: 'monospace' }}>\r\n                        {new Date(currentTimeMs).toLocaleTimeString()}\r\n                    </span>\r\n                    <button style={btnStyle} onClick={fitDay}>24H</button>\r\n                </div>\r\n\r\n                <div className=\"timeline-area\" ref={timelineRef}\r\n                    style={{ height: 100, background: THEME.rulerBg, position: 'relative', overflow: 'hidden' }}\r\n                    onMouseUp={handleMouseUp} onMouseLeave={handleMouseUp} onMouseMove={handleMouseMove} onMouseDown={handleMouseDown} onWheel={handleWheel}\r\n                >\r\n                    <div style={{ height: 25, borderBottom: '1px solid #444' }}>{renderRuler()}</div>\r\n                    <div style={{ position: 'relative', top: 5, height: 40 }}>\r\n                        {segments.map((s, i) => {\r\n                            const x = timeToPx(s.start);\r\n                            const w = Math.max(2, (s.end - s.start) / 1000 * zoomPxPerSec);\r\n                            if (x + w < 0 || x > containerWidth) return null;\r\n                            return <div key={i} style={{ position: 'absolute', left: x, width: w, height: '100%', background: THEME.segment }} />\r\n                        })}\r\n                    </div>\r\n                    <div style={{ position: 'absolute', left: timeToPx(currentTimeMs), top: 0, bottom: 0, width: 2, background: THEME.playhead, zIndex: 10 }} />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}