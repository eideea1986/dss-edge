{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useSearchParams}from\"react-router-dom\";import API from\"../api\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const styles=\"\\n.playback-container {\\n    height: 100vh;\\n    display: flex;\\n    flex-direction: column;\\n    background: #0a0a0a;\\n    color: #eee;\\n    font-family: 'Inter', system-ui, sans-serif;\\n}\\n\\n.playback-header {\\n    height: 50px;\\n    background: #1a1a1a;\\n    border-bottom: 1px solid #333;\\n    display: flex;\\n    align-items: center;\\n    padding: 0 20px;\\n    gap: 15px;\\n}\\n\\n.btn {\\n    background: #333;\\n    color: #fff;\\n    border: 1px solid #444;\\n    padding: 8px 16px;\\n    border-radius: 4px;\\n    cursor: pointer;\\n    transition: all 0.2s;\\n}\\n\\n.btn:hover {\\n    background: #444;\\n}\\n\\n.btn-play {\\n    background: #2ecc71;\\n    border-color: #27ae60;\\n}\\n\\n.btn-stop {\\n    background: #e74c3c;\\n    border-color: #c0392b;\\n}\\n\\n.video-container {\\n    flex: 1;\\n    background: #000;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n    position: relative;\\n}\\n\\n.video-player {\\n    width: 100%;\\n    height: 100%;\\n    object-fit: contain;\\n}\\n\\n.timeline-container {\\n    height: 120px;\\n    background: #151515;\\n    border-top: 1px solid #333;\\n    padding: 10px 20px;\\n}\\n\\n.timeline-bar {\\n    position: relative;\\n    height: 50px;\\n    background: #222;\\n    border-radius: 4px;\\n    margin-top: 10px;\\n    cursor: pointer;\\n}\\n\\n.timeline-segment {\\n    position: absolute;\\n    height: 100%;\\n    background: #2ecc71;\\n    opacity: 0.8;\\n}\\n\\n.status-text {\\n    position: absolute;\\n    top: 50%;\\n    left: 50%;\\n    transform: translate(-50%, -50%);\\n    color: #888;\\n    font-size: 1.2rem;\\n}\\n\";export default function Playback(){const[params]=useSearchParams();const camId=params.get(\"camId\");const[segments,setSegments]=useState([]);const[isPlaying,setIsPlaying]=useState(false);const[streamUrl,setStreamUrl]=useState(null);// Fetch timeline\nuseEffect(()=>{if(!camId)return;API.get(\"/playback/timeline/\".concat(camId)).then(res=>{setSegments(res.data.segments||[]);}).catch(e=>{console.error(\"Timeline fetch error:\",e);setSegments([]);});},[camId]);const startPlayback=async()=>{if(!segments||segments.length===0){alert(\"No recordings available\");return;}// Use first and last segment for time range\nconst from=segments[0].start_ts;const to=segments[segments.length-1].end_ts||Date.now();console.log(\"[Playback] Starting: \".concat(from,\" -> \").concat(to));try{const res=await API.post('/playback/start',{camId,from,to,speed:1.0});console.log(\"[Playback] Started:\",res.data);// Connect to RTSP stream via go2rtc WebRTC\n// go2rtc will pull from rtsp://127.0.0.1:8554/playback\nconst webrtcUrl=\"http://\".concat(window.location.hostname,\":1984/api/ws?src=playback\");setStreamUrl(webrtcUrl);setIsPlaying(true);}catch(e){console.error(\"[Playback] Error:\",e);alert(\"Playback error: \".concat(e.message));}};const stopPlayback=async()=>{try{await API.post('/playback/stop');setStreamUrl(null);setIsPlaying(false);}catch(e){console.error(\"[Playback] Stop error:\",e);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"playback-container\",children:[/*#__PURE__*/_jsx(\"style\",{children:styles}),/*#__PURE__*/_jsxs(\"div\",{className:\"playback-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:()=>window.location.href='/',children:\"\\u2190 Back\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:\"bold\"},children:camId}),/*#__PURE__*/_jsx(\"div\",{style:{color:\"#3498db\",fontSize:\"0.85rem\"},children:\"Enterprise Playback\"}),/*#__PURE__*/_jsx(\"div\",{style:{marginLeft:\"auto\",display:\"flex\",gap:\"10px\"},children:!isPlaying?/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-play\",onClick:startPlayback,children:\"\\u25B6 PLAY\"}):/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-stop\",onClick:stopPlayback,children:\"\\u25A0 STOP\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"video-container\",children:streamUrl?/*#__PURE__*/_jsx(\"iframe\",{src:streamUrl,className:\"video-player\",allow:\"camera;microphone;fullscreen;picture-in-picture;display-capture;autoplay\",style:{border:'none'},title:\"Playback Stream\"}):/*#__PURE__*/_jsx(\"div\",{className:\"status-text\",children:segments.length===0?\"No recordings available\":\"Press PLAY to start playback\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"timeline-container\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:\"0.8rem\",color:\"#888\",marginBottom:\"5px\"},children:[\"Timeline: \",segments.length,\" segments\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"timeline-bar\",children:segments.map((seg,idx)=>/*#__PURE__*/_jsx(\"div\",{className:\"timeline-segment\",style:{left:\"\".concat(idx/segments.length*100,\"%\"),width:\"\".concat(1/segments.length*100,\"%\")}},idx))})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useSearchParams","API","jsx","_jsx","jsxs","_jsxs","styles","Playback","params","camId","get","segments","setSegments","isPlaying","setIsPlaying","streamUrl","setStreamUrl","concat","then","res","data","catch","e","console","error","startPlayback","length","alert","from","start_ts","to","end_ts","Date","now","log","post","speed","webrtcUrl","window","location","hostname","message","stopPlayback","className","children","onClick","href","style","fontWeight","color","fontSize","marginLeft","display","gap","src","allow","border","title","marginBottom","map","seg","idx","left","width"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/pages/Playback.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useSearchParams } from \"react-router-dom\";\r\nimport API from \"../api\";\r\n\r\nconst styles = `\r\n.playback-container {\r\n    height: 100vh;\r\n    display: flex;\r\n    flex-direction: column;\r\n    background: #0a0a0a;\r\n    color: #eee;\r\n    font-family: 'Inter', system-ui, sans-serif;\r\n}\r\n\r\n.playback-header {\r\n    height: 50px;\r\n    background: #1a1a1a;\r\n    border-bottom: 1px solid #333;\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 0 20px;\r\n    gap: 15px;\r\n}\r\n\r\n.btn {\r\n    background: #333;\r\n    color: #fff;\r\n    border: 1px solid #444;\r\n    padding: 8px 16px;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n}\r\n\r\n.btn:hover {\r\n    background: #444;\r\n}\r\n\r\n.btn-play {\r\n    background: #2ecc71;\r\n    border-color: #27ae60;\r\n}\r\n\r\n.btn-stop {\r\n    background: #e74c3c;\r\n    border-color: #c0392b;\r\n}\r\n\r\n.video-container {\r\n    flex: 1;\r\n    background: #000;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    position: relative;\r\n}\r\n\r\n.video-player {\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: contain;\r\n}\r\n\r\n.timeline-container {\r\n    height: 120px;\r\n    background: #151515;\r\n    border-top: 1px solid #333;\r\n    padding: 10px 20px;\r\n}\r\n\r\n.timeline-bar {\r\n    position: relative;\r\n    height: 50px;\r\n    background: #222;\r\n    border-radius: 4px;\r\n    margin-top: 10px;\r\n    cursor: pointer;\r\n}\r\n\r\n.timeline-segment {\r\n    position: absolute;\r\n    height: 100%;\r\n    background: #2ecc71;\r\n    opacity: 0.8;\r\n}\r\n\r\n.status-text {\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    transform: translate(-50%, -50%);\r\n    color: #888;\r\n    font-size: 1.2rem;\r\n}\r\n`;\r\n\r\nexport default function Playback() {\r\n    const [params] = useSearchParams();\r\n    const camId = params.get(\"camId\");\r\n\r\n    const [segments, setSegments] = useState([]);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [streamUrl, setStreamUrl] = useState(null);\r\n\r\n    // Fetch timeline\r\n    useEffect(() => {\r\n        if (!camId) return;\r\n\r\n        API.get(`/playback/timeline/${camId}`)\r\n            .then(res => {\r\n                setSegments(res.data.segments || []);\r\n            })\r\n            .catch(e => {\r\n                console.error(\"Timeline fetch error:\", e);\r\n                setSegments([]);\r\n            });\r\n    }, [camId]);\r\n\r\n    const startPlayback = async () => {\r\n        if (!segments || segments.length === 0) {\r\n            alert(\"No recordings available\");\r\n            return;\r\n        }\r\n\r\n        // Use first and last segment for time range\r\n        const from = segments[0].start_ts;\r\n        const to = segments[segments.length - 1].end_ts || Date.now();\r\n\r\n        console.log(`[Playback] Starting: ${from} -> ${to}`);\r\n\r\n        try {\r\n            const res = await API.post('/playback/start', {\r\n                camId,\r\n                from,\r\n                to,\r\n                speed: 1.0\r\n            });\r\n\r\n            console.log(\"[Playback] Started:\", res.data);\r\n\r\n            // Connect to RTSP stream via go2rtc WebRTC\r\n            // go2rtc will pull from rtsp://127.0.0.1:8554/playback\r\n            const webrtcUrl = `http://${window.location.hostname}:1984/api/ws?src=playback`;\r\n\r\n            setStreamUrl(webrtcUrl);\r\n            setIsPlaying(true);\r\n\r\n        } catch (e) {\r\n            console.error(\"[Playback] Error:\", e);\r\n            alert(`Playback error: ${e.message}`);\r\n        }\r\n    };\r\n\r\n    const stopPlayback = async () => {\r\n        try {\r\n            await API.post('/playback/stop');\r\n            setStreamUrl(null);\r\n            setIsPlaying(false);\r\n        } catch (e) {\r\n            console.error(\"[Playback] Stop error:\", e);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"playback-container\">\r\n            <style>{styles}</style>\r\n\r\n            {/* Header */}\r\n            <div className=\"playback-header\">\r\n                <button className=\"btn\" onClick={() => window.location.href = '/'}>\r\n                    ← Back\r\n                </button>\r\n                <div style={{ fontWeight: \"bold\" }}>{camId}</div>\r\n                <div style={{ color: \"#3498db\", fontSize: \"0.85rem\" }}>Enterprise Playback</div>\r\n\r\n                <div style={{ marginLeft: \"auto\", display: \"flex\", gap: \"10px\" }}>\r\n                    {!isPlaying ? (\r\n                        <button className=\"btn btn-play\" onClick={startPlayback}>\r\n                            ▶ PLAY\r\n                        </button>\r\n                    ) : (\r\n                        <button className=\"btn btn-stop\" onClick={stopPlayback}>\r\n                            ■ STOP\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Video Player */}\r\n            <div className=\"video-container\">\r\n                {streamUrl ? (\r\n                    <iframe\r\n                        src={streamUrl}\r\n                        className=\"video-player\"\r\n                        allow=\"camera;microphone;fullscreen;picture-in-picture;display-capture;autoplay\"\r\n                        style={{ border: 'none' }}\r\n                        title=\"Playback Stream\"\r\n                    />\r\n                ) : (\r\n                    <div className=\"status-text\">\r\n                        {segments.length === 0\r\n                            ? \"No recordings available\"\r\n                            : \"Press PLAY to start playback\"}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Timeline */}\r\n            <div className=\"timeline-container\">\r\n                <div style={{ fontSize: \"0.8rem\", color: \"#888\", marginBottom: \"5px\" }}>\r\n                    Timeline: {segments.length} segments\r\n                </div>\r\n                <div className=\"timeline-bar\">\r\n                    {segments.map((seg, idx) => (\r\n                        <div\r\n                            key={idx}\r\n                            className=\"timeline-segment\"\r\n                            style={{\r\n                                left: `${(idx / segments.length) * 100}%`,\r\n                                width: `${(1 / segments.length) * 100}%`\r\n                            }}\r\n                        />\r\n                    ))}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}