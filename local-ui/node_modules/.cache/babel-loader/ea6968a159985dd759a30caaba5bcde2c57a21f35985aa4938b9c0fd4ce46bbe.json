{"ast":null,"code":"import _objectSpread from\"I:/dispecerat/github_release/dss-edge/local-ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";export default function RecorderPlayer(_ref){let{camId,hlsUrl:propHlsUrl,style}=_ref;const videoRef=useRef(null);const hlsRef=useRef(null);useEffect(()=>{const video=videoRef.current;if(!video)return;const hlsUrl=propHlsUrl||\"/api/playback/live/\".concat(camId,\".m3u8\");const initHls=()=>{if(window.Hls&&window.Hls.isSupported()){if(hlsRef.current)hlsRef.current.destroy();const hls=new window.Hls({debug:false,enableWorker:true,manifestLoadingTimeOut:10000});hls.loadSource(hlsUrl);hls.attachMedia(video);hls.on(window.Hls.Events.MANIFEST_PARSED,()=>{console.log('[RecorderPlayer] Manifest parsed');video.play().catch(e=>console.warn(\"Autoplay blocked\",e));});hls.on(window.Hls.Events.MANIFEST_LOADED,(event,data)=>{console.log('[RecorderPlayer] Manifest loaded, live:',data.details.live);});hls.on(window.Hls.Events.ERROR,(event,data)=>{if(data.fatal){console.error('[RecorderPlayer] Fatal error:',data.type,data.details);switch(data.type){case window.Hls.ErrorTypes.NETWORK_ERROR:console.log('[RecorderPlayer] Recovering from network error...');setTimeout(()=>hls.startLoad(),1000);break;case window.Hls.ErrorTypes.MEDIA_ERROR:console.log('[RecorderPlayer] Recovering from media error...');hls.recoverMediaError();break;default:console.error('[RecorderPlayer] Unrecoverable error');hls.destroy();break;}}});hlsRef.current=hls;}else if(video.canPlayType('application/vnd.apple.mpegurl')){video.src=hlsUrl;video.addEventListener('loadedmetadata',()=>video.play());}};if(!window.Hls&&typeof Hls==='undefined'){const script=document.createElement('script');script.src=\"https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js\";script.onload=initHls;document.head.appendChild(script);}else{initHls();}return()=>{if(hlsRef.current)hlsRef.current.destroy();};},[camId]);return/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},style),{},{position:'relative',background:'#000',overflow:'hidden'}),children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,style:{width:'100%',height:'100%',objectFit:'contain',display:'block'},autoPlay:true,muted:true,playsInline:true})});}","map":{"version":3,"names":["React","useEffect","useRef","jsx","_jsx","RecorderPlayer","_ref","camId","hlsUrl","propHlsUrl","style","videoRef","hlsRef","video","current","concat","initHls","window","Hls","isSupported","destroy","hls","debug","enableWorker","manifestLoadingTimeOut","loadSource","attachMedia","on","Events","MANIFEST_PARSED","console","log","play","catch","e","warn","MANIFEST_LOADED","event","data","details","live","ERROR","fatal","error","type","ErrorTypes","NETWORK_ERROR","setTimeout","startLoad","MEDIA_ERROR","recoverMediaError","canPlayType","src","addEventListener","script","document","createElement","onload","head","appendChild","_objectSpread","position","background","overflow","children","ref","width","height","objectFit","display","autoPlay","muted","playsInline"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/components/RecorderPlayer.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\n\r\nexport default function RecorderPlayer({ camId, hlsUrl: propHlsUrl, style }) {\r\n    const videoRef = useRef(null);\r\n    const hlsRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        const video = videoRef.current;\r\n        if (!video) return;\r\n\r\n        const hlsUrl = propHlsUrl || `/api/playback/live/${camId}.m3u8`;\r\n\r\n        const initHls = () => {\r\n            if (window.Hls && window.Hls.isSupported()) {\r\n                if (hlsRef.current) hlsRef.current.destroy();\r\n\r\n                const hls = new window.Hls({\r\n                    debug: false,\r\n                    enableWorker: true,\r\n                    manifestLoadingTimeOut: 10000,\r\n                });\r\n\r\n                hls.loadSource(hlsUrl);\r\n                hls.attachMedia(video);\r\n\r\n                hls.on(window.Hls.Events.MANIFEST_PARSED, () => {\r\n                    console.log('[RecorderPlayer] Manifest parsed');\r\n                    video.play().catch(e => console.warn(\"Autoplay blocked\", e));\r\n                });\r\n\r\n                hls.on(window.Hls.Events.MANIFEST_LOADED, (event, data) => {\r\n                    console.log('[RecorderPlayer] Manifest loaded, live:', data.details.live);\r\n                });\r\n\r\n                hls.on(window.Hls.Events.ERROR, (event, data) => {\r\n                    if (data.fatal) {\r\n                        console.error('[RecorderPlayer] Fatal error:', data.type, data.details);\r\n                        switch (data.type) {\r\n                            case window.Hls.ErrorTypes.NETWORK_ERROR:\r\n                                console.log('[RecorderPlayer] Recovering from network error...');\r\n                                setTimeout(() => hls.startLoad(), 1000);\r\n                                break;\r\n                            case window.Hls.ErrorTypes.MEDIA_ERROR:\r\n                                console.log('[RecorderPlayer] Recovering from media error...');\r\n                                hls.recoverMediaError();\r\n                                break;\r\n                            default:\r\n                                console.error('[RecorderPlayer] Unrecoverable error');\r\n                                hls.destroy();\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                hlsRef.current = hls;\r\n            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {\r\n                video.src = hlsUrl;\r\n                video.addEventListener('loadedmetadata', () => video.play());\r\n            }\r\n        };\r\n\r\n        if (!window.Hls && typeof Hls === 'undefined') {\r\n            const script = document.createElement('script');\r\n            script.src = \"https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js\";\r\n            script.onload = initHls;\r\n            document.head.appendChild(script);\r\n        } else {\r\n            initHls();\r\n        }\r\n\r\n        return () => {\r\n            if (hlsRef.current) hlsRef.current.destroy();\r\n        };\r\n    }, [camId]);\r\n\r\n    return (\r\n        <div style={{ ...style, position: 'relative', background: '#000', overflow: 'hidden' }}>\r\n            <video\r\n                ref={videoRef}\r\n                style={{\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    objectFit: 'contain',\r\n                    display: 'block'\r\n                }}\r\n                autoPlay\r\n                muted\r\n                playsInline\r\n            />\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}