{"ast":null,"code":"export const PlayerStates = Object.freeze({\n  IDLE: \"IDLE\",\n  LOADING: \"LOADING\",\n  READY: \"READY\",\n  PLAYING: \"PLAYING\",\n  PAUSED: \"PAUSED\",\n  BUFFERING: \"BUFFERING\",\n  GAP: \"GAP\",\n  ERROR: \"ERROR\"\n});\nexport const PlayerEvents = Object.freeze({\n  LOAD_LIVE: \"LOAD_LIVE\",\n  LOAD_PLAYBACK: \"LOAD_PLAYBACK\",\n  METADATA_READY: \"METADATA_READY\",\n  VIDEO_TRACK_READY: \"VIDEO_TRACK_READY\",\n  PLAY: \"PLAY\",\n  PAUSE: \"PAUSE\",\n  SEEK: \"SEEK\",\n  BUFFER_EMPTY: \"BUFFER_EMPTY\",\n  BUFFER_FULL: \"BUFFER_FULL\",\n  GAP_DETECTED: \"GAP_DETECTED\",\n  GAP_RESOLVED: \"GAP_RESOLVED\",\n  END: \"END\",\n  ERROR: \"ERROR\",\n  RESET: \"RESET\"\n});\nexport class PlayerStateMachine {\n  constructor({\n    onStateChange,\n    onAction,\n    logger = console\n  }) {\n    this.state = PlayerStates.IDLE;\n    this.onStateChange = onStateChange;\n    this.onAction = onAction;\n    this.log = logger;\n  }\n  transition(next, payload) {\n    if (this.log && this.log.debug) {\n      this.log.debug(`[PLAYER FSM] ${this.state} -> ${next}`, payload || \"\");\n    } else {\n      // Fallback if logger doesn't have debug\n      console.log(`[PLAYER FSM] ${this.state} -> ${next}`, payload || \"\");\n    }\n    this.state = next;\n    if (this.onStateChange) this.onStateChange(next, payload);\n  }\n  dispatch(event, payload = {}) {\n    if (this.log && this.log.debug) {\n      this.log.debug(`[PLAYER FSM EVENT] ${event}`, payload);\n    }\n    switch (this.state) {\n      case PlayerStates.IDLE:\n        if (event === PlayerEvents.LOAD_LIVE || event === PlayerEvents.LOAD_PLAYBACK) {\n          this.transition(PlayerStates.LOADING, payload);\n          if (this.onAction) this.onAction(\"initStream\", payload);\n        }\n        break;\n      case PlayerStates.LOADING:\n        if (event === PlayerEvents.METADATA_READY) {\n          // metadata ok, but video not yet\n          return;\n        }\n        if (event === PlayerEvents.VIDEO_TRACK_READY) {\n          this.transition(PlayerStates.READY);\n        }\n        if (event === PlayerEvents.ERROR) {\n          this.transition(PlayerStates.ERROR, payload);\n        }\n        break;\n      case PlayerStates.READY:\n        if (event === PlayerEvents.PLAY) {\n          this.transition(PlayerStates.PLAYING);\n          if (this.onAction) this.onAction(\"play\");\n        }\n        if (event === PlayerEvents.SEEK) {\n          if (this.onAction) this.onAction(\"seek\", payload);\n        }\n        if (event === PlayerEvents.ERROR) {\n          this.transition(PlayerStates.ERROR, payload);\n        }\n        break;\n      case PlayerStates.PLAYING:\n        if (event === PlayerEvents.PAUSE) {\n          this.transition(PlayerStates.PAUSED);\n          if (this.onAction) this.onAction(\"pause\");\n        }\n        if (event === PlayerEvents.BUFFER_EMPTY) {\n          this.transition(PlayerStates.BUFFERING);\n        }\n        if (event === PlayerEvents.GAP_DETECTED) {\n          this.transition(PlayerStates.GAP, payload);\n          if (this.onAction) this.onAction(\"skipGap\", payload);\n        }\n        if (event === PlayerEvents.END) {\n          this.transition(PlayerStates.IDLE);\n        }\n        if (event === PlayerEvents.ERROR) {\n          this.transition(PlayerStates.ERROR, payload);\n        }\n        break;\n      case PlayerStates.BUFFERING:\n        if (event === PlayerEvents.BUFFER_FULL) {\n          this.transition(PlayerStates.PLAYING);\n        }\n        if (event === PlayerEvents.GAP_DETECTED) {\n          this.transition(PlayerStates.GAP, payload);\n        }\n        if (event === PlayerEvents.ERROR) {\n          this.transition(PlayerStates.ERROR, payload);\n        }\n        break;\n      case PlayerStates.GAP:\n        if (event === PlayerEvents.GAP_RESOLVED) {\n          this.transition(PlayerStates.BUFFERING);\n        }\n        if (event === PlayerEvents.END) {\n          this.transition(PlayerStates.IDLE);\n        }\n        break;\n      case PlayerStates.PAUSED:\n        if (event === PlayerEvents.PLAY) {\n          this.transition(PlayerStates.PLAYING);\n          if (this.onAction) this.onAction(\"play\");\n        }\n        if (event === PlayerEvents.SEEK) {\n          if (this.onAction) this.onAction(\"seek\", payload);\n        }\n        break;\n      case PlayerStates.ERROR:\n        if (event === PlayerEvents.RESET) {\n          this.transition(PlayerStates.IDLE);\n        }\n        break;\n      default:\n        console.error(\"Unknown state\", this.state);\n    }\n  }\n}","map":{"version":3,"names":["PlayerStates","Object","freeze","IDLE","LOADING","READY","PLAYING","PAUSED","BUFFERING","GAP","ERROR","PlayerEvents","LOAD_LIVE","LOAD_PLAYBACK","METADATA_READY","VIDEO_TRACK_READY","PLAY","PAUSE","SEEK","BUFFER_EMPTY","BUFFER_FULL","GAP_DETECTED","GAP_RESOLVED","END","RESET","PlayerStateMachine","constructor","onStateChange","onAction","logger","console","state","log","transition","next","payload","debug","dispatch","event","error"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/services/PlayerStateMachine.js"],"sourcesContent":["export const PlayerStates = Object.freeze({\r\n    IDLE: \"IDLE\",\r\n    LOADING: \"LOADING\",\r\n    READY: \"READY\",\r\n    PLAYING: \"PLAYING\",\r\n    PAUSED: \"PAUSED\",\r\n    BUFFERING: \"BUFFERING\",\r\n    GAP: \"GAP\",\r\n    ERROR: \"ERROR\"\r\n});\r\n\r\nexport const PlayerEvents = Object.freeze({\r\n    LOAD_LIVE: \"LOAD_LIVE\",\r\n    LOAD_PLAYBACK: \"LOAD_PLAYBACK\",\r\n    METADATA_READY: \"METADATA_READY\",\r\n    VIDEO_TRACK_READY: \"VIDEO_TRACK_READY\",\r\n    PLAY: \"PLAY\",\r\n    PAUSE: \"PAUSE\",\r\n    SEEK: \"SEEK\",\r\n    BUFFER_EMPTY: \"BUFFER_EMPTY\",\r\n    BUFFER_FULL: \"BUFFER_FULL\",\r\n    GAP_DETECTED: \"GAP_DETECTED\",\r\n    GAP_RESOLVED: \"GAP_RESOLVED\",\r\n    END: \"END\",\r\n    ERROR: \"ERROR\",\r\n    RESET: \"RESET\"\r\n});\r\n\r\nexport class PlayerStateMachine {\r\n    constructor({ onStateChange, onAction, logger = console }) {\r\n        this.state = PlayerStates.IDLE;\r\n        this.onStateChange = onStateChange;\r\n        this.onAction = onAction;\r\n        this.log = logger;\r\n    }\r\n\r\n    transition(next, payload) {\r\n        if (this.log && this.log.debug) {\r\n            this.log.debug(`[PLAYER FSM] ${this.state} -> ${next}`, payload || \"\");\r\n        } else {\r\n            // Fallback if logger doesn't have debug\r\n            console.log(`[PLAYER FSM] ${this.state} -> ${next}`, payload || \"\");\r\n        }\r\n        this.state = next;\r\n        if (this.onStateChange) this.onStateChange(next, payload);\r\n    }\r\n\r\n    dispatch(event, payload = {}) {\r\n        if (this.log && this.log.debug) {\r\n            this.log.debug(`[PLAYER FSM EVENT] ${event}`, payload);\r\n        }\r\n\r\n        switch (this.state) {\r\n            case PlayerStates.IDLE:\r\n                if (event === PlayerEvents.LOAD_LIVE || event === PlayerEvents.LOAD_PLAYBACK) {\r\n                    this.transition(PlayerStates.LOADING, payload);\r\n                    if (this.onAction) this.onAction(\"initStream\", payload);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.LOADING:\r\n                if (event === PlayerEvents.METADATA_READY) {\r\n                    // metadata ok, but video not yet\r\n                    return;\r\n                }\r\n                if (event === PlayerEvents.VIDEO_TRACK_READY) {\r\n                    this.transition(PlayerStates.READY);\r\n                }\r\n                if (event === PlayerEvents.ERROR) {\r\n                    this.transition(PlayerStates.ERROR, payload);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.READY:\r\n                if (event === PlayerEvents.PLAY) {\r\n                    this.transition(PlayerStates.PLAYING);\r\n                    if (this.onAction) this.onAction(\"play\");\r\n                }\r\n                if (event === PlayerEvents.SEEK) {\r\n                    if (this.onAction) this.onAction(\"seek\", payload);\r\n                }\r\n                if (event === PlayerEvents.ERROR) {\r\n                    this.transition(PlayerStates.ERROR, payload);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.PLAYING:\r\n                if (event === PlayerEvents.PAUSE) {\r\n                    this.transition(PlayerStates.PAUSED);\r\n                    if (this.onAction) this.onAction(\"pause\");\r\n                }\r\n                if (event === PlayerEvents.BUFFER_EMPTY) {\r\n                    this.transition(PlayerStates.BUFFERING);\r\n                }\r\n                if (event === PlayerEvents.GAP_DETECTED) {\r\n                    this.transition(PlayerStates.GAP, payload);\r\n                    if (this.onAction) this.onAction(\"skipGap\", payload);\r\n                }\r\n                if (event === PlayerEvents.END) {\r\n                    this.transition(PlayerStates.IDLE);\r\n                }\r\n                if (event === PlayerEvents.ERROR) {\r\n                    this.transition(PlayerStates.ERROR, payload);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.BUFFERING:\r\n                if (event === PlayerEvents.BUFFER_FULL) {\r\n                    this.transition(PlayerStates.PLAYING);\r\n                }\r\n                if (event === PlayerEvents.GAP_DETECTED) {\r\n                    this.transition(PlayerStates.GAP, payload);\r\n                }\r\n                if (event === PlayerEvents.ERROR) {\r\n                    this.transition(PlayerStates.ERROR, payload);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.GAP:\r\n                if (event === PlayerEvents.GAP_RESOLVED) {\r\n                    this.transition(PlayerStates.BUFFERING);\r\n                }\r\n                if (event === PlayerEvents.END) {\r\n                    this.transition(PlayerStates.IDLE);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.PAUSED:\r\n                if (event === PlayerEvents.PLAY) {\r\n                    this.transition(PlayerStates.PLAYING);\r\n                    if (this.onAction) this.onAction(\"play\");\r\n                }\r\n                if (event === PlayerEvents.SEEK) {\r\n                    if (this.onAction) this.onAction(\"seek\", payload);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.ERROR:\r\n                if (event === PlayerEvents.RESET) {\r\n                    this.transition(PlayerStates.IDLE);\r\n                }\r\n                break;\r\n\r\n            default:\r\n                console.error(\"Unknown state\", this.state);\r\n        }\r\n    }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}