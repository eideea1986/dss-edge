{"ast":null,"code":"import React,{useEffect,useState,useRef,useMemo}from\"react\";import{useSearchParams}from\"react-router-dom\";import API from\"../api\";// --- CSS STYLES (Trassir Enterprise Pro Aesthetic) ---\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const styles=\"\\n.trassir-player { \\n    height: 100vh; display: flex; flex-direction: column; background: #0a0a0a; color: #eee; font-family: 'Inter', 'Segoe UI', Roboto, sans-serif; \\n}\\n.video-container { \\n    flex: 1; background: #000; display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden; min-height: 0;\\n}\\n.video-el { \\n    max-height: 100%; max-width: 100%; width: auto; height: auto; display: block;\\n}\\n.status-badge {\\n    position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.8); padding: 5px 12px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; border: 1px solid #444; color: #3498db; pointer-events: none; z-index: 100;\\n}\\n.timeline-container { \\n    background: #151515; border-top: 1px solid #333; display: flex; flex-direction: column; padding: 10px 20px;\\n}\\n.timeline-axis { \\n    position: relative; height: 50px; background: #222; margin-top: 5px; border-radius: 4px; overflow: hidden; cursor: crosshair; border: 1px solid #333;\\n}\\n.timeline-seg-video { \\n    position: absolute; height: 100%; background: #2ecc71; opacity: 0.8; border-right: 1px solid #27ae60; min-width: 2px;\\n}\\n.timeline-event-marker { \\n    position: absolute; width: 3px; height: 100%; background: #e74c3c; z-index: 5;\\n}\\n.timeline-cursor { \\n    position: absolute; width: 2px; height: 100%; background: #fff; z-index: 10; box-shadow: 0 0 10px #fff; pointer-events: none;\\n}\\n.controls-bar { \\n    height: 70px; background: #1a1a1a; display: flex; align-items: center; gap: 15px; padding: 0 20px; border-top: 1px solid #222;\\n}\\n.btn-control { \\n    background: #333; color: #fff; border: 1px solid #444; padding: 8px 12px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 0.85rem; white-space: nowrap; transition: all 0.2s;\\n}\\n.btn-control:hover { background: #444; border-color: #555; }\\n.btn-active { background: #3498db !important; border-color: #2980b9 !important; }\\n.btn-export { background: #d35400; border-color: #e67e22; }\\n.jog-container { display: flex; flex-direction: column; align-items: center; gap: 2px; min-width: 150px; }\\n.jog-slider { width: 100%; cursor: pointer; accent-color: #3498db; }\\n.zoom-btn { padding: 4px 8px; font-size: 0.75rem; background: #222; border: 1px solid #444; color: #888; border-radius: 3px; cursor: pointer; }\\n.zoom-btn.active { background: #444; color: #fff; }\\n\";const ZOOM_LEVELS=[{label:\"24h\",range:86400000},{label:\"6h\",range:21600000},{label:\"1h\",range:3600000},{label:\"10m\",range:600000}];export default function Playback(){const[params]=useSearchParams();const camId=params.get(\"camId\");const[calendar,setCalendar]=useState([]);const[selectedDate,setSelectedDate]=useState(new Date().toISOString().split('T')[0]);const[segments,setSegments]=useState([]);const[events,setEvents]=useState([]);// Playback State\nconst[currentTime,setCurrentTime]=useState(Date.now());const[isPlaying,setIsPlaying]=useState(false);const[speed,setSpeed]=useState(1);const[status,setStatus]=useState(\"IDLE\");const[zoomLevel,setZoomLevel]=useState(ZOOM_LEVELS[0]);const videoRef=useRef(null);const pcRef=useRef(null);const seekTimerRef=useRef(null);const dayStart=useMemo(()=>new Date(selectedDate+\"T00:00:00Z\").getTime(),[selectedDate]);// Derived: Current visible window for timeline\nconst timelineWindow=useMemo(()=>{const halfRange=zoomLevel.range/2;let start=currentTime-halfRange;let end=currentTime+halfRange;if(start<dayStart){start=dayStart;end=dayStart+zoomLevel.range;}if(end>dayStart+86400000){end=dayStart+86400000;start=end-zoomLevel.range;}return{start,end};},[currentTime,zoomLevel,dayStart]);// 1. Fetch Calendar & Initial Segments\nuseEffect(()=>{if(!camId)return;API.get(\"/recorder/days\").then(res=>{if(res.data&&res.data.length){setCalendar(res.data);if(!res.data.includes(selectedDate))setSelectedDate(res.data[0]);}}).catch(()=>{});},[camId]);useEffect(()=>{if(!camId||!selectedDate)return;API.get(\"/recorder/timeline/\".concat(camId,\"/\").concat(selectedDate)).then(res=>{const segs=res.data||[];setSegments(segs);if(segs.length>0){const isNowInRecording=segs.some(s=>Date.now()>=s.start&&Date.now()<=s.end);if(!isNowInRecording)handleSeek(segs[0].start);}}).catch(e=>console.error(e));API.get(\"/events?cameraId=\".concat(camId,\"&date=\").concat(selectedDate)).then(res=>setEvents(res.data||[])).catch(()=>setEvents([]));},[camId,selectedDate]);const[streamUrl,setStreamUrl]=useState(null);const wsRef=useRef(null);// 2. Direct MJPEG Playback (Solution 1 - No Go2RTC)\nconst startWebRTCSession=async function(ts){let s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;setStatus(\"CONNECTING...\");if(wsRef.current)wsRef.current.close();setStreamUrl(null);// Clear previous\ntry{// A. Create Session (Force MJPEG format)\nconst res=await API.get(\"/recorder/playback/session\",{params:{camId,startTs:ts,speed:s,windowMs:zoomLevel.range,format:'mjpeg'}});const{sessionId}=res.data;// B. Set Stream URL (Direct Backend Access)\n// Using a timestamp to force refresh the image stream\nconst url=\"\".concat(API.defaults.baseURL,\"/recorder/stream/\").concat(sessionId,\"?startTs=\").concat(ts,\"&speed=\").concat(s,\"&format=mjpeg&_t=\").concat(Date.now());setStreamUrl(url);// C. Connect Telemetry (Sync Timeline)\nconst ws=new WebSocket(\"ws://\".concat(window.location.hostname,\":8081\"));wsRef.current=ws;ws.onopen=()=>{ws.send(JSON.stringify({type:'subscribe',camId}));};ws.onmessage=e=>{const data=JSON.parse(e.data);if(data.type==='telemetry'){setCurrentTime(data.absTs);setStatus(\"PLAYING\");}};setIsPlaying(true);}catch(e){console.error(\"Playback Error:\",e);setStatus(\"ERROR\");}};// 3. (REMOVED) Local estimation timer - We now trust the Server Telemetry\n// --- GAP SKIP LOGIC ---\nfunction findNearestPlayableTs(targetTs){if(!segments||segments.length===0)return targetTs;const inSeg=segments.find(s=>targetTs>=s.start&&targetTs<s.end);if(inSeg)return targetTs;const nextSeg=segments.find(s=>s.start>targetTs);if(nextSeg)return nextSeg.start;const last=segments[segments.length-1];return last?last.end-100:targetTs;}// --- ACTIONS ---\nconst handleSeek=targetAbsTs=>{const safeTs=findNearestPlayableTs(targetAbsTs);setCurrentTime(safeTs);setStatus(\"SEEKING...\");// Debounce seek to avoid spamming go2rtc\nif(seekTimerRef.current)clearTimeout(seekTimerRef.current);seekTimerRef.current=setTimeout(()=>{startWebRTCSession(safeTs,speed);},300);};const togglePlay=()=>{if(isPlaying){if(pcRef.current)pcRef.current.close();pcRef.current=null;setIsPlaying(false);setStatus(\"PAUSED\");}else{startWebRTCSession(currentTime,speed);}};const step=secs=>{handleSeek(currentTime+secs*1000);};const fineStep=dir=>{handleSeek(currentTime+dir*40);};// Approximate one frame at 25fps\nconst handleJogChange=e=>{const val=parseFloat(e.target.value);setSpeed(val);if(val===0){if(pcRef.current)pcRef.current.close();setIsPlaying(false);setStatus(\"PAUSED\");}else{startWebRTCSession(currentTime,val);}};const handleExport=()=>{const start=currentTime-30000;const end=currentTime+30000;window.open(\"\".concat(API.defaults.baseURL,\"/recorder/export/\").concat(camId,\"?start=\").concat(start,\"&end=\").concat(end),'_blank');};const formatAbsoluteTime=ms=>{const d=new Date(ms);return d.toLocaleTimeString([],{hour12:false})+\".\"+d.getMilliseconds().toString().padStart(3,'0');};return/*#__PURE__*/_jsxs(\"div\",{className:\"trassir-player\",children:[/*#__PURE__*/_jsx(\"style\",{children:styles}),/*#__PURE__*/_jsxs(\"div\",{style:{height:50,background:\"#1a1a1a\",display:\"flex\",alignItems:\"center\",padding:\"0 20px\",borderBottom:\"1px solid #333\"},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.href='/',className:\"btn-control\",style:{marginRight:20},children:\"\\u2190 Back\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",flexDirection:\"column\",justifyContent:\"center\"},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:\"0.95rem\",fontWeight:\"bold\"},children:camId}),/*#__PURE__*/_jsx(\"span\",{style:{fontSize:\"0.75rem\",color:\"#3498db\"},children:\"TRASSIR Professional Archive\"})]}),/*#__PURE__*/_jsx(\"span\",{style:{margin:\"0 15px\",color:\"#444\"},children:\"|\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedDate,onChange:e=>setSelectedDate(e.target.value),className:\"btn-control\",style:{background:\"#222\",border:\"1px solid #444\",color:\"#eee\"},children:calendar.map(d=>/*#__PURE__*/_jsx(\"option\",{value:d,children:d},d))}),/*#__PURE__*/_jsx(\"div\",{style:{marginLeft:\"auto\",display:\"flex\",alignItems:\"center\"},children:/*#__PURE__*/_jsx(\"div\",{style:{fontFamily:\"monospace\",fontSize:\"1.1rem\",color:\"#3498db\",minWidth:160,textAlign:\"right\"},children:formatAbsoluteTime(currentTime)})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"video-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"status-badge\",children:[status,\" \",Math.abs(speed)!==1&&isPlaying?\"(\".concat(speed,\"x)\"):'']}),streamUrl?/*#__PURE__*/_jsx(\"img\",{src:streamUrl,className:\"video-el\",style:{objectFit:'fill',width:'100%',height:'100%'},alt:\"Stream\"}):/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',height:'100%',background:'#000'}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"timeline-container\",children:[/*#__PURE__*/_jsx(\"div\",{style:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",marginBottom:5},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:10,alignItems:\"center\"},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:\"0.75rem\",color:\"#888\",textTransform:\"uppercase\",letterSpacing:1},children:\"Timeline Zoom:\"}),ZOOM_LEVELS.map(z=>/*#__PURE__*/_jsx(\"button\",{className:\"zoom-btn \".concat(zoomLevel.label===z.label?'active':''),onClick:()=>setZoomLevel(z),children:z.label},z.label))]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"timeline-axis\",onClick:e=>{const rect=e.currentTarget.getBoundingClientRect();const pct=(e.clientX-rect.left)/rect.width;handleSeek(timelineWindow.start+pct*zoomLevel.range);},children:[segments.filter(s=>s.end>timelineWindow.start&&s.start<timelineWindow.end).map((seg,idx)=>/*#__PURE__*/_jsx(\"div\",{className:\"timeline-seg-video\",style:{left:\"\".concat((Math.max(seg.start,timelineWindow.start)-timelineWindow.start)/zoomLevel.range*100,\"%\"),width:\"\".concat((Math.min(seg.end,timelineWindow.end)-Math.max(seg.start,timelineWindow.start))/zoomLevel.range*100,\"%\"),zIndex:1}},idx)),events.filter(ev=>{const evTime=new Date(ev.timestamp).getTime();return evTime>=timelineWindow.start&&evTime<=timelineWindow.end;}).map((ev,idx)=>/*#__PURE__*/_jsx(\"div\",{className:\"timeline-event-marker\",style:{left:\"\".concat((new Date(ev.timestamp).getTime()-timelineWindow.start)/zoomLevel.range*100,\"%\")},title:ev.label||'Motion'},idx)),/*#__PURE__*/_jsx(\"div\",{className:\"timeline-cursor\",style:{left:\"\".concat((currentTime-timelineWindow.start)/zoomLevel.range*100,\"%\"),zIndex:10,display:currentTime>=timelineWindow.start&&currentTime<=timelineWindow.end?'block':'none'}})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",justifyContent:\"space-between\",color:\"#666\",fontSize:\"0.7rem\",marginTop:5},children:[/*#__PURE__*/_jsx(\"span\",{children:new Date(timelineWindow.start).toLocaleTimeString([],{hour12:false})}),/*#__PURE__*/_jsx(\"span\",{children:new Date(timelineWindow.start+zoomLevel.range/2).toLocaleTimeString([],{hour12:false})}),/*#__PURE__*/_jsx(\"span\",{children:new Date(timelineWindow.end).toLocaleTimeString([],{hour12:false})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"controls-bar\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-control \".concat(isPlaying?'btn-active':''),onClick:togglePlay,style:{width:100,fontWeight:\"bold\"},children:isPlaying?\"‚è∏ PAUSE\":\"‚ñ∂ PLAY\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:5},children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-control\",onClick:()=>step(-10),title:\"Rewind 10s\",children:\"\\xAB 10s\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-control\",onClick:()=>step(-1),title:\"Rewind 1s\",children:\"\\xAB 1s\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-control\",onClick:()=>step(1),title:\"Forward 1s\",children:\"1s \\xBB\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-control\",onClick:()=>step(10),title:\"Forward 10s\",children:\"10s \\xBB\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:5,marginLeft:15},children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-control\",title:\"Fine Step Backward\",onClick:()=>fineStep(-1),children:\"|\\xAB\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-control\",title:\"Fine Step Forward\",onClick:()=>fineStep(1),children:\"\\xBB|\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"jog-container\",style:{marginLeft:30},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontSize:\"0.7rem\",color:\"#666\",fontWeight:\"bold\"},children:\"JOG SHUTTLE\"}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"-8\",max:\"8\",step:\"0.25\",value:speed,onChange:handleJogChange,onMouseUp:()=>{if(Math.abs(speed)<1&&Math.abs(speed)>0)handleJogChange({target:{value:1}});},className:\"jog-slider\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:\"0.8rem\",color:\"#3498db\"},children:[speed,\"x\"]})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginLeft:\"auto\",display:\"flex\",gap:10},children:/*#__PURE__*/_jsx(\"button\",{className:\"btn-control btn-export\",onClick:handleExport,children:\"\\uD83D\\uDCE5 EXPORT CLIP (1m)\"})})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useRef","useMemo","useSearchParams","API","jsx","_jsx","jsxs","_jsxs","styles","ZOOM_LEVELS","label","range","Playback","params","camId","get","calendar","setCalendar","selectedDate","setSelectedDate","Date","toISOString","split","segments","setSegments","events","setEvents","currentTime","setCurrentTime","now","isPlaying","setIsPlaying","speed","setSpeed","status","setStatus","zoomLevel","setZoomLevel","videoRef","pcRef","seekTimerRef","dayStart","getTime","timelineWindow","halfRange","start","end","then","res","data","length","includes","catch","concat","segs","isNowInRecording","some","s","handleSeek","e","console","error","streamUrl","setStreamUrl","wsRef","startWebRTCSession","ts","arguments","undefined","current","close","startTs","windowMs","format","sessionId","url","defaults","baseURL","ws","WebSocket","window","location","hostname","onopen","send","JSON","stringify","type","onmessage","parse","absTs","findNearestPlayableTs","targetTs","inSeg","find","nextSeg","last","targetAbsTs","safeTs","clearTimeout","setTimeout","togglePlay","step","secs","fineStep","dir","handleJogChange","val","parseFloat","target","value","handleExport","open","formatAbsoluteTime","ms","d","toLocaleTimeString","hour12","getMilliseconds","toString","padStart","className","children","style","height","background","display","alignItems","padding","borderBottom","onClick","href","marginRight","flexDirection","justifyContent","fontSize","fontWeight","color","margin","onChange","border","map","marginLeft","fontFamily","minWidth","textAlign","Math","abs","src","objectFit","width","alt","marginBottom","gap","textTransform","letterSpacing","z","rect","currentTarget","getBoundingClientRect","pct","clientX","left","filter","seg","idx","max","min","zIndex","ev","evTime","timestamp","title","marginTop","onMouseUp"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/pages/Playback.js"],"sourcesContent":["import React, { useEffect, useState, useRef, useMemo } from \"react\";\r\nimport { useSearchParams } from \"react-router-dom\";\r\nimport API from \"../api\";\r\n\r\n// --- CSS STYLES (Trassir Enterprise Pro Aesthetic) ---\r\nconst styles = `\r\n.trassir-player { \r\n    height: 100vh; display: flex; flex-direction: column; background: #0a0a0a; color: #eee; font-family: 'Inter', 'Segoe UI', Roboto, sans-serif; \r\n}\r\n.video-container { \r\n    flex: 1; background: #000; display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden; min-height: 0;\r\n}\r\n.video-el { \r\n    max-height: 100%; max-width: 100%; width: auto; height: auto; display: block;\r\n}\r\n.status-badge {\r\n    position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.8); padding: 5px 12px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; border: 1px solid #444; color: #3498db; pointer-events: none; z-index: 100;\r\n}\r\n.timeline-container { \r\n    background: #151515; border-top: 1px solid #333; display: flex; flex-direction: column; padding: 10px 20px;\r\n}\r\n.timeline-axis { \r\n    position: relative; height: 50px; background: #222; margin-top: 5px; border-radius: 4px; overflow: hidden; cursor: crosshair; border: 1px solid #333;\r\n}\r\n.timeline-seg-video { \r\n    position: absolute; height: 100%; background: #2ecc71; opacity: 0.8; border-right: 1px solid #27ae60; min-width: 2px;\r\n}\r\n.timeline-event-marker { \r\n    position: absolute; width: 3px; height: 100%; background: #e74c3c; z-index: 5;\r\n}\r\n.timeline-cursor { \r\n    position: absolute; width: 2px; height: 100%; background: #fff; z-index: 10; box-shadow: 0 0 10px #fff; pointer-events: none;\r\n}\r\n.controls-bar { \r\n    height: 70px; background: #1a1a1a; display: flex; align-items: center; gap: 15px; padding: 0 20px; border-top: 1px solid #222;\r\n}\r\n.btn-control { \r\n    background: #333; color: #fff; border: 1px solid #444; padding: 8px 12px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 0.85rem; white-space: nowrap; transition: all 0.2s;\r\n}\r\n.btn-control:hover { background: #444; border-color: #555; }\r\n.btn-active { background: #3498db !important; border-color: #2980b9 !important; }\r\n.btn-export { background: #d35400; border-color: #e67e22; }\r\n.jog-container { display: flex; flex-direction: column; align-items: center; gap: 2px; min-width: 150px; }\r\n.jog-slider { width: 100%; cursor: pointer; accent-color: #3498db; }\r\n.zoom-btn { padding: 4px 8px; font-size: 0.75rem; background: #222; border: 1px solid #444; color: #888; border-radius: 3px; cursor: pointer; }\r\n.zoom-btn.active { background: #444; color: #fff; }\r\n`;\r\n\r\nconst ZOOM_LEVELS = [\r\n    { label: \"24h\", range: 86400000 },\r\n    { label: \"6h\", range: 21600000 },\r\n    { label: \"1h\", range: 3600000 },\r\n    { label: \"10m\", range: 600000 }\r\n];\r\n\r\nexport default function Playback() {\r\n    const [params] = useSearchParams();\r\n    const camId = params.get(\"camId\");\r\n\r\n    const [calendar, setCalendar] = useState([]);\r\n    const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [segments, setSegments] = useState([]);\r\n    const [events, setEvents] = useState([]);\r\n\r\n    // Playback State\r\n    const [currentTime, setCurrentTime] = useState(Date.now());\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [speed, setSpeed] = useState(1);\r\n    const [status, setStatus] = useState(\"IDLE\");\r\n    const [zoomLevel, setZoomLevel] = useState(ZOOM_LEVELS[0]);\r\n\r\n    const videoRef = useRef(null);\r\n    const pcRef = useRef(null);\r\n    const seekTimerRef = useRef(null);\r\n\r\n    const dayStart = useMemo(() => new Date(selectedDate + \"T00:00:00Z\").getTime(), [selectedDate]);\r\n\r\n    // Derived: Current visible window for timeline\r\n    const timelineWindow = useMemo(() => {\r\n        const halfRange = zoomLevel.range / 2;\r\n        let start = currentTime - halfRange;\r\n        let end = currentTime + halfRange;\r\n\r\n        if (start < dayStart) { start = dayStart; end = dayStart + zoomLevel.range; }\r\n        if (end > dayStart + 86400000) { end = dayStart + 86400000; start = end - zoomLevel.range; }\r\n        return { start, end };\r\n    }, [currentTime, zoomLevel, dayStart]);\r\n\r\n    // 1. Fetch Calendar & Initial Segments\r\n    useEffect(() => {\r\n        if (!camId) return;\r\n        API.get(`/recorder/days`).then(res => {\r\n            if (res.data && res.data.length) {\r\n                setCalendar(res.data);\r\n                if (!res.data.includes(selectedDate)) setSelectedDate(res.data[0]);\r\n            }\r\n        }).catch(() => { });\r\n    }, [camId]);\r\n\r\n    useEffect(() => {\r\n        if (!camId || !selectedDate) return;\r\n        API.get(`/recorder/timeline/${camId}/${selectedDate}`)\r\n            .then(res => {\r\n                const segs = res.data || [];\r\n                setSegments(segs);\r\n                if (segs.length > 0) {\r\n                    const isNowInRecording = segs.some(s => Date.now() >= s.start && Date.now() <= s.end);\r\n                    if (!isNowInRecording) handleSeek(segs[0].start);\r\n                }\r\n            })\r\n            .catch(e => console.error(e));\r\n\r\n        API.get(`/events?cameraId=${camId}&date=${selectedDate}`)\r\n            .then(res => setEvents(res.data || []))\r\n            .catch(() => setEvents([]));\r\n    }, [camId, selectedDate]);\r\n\r\n    const [streamUrl, setStreamUrl] = useState(null);\r\n    const wsRef = useRef(null);\r\n\r\n    // 2. Direct MJPEG Playback (Solution 1 - No Go2RTC)\r\n    const startWebRTCSession = async (ts, s = 1) => {\r\n        setStatus(\"CONNECTING...\");\r\n        if (wsRef.current) wsRef.current.close();\r\n        setStreamUrl(null); // Clear previous\r\n\r\n        try {\r\n            // A. Create Session (Force MJPEG format)\r\n            const res = await API.get(`/recorder/playback/session`, {\r\n                params: {\r\n                    camId,\r\n                    startTs: ts,\r\n                    speed: s,\r\n                    windowMs: zoomLevel.range,\r\n                    format: 'mjpeg'\r\n                }\r\n            });\r\n\r\n            const { sessionId } = res.data;\r\n\r\n            // B. Set Stream URL (Direct Backend Access)\r\n            // Using a timestamp to force refresh the image stream\r\n            const url = `${API.defaults.baseURL}/recorder/stream/${sessionId}?startTs=${ts}&speed=${s}&format=mjpeg&_t=${Date.now()}`;\r\n            setStreamUrl(url);\r\n\r\n            // C. Connect Telemetry (Sync Timeline)\r\n            const ws = new WebSocket(`ws://${window.location.hostname}:8081`);\r\n            wsRef.current = ws;\r\n            ws.onopen = () => {\r\n                ws.send(JSON.stringify({ type: 'subscribe', camId }));\r\n            };\r\n            ws.onmessage = (e) => {\r\n                const data = JSON.parse(e.data);\r\n                if (data.type === 'telemetry') {\r\n                    setCurrentTime(data.absTs);\r\n                    setStatus(\"PLAYING\");\r\n                }\r\n            };\r\n\r\n            setIsPlaying(true);\r\n        } catch (e) {\r\n            console.error(\"Playback Error:\", e);\r\n            setStatus(\"ERROR\");\r\n        }\r\n    };\r\n\r\n    // 3. (REMOVED) Local estimation timer - We now trust the Server Telemetry\r\n\r\n    // --- GAP SKIP LOGIC ---\r\n    function findNearestPlayableTs(targetTs) {\r\n        if (!segments || segments.length === 0) return targetTs;\r\n        const inSeg = segments.find(s => targetTs >= s.start && targetTs < s.end);\r\n        if (inSeg) return targetTs;\r\n        const nextSeg = segments.find(s => s.start > targetTs);\r\n        if (nextSeg) return nextSeg.start;\r\n        const last = segments[segments.length - 1];\r\n        return last ? last.end - 100 : targetTs;\r\n    }\r\n\r\n    // --- ACTIONS ---\r\n    const handleSeek = (targetAbsTs) => {\r\n        const safeTs = findNearestPlayableTs(targetAbsTs);\r\n        setCurrentTime(safeTs);\r\n        setStatus(\"SEEKING...\");\r\n\r\n        // Debounce seek to avoid spamming go2rtc\r\n        if (seekTimerRef.current) clearTimeout(seekTimerRef.current);\r\n        seekTimerRef.current = setTimeout(() => {\r\n            startWebRTCSession(safeTs, speed);\r\n        }, 300);\r\n    };\r\n\r\n    const togglePlay = () => {\r\n        if (isPlaying) {\r\n            if (pcRef.current) pcRef.current.close();\r\n            pcRef.current = null;\r\n            setIsPlaying(false);\r\n            setStatus(\"PAUSED\");\r\n        } else {\r\n            startWebRTCSession(currentTime, speed);\r\n        }\r\n    };\r\n\r\n    const step = (secs) => { handleSeek(currentTime + secs * 1000); };\r\n    const fineStep = (dir) => { handleSeek(currentTime + (dir * 40)); }; // Approximate one frame at 25fps\r\n\r\n    const handleJogChange = (e) => {\r\n        const val = parseFloat(e.target.value);\r\n        setSpeed(val);\r\n        if (val === 0) {\r\n            if (pcRef.current) pcRef.current.close();\r\n            setIsPlaying(false);\r\n            setStatus(\"PAUSED\");\r\n        } else {\r\n            startWebRTCSession(currentTime, val);\r\n        }\r\n    };\r\n\r\n    const handleExport = () => {\r\n        const start = currentTime - 30000;\r\n        const end = currentTime + 30000;\r\n        window.open(`${API.defaults.baseURL}/recorder/export/${camId}?start=${start}&end=${end}`, '_blank');\r\n    };\r\n\r\n    const formatAbsoluteTime = (ms) => {\r\n        const d = new Date(ms);\r\n        return d.toLocaleTimeString([], { hour12: false }) + \".\" + d.getMilliseconds().toString().padStart(3, '0');\r\n    };\r\n\r\n    return (\r\n        <div className=\"trassir-player\">\r\n            <style>{styles}</style>\r\n\r\n            {/* Header */}\r\n            <div style={{ height: 50, background: \"#1a1a1a\", display: \"flex\", alignItems: \"center\", padding: \"0 20px\", borderBottom: \"1px solid #333\" }}>\r\n                <button onClick={() => window.location.href = '/'} className=\"btn-control\" style={{ marginRight: 20 }}>‚Üê Back</button>\r\n                <div style={{ display: \"flex\", flexDirection: \"column\", justifyContent: \"center\" }}>\r\n                    <span style={{ fontSize: \"0.95rem\", fontWeight: \"bold\" }}>{camId}</span>\r\n                    <span style={{ fontSize: \"0.75rem\", color: \"#3498db\" }}>TRASSIR Professional Archive</span>\r\n                </div>\r\n                <span style={{ margin: \"0 15px\", color: \"#444\" }}>|</span>\r\n                <select value={selectedDate} onChange={e => setSelectedDate(e.target.value)} className=\"btn-control\" style={{ background: \"#222\", border: \"1px solid #444\", color: \"#eee\" }}>\r\n                    {calendar.map(d => <option key={d} value={d}>{d}</option>)}\r\n                </select>\r\n                <div style={{ marginLeft: \"auto\", display: \"flex\", alignItems: \"center\" }}>\r\n                    <div style={{ fontFamily: \"monospace\", fontSize: \"1.1rem\", color: \"#3498db\", minWidth: 160, textAlign: \"right\" }}>{formatAbsoluteTime(currentTime)}</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Video Area */}\r\n            <div className=\"video-container\">\r\n                <div className=\"status-badge\">{status} {Math.abs(speed) !== 1 && isPlaying ? `(${speed}x)` : ''}</div>\r\n                {streamUrl ? (\r\n                    <img src={streamUrl} className=\"video-el\" style={{ objectFit: 'fill', width: '100%', height: '100%' }} alt=\"Stream\" />\r\n                ) : (\r\n                    <div style={{ width: '100%', height: '100%', background: '#000' }} />\r\n                )}\r\n            </div>\r\n\r\n            {/* Timeline Area */}\r\n            <div className=\"timeline-container\">\r\n                <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 5 }}>\r\n                    <div style={{ display: \"flex\", gap: 10, alignItems: \"center\" }}>\r\n                        <span style={{ fontSize: \"0.75rem\", color: \"#888\", textTransform: \"uppercase\", letterSpacing: 1 }}>Timeline Zoom:</span>\r\n                        {ZOOM_LEVELS.map(z => (\r\n                            <button\r\n                                key={z.label}\r\n                                className={`zoom-btn ${zoomLevel.label === z.label ? 'active' : ''}`}\r\n                                onClick={() => setZoomLevel(z)}\r\n                            >\r\n                                {z.label}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                <div\r\n                    className=\"timeline-axis\"\r\n                    onClick={(e) => {\r\n                        const rect = e.currentTarget.getBoundingClientRect();\r\n                        const pct = (e.clientX - rect.left) / rect.width;\r\n                        handleSeek(timelineWindow.start + (pct * zoomLevel.range));\r\n                    }}\r\n                >\r\n                    {/* Recording Segments */}\r\n                    {segments.filter(s => s.end > timelineWindow.start && s.start < timelineWindow.end).map((seg, idx) => (\r\n                        <div\r\n                            key={idx}\r\n                            className=\"timeline-seg-video\"\r\n                            style={{\r\n                                left: `${((Math.max(seg.start, timelineWindow.start) - timelineWindow.start) / zoomLevel.range) * 100}%`,\r\n                                width: `${((Math.min(seg.end, timelineWindow.end) - Math.max(seg.start, timelineWindow.start)) / zoomLevel.range) * 100}%`,\r\n                                zIndex: 1\r\n                            }}\r\n                        />\r\n                    ))}\r\n\r\n                    {/* Event Markers */}\r\n                    {events.filter(ev => {\r\n                        const evTime = new Date(ev.timestamp).getTime();\r\n                        return evTime >= timelineWindow.start && evTime <= timelineWindow.end;\r\n                    }).map((ev, idx) => (\r\n                        <div\r\n                            key={idx}\r\n                            className=\"timeline-event-marker\"\r\n                            style={{ left: `${((new Date(ev.timestamp).getTime() - timelineWindow.start) / zoomLevel.range) * 100}%` }}\r\n                            title={ev.label || 'Motion'}\r\n                        />\r\n                    ))}\r\n\r\n                    {/* Cursor */}\r\n                    <div\r\n                        className=\"timeline-cursor\"\r\n                        style={{\r\n                            left: `${((currentTime - timelineWindow.start) / zoomLevel.range) * 100}%`,\r\n                            zIndex: 10,\r\n                            display: (currentTime >= timelineWindow.start && currentTime <= timelineWindow.end) ? 'block' : 'none'\r\n                        }}\r\n                    />\r\n                </div>\r\n\r\n                <div style={{ display: \"flex\", justifyContent: \"space-between\", color: \"#666\", fontSize: \"0.7rem\", marginTop: 5 }}>\r\n                    <span>{new Date(timelineWindow.start).toLocaleTimeString([], { hour12: false })}</span>\r\n                    <span>{new Date(timelineWindow.start + zoomLevel.range / 2).toLocaleTimeString([], { hour12: false })}</span>\r\n                    <span>{new Date(timelineWindow.end).toLocaleTimeString([], { hour12: false })}</span>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Controls Bar */}\r\n            <div className=\"controls-bar\">\r\n                <button className={`btn-control ${isPlaying ? 'btn-active' : ''}`} onClick={togglePlay} style={{ width: 100, fontWeight: \"bold\" }}>\r\n                    {isPlaying ? \"‚è∏ PAUSE\" : \"‚ñ∂ PLAY\"}\r\n                </button>\r\n\r\n                <div style={{ display: \"flex\", gap: 5 }}>\r\n                    <button className=\"btn-control\" onClick={() => step(-10)} title=\"Rewind 10s\">¬´ 10s</button>\r\n                    <button className=\"btn-control\" onClick={() => step(-1)} title=\"Rewind 1s\">¬´ 1s</button>\r\n                    <button className=\"btn-control\" onClick={() => step(1)} title=\"Forward 1s\">1s ¬ª</button>\r\n                    <button className=\"btn-control\" onClick={() => step(10)} title=\"Forward 10s\">10s ¬ª</button>\r\n                </div>\r\n\r\n                <div style={{ display: \"flex\", gap: 5, marginLeft: 15 }}>\r\n                    <button className=\"btn-control\" title=\"Fine Step Backward\" onClick={() => fineStep(-1)}>|¬´</button>\r\n                    <button className=\"btn-control\" title=\"Fine Step Forward\" onClick={() => fineStep(1)}>¬ª|</button>\r\n                </div>\r\n\r\n                {/* Jog Shuttle */}\r\n                <div className=\"jog-container\" style={{ marginLeft: 30 }}>\r\n                    <span style={{ fontSize: \"0.7rem\", color: \"#666\", fontWeight: \"bold\" }}>JOG SHUTTLE</span>\r\n                    <input\r\n                        type=\"range\" min=\"-8\" max=\"8\" step=\"0.25\"\r\n                        value={speed}\r\n                        onChange={handleJogChange}\r\n                        onMouseUp={() => { if (Math.abs(speed) < 1 && Math.abs(speed) > 0) handleJogChange({ target: { value: 1 } }); }}\r\n                        className=\"jog-slider\"\r\n                    />\r\n                    <div style={{ fontSize: \"0.8rem\", color: \"#3498db\" }}>{speed}x</div>\r\n                </div>\r\n\r\n                <div style={{ marginLeft: \"auto\", display: \"flex\", gap: 10 }}>\r\n                    <button className=\"btn-control btn-export\" onClick={handleExport}>\r\n                        üì• EXPORT CLIP (1m)\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}