{"ast":null,"code":"import React,{useEffect,useRef,useState,useCallback}from'react';import API from'../api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DAY_MS=86400000;const HOUR_MS=3600000;const MIN_MS=60000;const Playback=()=>{// 0. URL PARAMS\nconst urlParams=new URLSearchParams(window.location.hash.split('?')[1]);const initCam=urlParams.get('camId');// STATE\nconst[cameras,setCameras]=useState([]);const[camId,setCamId]=useState(initCam||'');const[timelineSegments,setTimelineSegments]=useState([]);const[serverDayStart,setServerDayStart]=useState(0);const[selectedDate,setSelectedDate]=useState(new Date().toISOString().split('T')[0]);const[stats,setStats]=useState({first:null,last:null});const[isPlaying,setIsPlaying]=useState(false);// TIMELINE UI STATE\nconst[zoom,setZoom]=useState(1);// 1 = 24h visible\nconst[offsetMs,setOffsetMs]=useState(0);// Offset in ms from dayStart\nconst[playheadMs,setPlayheadMs]=useState(null);// Relative to dayStart\nconst[seekInfo,setSeekInfo]=useState(null);// For displaying \"Seeking to: ...\"\nconst[isLoading,setIsLoading]=useState(false);// REFS\nconst videoRef=useRef(null);const canvasRef=useRef(null);const lastSeekBaseTs=useRef(0);// Store start_ts of the segment we seeked to\nconst isSeeking=useRef(false);const abortControllerRef=useRef(null);const currentRequestId=useRef(0);// 1. LOAD CAMERAS\nuseEffect(()=>{API.get('/cameras').then(res=>{setCameras(res.data);if(!camId&&res.data.length>0)setCamId(res.data[0].id);}).catch(err=>console.error(\"Cameras load error\",err));},[camId]);// 1.5. LOAD STATS\nuseEffect(()=>{if(!camId)return;API.get(\"/playback/stats/\".concat(camId,\"?_t=\").concat(Date.now())).then(res=>setStats(res.data)).catch(console.error);},[camId]);// 2. LOAD SEGMENTS\nuseEffect(()=>{if(!camId)return;API.get(\"/playback/timeline-day/\".concat(camId,\"/\").concat(selectedDate,\"?_ts=\").concat(Date.now())).then(res=>{const{segments,dayStart}=res.data;setServerDayStart(dayStart);setTimelineSegments(segments||[]);// Reset timeline on date change\nsetOffsetMs(0);setZoom(1);}).catch(err=>console.error(\"Timeline error\",err));},[camId,selectedDate]);// 3. UTILS FOR CANVAS\nconst timeToX=(ms,width)=>{const visibleMs=DAY_MS/zoom;return(ms-offsetMs)/visibleMs*width;};const xToTime=(x,width)=>{const visibleMs=DAY_MS/zoom;return offsetMs+x/width*visibleMs;};const formatTime=ms=>{const totalSeconds=Math.floor(ms/1000);const h=Math.floor(totalSeconds/3600);const m=Math.floor(totalSeconds%3600/60);const s=totalSeconds%60;return\"\".concat(h.toString().padStart(2,'0'),\":\").concat(m.toString().padStart(2,'0'),\":\").concat(s.toString().padStart(2,'0'));};// 4. DRAW TIMELINE\nconst draw=useCallback(()=>{const canvas=canvasRef.current;if(!canvas||!serverDayStart)return;const ctx=canvas.getContext('2d');const width=canvas.width;const height=canvas.height;const visibleMs=DAY_MS/zoom;// Clear\nctx.fillStyle='#111';ctx.fillRect(0,0,width,height);// --- GRID ---\nlet step;if(visibleMs>12*HOUR_MS)step=HOUR_MS;else if(visibleMs>3*HOUR_MS)step=30*MIN_MS;else if(visibleMs>1*HOUR_MS)step=10*MIN_MS;else step=1*MIN_MS;ctx.lineWidth=1;for(let t=Math.floor(offsetMs/step)*step;t<offsetMs+visibleMs;t+=step){const x=timeToX(t,width);if(x<0||x>width)continue;ctx.strokeStyle='#333';ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,height);ctx.stroke();// Label\nif(t%HOUR_MS===0||visibleMs<4*HOUR_MS){ctx.fillStyle='#888';ctx.font='10px Arial';const h=Math.floor(t/HOUR_MS);const m=Math.floor(t%HOUR_MS/MIN_MS);if(t>=0&&t<=DAY_MS){ctx.fillText(\"\".concat(String(h).padStart(2,'0'),\":\").concat(String(m).padStart(2,'0')),x+2,12);}}}// --- SEGMENTS (Green) ---\nctx.fillStyle='#2ecc71';timelineSegments.forEach(s=>{const sStart=Number(s.start_ts)-serverDayStart;const sEnd=(s.end_ts===0?Date.now():Number(s.end_ts))-serverDayStart;const x1=timeToX(sStart,width);const x2=timeToX(sEnd,width);const w=Math.max(x2-x1,1);if(x1+w<0||x1>width)return;ctx.fillRect(x1,25,w,25);});// --- PLAYHEAD (Red) ---\nif(playheadMs!==null){const px=timeToX(playheadMs,width);if(px>=0&&px<=width){ctx.strokeStyle='red';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(px,0);ctx.lineTo(px,height);ctx.stroke();// Little triangle at top\nctx.fillStyle='red';ctx.beginPath();ctx.moveTo(px-5,0);ctx.lineTo(px+5,0);ctx.lineTo(px,8);ctx.fill();}}},[timelineSegments,serverDayStart,zoom,offsetMs,playheadMs]);useEffect(()=>{draw();},[draw]);// 5. UPDATE PLAYHEAD FROM VIDEO\nuseEffect(()=>{const video=videoRef.current;if(!video)return;const handleTimeUpdate=()=>{if(isSeeking.current)return;if(lastSeekBaseTs.current>0){const currentAbsoluteTs=lastSeekBaseTs.current+video.currentTime*1000;const relativeMs=currentAbsoluteTs-serverDayStart;setPlayheadMs(relativeMs);}};const handleLoadedData=()=>{isSeeking.current=false;setIsLoading(false);setSeekInfo(null);};const handlePlaying=()=>setIsPlaying(true);const handlePause=()=>setIsPlaying(false);const handleSeeking=()=>{isSeeking.current=true;};video.addEventListener('timeupdate',handleTimeUpdate);video.addEventListener('loadeddata',handleLoadedData);video.addEventListener('seeking',handleSeeking);video.addEventListener('playing',handlePlaying);video.addEventListener('pause',handlePause);return()=>{video.removeEventListener('timeupdate',handleTimeUpdate);video.removeEventListener('loadeddata',handleLoadedData);video.removeEventListener('seeking',handleSeeking);video.removeEventListener('playing',handlePlaying);video.removeEventListener('pause',handlePause);};},[serverDayStart]);// 6. ZOOM HANDLER\nconst handleWheel=e=>{// ... (rest as before)\ne.preventDefault();const canvas=canvasRef.current;const rect=canvas.getBoundingClientRect();const mouseX=e.clientX-rect.left;const mouseTime=xToTime(mouseX,rect.width);const delta=e.deltaY>0?1.2:0.8;let newZoom=Math.min(100,Math.max(1,zoom*(e.deltaY>0?0.8:1.2)));const newVisibleMs=DAY_MS/newZoom;let newOffset=mouseTime-mouseX/rect.width*newVisibleMs;// Clamping\nnewOffset=Math.max(-newVisibleMs*0.1,Math.min(DAY_MS-newVisibleMs*0.9,newOffset));setZoom(newZoom);setOffsetMs(newOffset);};// 7. CLICK HANDLER\nconst handleCanvasClick=e=>{if(!serverDayStart)return;const canvas=canvasRef.current;const rect=canvas.getBoundingClientRect();const x=e.clientX-rect.left;const clickedRelativeMs=xToTime(x,rect.width);const absoluteTs=Math.floor(serverDayStart+clickedRelativeMs);setPlayheadMs(clickedRelativeMs);setSeekInfo(\"Seeking to: \".concat(selectedDate,\" \").concat(formatTime(clickedRelativeMs)));loadPlayback(absoluteTs);};const loadPlayback=async ts=>{if(!videoRef.current||!camId)return;// 0. Cancel previous request\nif(abortControllerRef.current){abortControllerRef.current.abort();}const aborter=new AbortController();abortControllerRef.current=aborter;const requestId=++currentRequestId.current;// Reset state\nsetIsLoading(true);setIsPlaying(false);isSeeking.current=true;setSeekInfo(null);lastSeekBaseTs.current=ts;const video=videoRef.current;if(window.MediaSource){const ms=new MediaSource();video.src=URL.createObjectURL(ms);ms.addEventListener('sourceopen',async()=>{if(requestId!==currentRequestId.current)return;// H.264 Baseline 3.1\nconst codec='video/mp4; codecs=\"avc1.42E01F, mp4a.40.2\"';if(!MediaSource.isTypeSupported(codec)){video.src=\"\".concat(API.defaults.baseURL,\"/playback/stream/\").concat(camId,\"?ts=\").concat(ts,\"&_nocache=\").concat(Date.now());return;}const sb=ms.addSourceBuffer(codec);sb.mode='segments';const url=\"\".concat(API.defaults.baseURL,\"/playback/stream/\").concat(camId,\"?ts=\").concat(ts,\"&_nocache=\").concat(Date.now());try{const response=await fetch(url,{signal:aborter.signal});if(!response.ok)throw new Error(\"HTTP \".concat(response.status));const reader=response.body.getReader();let firstChunk=true;const push=async()=>{if(requestId!==currentRequestId.current){console.log(\"[MSE] Request stale, stopping push loop\",requestId);return;}try{const{done,value}=await reader.read();if(done){if(ms.readyState==='open')ms.endOfStream();return;}if(firstChunk){firstChunk=false;setIsLoading(false);}// Catch detach errors\ntry{if(sb.updating||sb.buffered.length>0&&sb.buffered.end(0)-video.currentTime>60){setTimeout(push,200);}else{sb.appendBuffer(value);sb.addEventListener('updateend',push,{once:true});}}catch(sbErr){console.warn(\"[MSE] SourceBuffer error (likely detached)\",sbErr);}}catch(e){if(e.name!=='AbortError')console.error(\"[MSE] Read error:\",e);}};push();}catch(err){if(err.name!=='AbortError'){console.error(\"[MSE] Fetch failed:\",err);setIsLoading(false);}}});video.play().catch(()=>{});}else{video.src=\"\".concat(API.defaults.baseURL,\"/playback/stream/\").concat(camId,\"?ts=\").concat(ts,\"&_nocache=\").concat(Date.now());video.load();video.play().catch(e=>console.error(e));}};return/*#__PURE__*/_jsxs(\"div\",{className:\"playback-page\",style:{padding:20,background:'#1a1a1a',color:'#eee',minHeight:'100vh'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:15,display:'flex',gap:15,alignItems:'center',flexWrap:'wrap'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(\"label\",{style:{fontSize:11,color:'#888'},children:\"Camera\"}),/*#__PURE__*/_jsx(\"select\",{value:camId,onChange:e=>setCamId(e.target.value),style:{padding:'6px 10px',background:'#333',color:'#fff',border:'1px solid #555',borderRadius:4},children:cameras.map(c=>/*#__PURE__*/_jsx(\"option\",{value:c.id,children:c.name||c.ip},c.id))})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(\"label\",{style:{fontSize:11,color:'#888'},children:\"Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:selectedDate,onChange:e=>setSelectedDate(e.target.value),style:{padding:'5px 10px',background:'#333',color:'#fff',border:'1px solid #555',borderRadius:4}})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.reload(),style:{marginTop:15,padding:'7px 15px',cursor:'pointer',background:'#2ecc71',color:'#000',border:'none',borderRadius:4,fontWeight:'bold'},children:\"Refresh\"}),/*#__PURE__*/_jsx(\"div\",{style:{flex:1}}),seekInfo&&/*#__PURE__*/_jsx(\"div\",{style:{color:'#f1c40f',fontWeight:'bold',fontSize:14,background:'rgba(0,0,0,0.3)',padding:'5px 15px',borderRadius:20},children:seekInfo}),stats.first&&stats.first>1700000000000&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:12,color:'#2ecc71',textAlign:'right'},children:[/*#__PURE__*/_jsx(\"div\",{children:\"Archive range:\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:'bold'},children:[new Date(stats.first).toLocaleString(),\" - \",new Date(stats.last).toLocaleString()]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"video-container\",style:{position:'relative',background:'#000',borderRadius:8,overflow:'hidden',boxShadow:'0 10px 30px rgba(0,0,0,0.5)',width:'100%',height:'65vh',marginBottom:15},children:[isLoading&&/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.6)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:10},children:/*#__PURE__*/_jsx(\"div\",{style:{color:'#fff',fontSize:18,fontWeight:'bold'},children:\"Loading...\"})}),/*#__PURE__*/_jsx(\"video\",{ref:videoRef,id:\"player\",controls:true,autoPlay:true,preload:\"auto\",playsInline:true,style:{width:'100%',height:'100%'},onError:e=>{console.error(\"Video element error:\",e);// Optional: trigger a small retry/reload if stalled\n},onStalled:()=>{console.warn(\"Playback stalled, waiting for buffer...\");}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"timeline-container\",style:{width:'100%',height:80,position:'relative',border:'1px solid #333',borderRadius:4,overflow:'hidden'},children:/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,id:\"timeline\",width:2000,height:80,style:{width:'100%',height:'100%',cursor:'crosshair'},onClick:handleCanvasClick,onWheel:handleWheel})}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:10,display:'flex',justifyContent:'space-between',color:'#666',fontSize:11},children:[/*#__PURE__*/_jsx(\"div\",{children:\"* Use mouse wheel to ZOOM. Click to SEEK.\"}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Zoom: \",zoom.toFixed(1),\"x\"]})]})]});};export default Playback;","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","API","jsx","_jsx","jsxs","_jsxs","DAY_MS","HOUR_MS","MIN_MS","Playback","urlParams","URLSearchParams","window","location","hash","split","initCam","get","cameras","setCameras","camId","setCamId","timelineSegments","setTimelineSegments","serverDayStart","setServerDayStart","selectedDate","setSelectedDate","Date","toISOString","stats","setStats","first","last","isPlaying","setIsPlaying","zoom","setZoom","offsetMs","setOffsetMs","playheadMs","setPlayheadMs","seekInfo","setSeekInfo","isLoading","setIsLoading","videoRef","canvasRef","lastSeekBaseTs","isSeeking","abortControllerRef","currentRequestId","then","res","data","length","id","catch","err","console","error","concat","now","segments","dayStart","timeToX","ms","width","visibleMs","xToTime","x","formatTime","totalSeconds","Math","floor","h","m","s","toString","padStart","draw","canvas","current","ctx","getContext","height","fillStyle","fillRect","step","lineWidth","t","strokeStyle","beginPath","moveTo","lineTo","stroke","font","fillText","String","forEach","sStart","Number","start_ts","sEnd","end_ts","x1","x2","w","max","px","fill","video","handleTimeUpdate","currentAbsoluteTs","currentTime","relativeMs","handleLoadedData","handlePlaying","handlePause","handleSeeking","addEventListener","removeEventListener","handleWheel","e","preventDefault","rect","getBoundingClientRect","mouseX","clientX","left","mouseTime","delta","deltaY","newZoom","min","newVisibleMs","newOffset","handleCanvasClick","clickedRelativeMs","absoluteTs","loadPlayback","ts","abort","aborter","AbortController","requestId","MediaSource","src","URL","createObjectURL","codec","isTypeSupported","defaults","baseURL","sb","addSourceBuffer","mode","url","response","fetch","signal","ok","Error","status","reader","body","getReader","firstChunk","push","log","done","value","read","readyState","endOfStream","updating","buffered","end","setTimeout","appendBuffer","once","sbErr","warn","name","play","load","className","style","padding","background","color","minHeight","children","marginBottom","display","gap","alignItems","flexWrap","flexDirection","fontSize","onChange","target","border","borderRadius","map","c","ip","type","onClick","reload","marginTop","cursor","fontWeight","flex","textAlign","toLocaleString","position","overflow","boxShadow","top","right","bottom","justifyContent","zIndex","ref","controls","autoPlay","preload","playsInline","onError","onStalled","onWheel","toFixed"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/pages/Playback.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport API from '../api';\r\n\r\nconst DAY_MS = 86400000;\r\nconst HOUR_MS = 3600000;\r\nconst MIN_MS = 60000;\r\n\r\nconst Playback = () => {\r\n    // 0. URL PARAMS\r\n    const urlParams = new URLSearchParams(window.location.hash.split('?')[1]);\r\n    const initCam = urlParams.get('camId');\r\n\r\n    // STATE\r\n    const [cameras, setCameras] = useState([]);\r\n    const [camId, setCamId] = useState(initCam || '');\r\n    const [timelineSegments, setTimelineSegments] = useState([]);\r\n    const [serverDayStart, setServerDayStart] = useState(0);\r\n    const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [stats, setStats] = useState({ first: null, last: null });\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n\r\n    // TIMELINE UI STATE\r\n    const [zoom, setZoom] = useState(1); // 1 = 24h visible\r\n    const [offsetMs, setOffsetMs] = useState(0); // Offset in ms from dayStart\r\n    const [playheadMs, setPlayheadMs] = useState(null); // Relative to dayStart\r\n    const [seekInfo, setSeekInfo] = useState(null); // For displaying \"Seeking to: ...\"\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    // REFS\r\n    const videoRef = useRef(null);\r\n    const canvasRef = useRef(null);\r\n    const lastSeekBaseTs = useRef(0); // Store start_ts of the segment we seeked to\r\n    const isSeeking = useRef(false);\r\n    const abortControllerRef = useRef(null);\r\n    const currentRequestId = useRef(0);\r\n\r\n    // 1. LOAD CAMERAS\r\n    useEffect(() => {\r\n        API.get('/cameras').then(res => {\r\n            setCameras(res.data);\r\n            if (!camId && res.data.length > 0) setCamId(res.data[0].id);\r\n        }).catch(err => console.error(\"Cameras load error\", err));\r\n    }, [camId]);\r\n\r\n    // 1.5. LOAD STATS\r\n    useEffect(() => {\r\n        if (!camId) return;\r\n        API.get(`/playback/stats/${camId}?_t=${Date.now()}`)\r\n            .then(res => setStats(res.data))\r\n            .catch(console.error);\r\n    }, [camId]);\r\n\r\n    // 2. LOAD SEGMENTS\r\n    useEffect(() => {\r\n        if (!camId) return;\r\n        API.get(`/playback/timeline-day/${camId}/${selectedDate}?_ts=${Date.now()}`)\r\n            .then(res => {\r\n                const { segments, dayStart } = res.data;\r\n                setServerDayStart(dayStart);\r\n                setTimelineSegments(segments || []);\r\n                // Reset timeline on date change\r\n                setOffsetMs(0);\r\n                setZoom(1);\r\n            })\r\n            .catch(err => console.error(\"Timeline error\", err));\r\n    }, [camId, selectedDate]);\r\n\r\n    // 3. UTILS FOR CANVAS\r\n    const timeToX = (ms, width) => {\r\n        const visibleMs = DAY_MS / zoom;\r\n        return ((ms - offsetMs) / visibleMs) * width;\r\n    };\r\n\r\n    const xToTime = (x, width) => {\r\n        const visibleMs = DAY_MS / zoom;\r\n        return offsetMs + (x / width) * visibleMs;\r\n    };\r\n\r\n    const formatTime = (ms) => {\r\n        const totalSeconds = Math.floor(ms / 1000);\r\n        const h = Math.floor(totalSeconds / 3600);\r\n        const m = Math.floor((totalSeconds % 3600) / 60);\r\n        const s = totalSeconds % 60;\r\n        return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    // 4. DRAW TIMELINE\r\n    const draw = useCallback(() => {\r\n        const canvas = canvasRef.current;\r\n        if (!canvas || !serverDayStart) return;\r\n\r\n        const ctx = canvas.getContext('2d');\r\n        const width = canvas.width;\r\n        const height = canvas.height;\r\n        const visibleMs = DAY_MS / zoom;\r\n\r\n        // Clear\r\n        ctx.fillStyle = '#111';\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        // --- GRID ---\r\n        let step;\r\n        if (visibleMs > 12 * HOUR_MS) step = HOUR_MS;\r\n        else if (visibleMs > 3 * HOUR_MS) step = 30 * MIN_MS;\r\n        else if (visibleMs > 1 * HOUR_MS) step = 10 * MIN_MS;\r\n        else step = 1 * MIN_MS;\r\n\r\n        ctx.lineWidth = 1;\r\n        for (let t = Math.floor(offsetMs / step) * step; t < offsetMs + visibleMs; t += step) {\r\n            const x = timeToX(t, width);\r\n            if (x < 0 || x > width) continue;\r\n\r\n            ctx.strokeStyle = '#333';\r\n            ctx.beginPath();\r\n            ctx.moveTo(x, 0);\r\n            ctx.lineTo(x, height);\r\n            ctx.stroke();\r\n\r\n            // Label\r\n            if (t % HOUR_MS === 0 || visibleMs < 4 * HOUR_MS) {\r\n                ctx.fillStyle = '#888';\r\n                ctx.font = '10px Arial';\r\n                const h = Math.floor(t / HOUR_MS);\r\n                const m = Math.floor((t % HOUR_MS) / MIN_MS);\r\n                if (t >= 0 && t <= DAY_MS) {\r\n                    ctx.fillText(`${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`, x + 2, 12);\r\n                }\r\n            }\r\n        }\r\n\r\n        // --- SEGMENTS (Green) ---\r\n        ctx.fillStyle = '#2ecc71';\r\n        timelineSegments.forEach(s => {\r\n            const sStart = Number(s.start_ts) - serverDayStart;\r\n            const sEnd = (s.end_ts === 0 ? Date.now() : Number(s.end_ts)) - serverDayStart;\r\n\r\n            const x1 = timeToX(sStart, width);\r\n            const x2 = timeToX(sEnd, width);\r\n            const w = Math.max(x2 - x1, 1);\r\n\r\n            if (x1 + w < 0 || x1 > width) return;\r\n            ctx.fillRect(x1, 25, w, 25);\r\n        });\r\n\r\n        // --- PLAYHEAD (Red) ---\r\n        if (playheadMs !== null) {\r\n            const px = timeToX(playheadMs, width);\r\n            if (px >= 0 && px <= width) {\r\n                ctx.strokeStyle = 'red';\r\n                ctx.lineWidth = 2;\r\n                ctx.beginPath();\r\n                ctx.moveTo(px, 0);\r\n                ctx.lineTo(px, height);\r\n                ctx.stroke();\r\n\r\n                // Little triangle at top\r\n                ctx.fillStyle = 'red';\r\n                ctx.beginPath();\r\n                ctx.moveTo(px - 5, 0);\r\n                ctx.lineTo(px + 5, 0);\r\n                ctx.lineTo(px, 8);\r\n                ctx.fill();\r\n            }\r\n        }\r\n    }, [timelineSegments, serverDayStart, zoom, offsetMs, playheadMs]);\r\n\r\n    useEffect(() => {\r\n        draw();\r\n    }, [draw]);\r\n\r\n    // 5. UPDATE PLAYHEAD FROM VIDEO\r\n    useEffect(() => {\r\n        const video = videoRef.current;\r\n        if (!video) return;\r\n\r\n        const handleTimeUpdate = () => {\r\n            if (isSeeking.current) return;\r\n            if (lastSeekBaseTs.current > 0) {\r\n                const currentAbsoluteTs = lastSeekBaseTs.current + (video.currentTime * 1000);\r\n                const relativeMs = currentAbsoluteTs - serverDayStart;\r\n                setPlayheadMs(relativeMs);\r\n            }\r\n        };\r\n\r\n        const handleLoadedData = () => {\r\n            isSeeking.current = false;\r\n            setIsLoading(false);\r\n            setSeekInfo(null);\r\n        };\r\n\r\n        const handlePlaying = () => setIsPlaying(true);\r\n        const handlePause = () => setIsPlaying(false);\r\n        const handleSeeking = () => {\r\n            isSeeking.current = true;\r\n        };\r\n\r\n        video.addEventListener('timeupdate', handleTimeUpdate);\r\n        video.addEventListener('loadeddata', handleLoadedData);\r\n        video.addEventListener('seeking', handleSeeking);\r\n        video.addEventListener('playing', handlePlaying);\r\n        video.addEventListener('pause', handlePause);\r\n\r\n        return () => {\r\n            video.removeEventListener('timeupdate', handleTimeUpdate);\r\n            video.removeEventListener('loadeddata', handleLoadedData);\r\n            video.removeEventListener('seeking', handleSeeking);\r\n            video.removeEventListener('playing', handlePlaying);\r\n            video.removeEventListener('pause', handlePause);\r\n        };\r\n    }, [serverDayStart]);\r\n\r\n    // 6. ZOOM HANDLER\r\n    const handleWheel = (e) => {\r\n        // ... (rest as before)\r\n        e.preventDefault();\r\n        const canvas = canvasRef.current;\r\n        const rect = canvas.getBoundingClientRect();\r\n        const mouseX = e.clientX - rect.left;\r\n        const mouseTime = xToTime(mouseX, rect.width);\r\n\r\n        const delta = e.deltaY > 0 ? 1.2 : 0.8;\r\n        let newZoom = Math.min(100, Math.max(1, zoom * (e.deltaY > 0 ? 0.8 : 1.2)));\r\n\r\n        const newVisibleMs = DAY_MS / newZoom;\r\n        let newOffset = mouseTime - (mouseX / rect.width) * newVisibleMs;\r\n\r\n        // Clamping\r\n        newOffset = Math.max(-newVisibleMs * 0.1, Math.min(DAY_MS - newVisibleMs * 0.9, newOffset));\r\n\r\n        setZoom(newZoom);\r\n        setOffsetMs(newOffset);\r\n    };\r\n\r\n    // 7. CLICK HANDLER\r\n    const handleCanvasClick = (e) => {\r\n        if (!serverDayStart) return;\r\n        const canvas = canvasRef.current;\r\n        const rect = canvas.getBoundingClientRect();\r\n        const x = e.clientX - rect.left;\r\n        const clickedRelativeMs = xToTime(x, rect.width);\r\n        const absoluteTs = Math.floor(serverDayStart + clickedRelativeMs);\r\n\r\n        setPlayheadMs(clickedRelativeMs);\r\n        setSeekInfo(`Seeking to: ${selectedDate} ${formatTime(clickedRelativeMs)}`);\r\n\r\n        loadPlayback(absoluteTs);\r\n    };\r\n\r\n    const loadPlayback = async (ts) => {\r\n        if (!videoRef.current || !camId) return;\r\n\r\n        // 0. Cancel previous request\r\n        if (abortControllerRef.current) {\r\n            abortControllerRef.current.abort();\r\n        }\r\n        const aborter = new AbortController();\r\n        abortControllerRef.current = aborter;\r\n\r\n        const requestId = ++currentRequestId.current;\r\n\r\n        // Reset state\r\n        setIsLoading(true);\r\n        setIsPlaying(false);\r\n        isSeeking.current = true;\r\n        setSeekInfo(null);\r\n        lastSeekBaseTs.current = ts;\r\n\r\n        const video = videoRef.current;\r\n\r\n        if (window.MediaSource) {\r\n            const ms = new MediaSource();\r\n            video.src = URL.createObjectURL(ms);\r\n\r\n            ms.addEventListener('sourceopen', async () => {\r\n                if (requestId !== currentRequestId.current) return;\r\n\r\n                // H.264 Baseline 3.1\r\n                const codec = 'video/mp4; codecs=\"avc1.42E01F, mp4a.40.2\"';\r\n                if (!MediaSource.isTypeSupported(codec)) {\r\n                    video.src = `${API.defaults.baseURL}/playback/stream/${camId}?ts=${ts}&_nocache=${Date.now()}`;\r\n                    return;\r\n                }\r\n\r\n                const sb = ms.addSourceBuffer(codec);\r\n                sb.mode = 'segments';\r\n\r\n                const url = `${API.defaults.baseURL}/playback/stream/${camId}?ts=${ts}&_nocache=${Date.now()}`;\r\n\r\n                try {\r\n                    const response = await fetch(url, { signal: aborter.signal });\r\n                    if (!response.ok) throw new Error(`HTTP ${response.status}`);\r\n\r\n                    const reader = response.body.getReader();\r\n                    let firstChunk = true;\r\n\r\n                    const push = async () => {\r\n                        if (requestId !== currentRequestId.current) {\r\n                            console.log(\"[MSE] Request stale, stopping push loop\", requestId);\r\n                            return;\r\n                        }\r\n\r\n                        try {\r\n                            const { done, value } = await reader.read();\r\n                            if (done) {\r\n                                if (ms.readyState === 'open') ms.endOfStream();\r\n                                return;\r\n                            }\r\n\r\n                            if (firstChunk) {\r\n                                firstChunk = false;\r\n                                setIsLoading(false);\r\n                            }\r\n\r\n                            // Catch detach errors\r\n                            try {\r\n                                if (sb.updating || (sb.buffered.length > 0 && sb.buffered.end(0) - video.currentTime > 60)) {\r\n                                    setTimeout(push, 200);\r\n                                } else {\r\n                                    sb.appendBuffer(value);\r\n                                    sb.addEventListener('updateend', push, { once: true });\r\n                                }\r\n                            } catch (sbErr) {\r\n                                console.warn(\"[MSE] SourceBuffer error (likely detached)\", sbErr);\r\n                            }\r\n                        } catch (e) {\r\n                            if (e.name !== 'AbortError') console.error(\"[MSE] Read error:\", e);\r\n                        }\r\n                    };\r\n\r\n                    push();\r\n                } catch (err) {\r\n                    if (err.name !== 'AbortError') {\r\n                        console.error(\"[MSE] Fetch failed:\", err);\r\n                        setIsLoading(false);\r\n                    }\r\n                }\r\n            });\r\n\r\n            video.play().catch(() => { });\r\n        } else {\r\n            video.src = `${API.defaults.baseURL}/playback/stream/${camId}?ts=${ts}&_nocache=${Date.now()}`;\r\n            video.load();\r\n            video.play().catch(e => console.error(e));\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"playback-page\" style={{ padding: 20, background: '#1a1a1a', color: '#eee', minHeight: '100vh' }}>\r\n            {/* TOOLBAR */}\r\n            <div style={{ marginBottom: 15, display: 'flex', gap: 15, alignItems: 'center', flexWrap: 'wrap' }}>\r\n                <div style={{ display: 'flex', flexDirection: 'column' }}>\r\n                    <label style={{ fontSize: 11, color: '#888' }}>Camera</label>\r\n                    <select\r\n                        value={camId}\r\n                        onChange={e => setCamId(e.target.value)}\r\n                        style={{ padding: '6px 10px', background: '#333', color: '#fff', border: '1px solid #555', borderRadius: 4 }}\r\n                    >\r\n                        {cameras.map(c => <option key={c.id} value={c.id}>{c.name || c.ip}</option>)}\r\n                    </select>\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', flexDirection: 'column' }}>\r\n                    <label style={{ fontSize: 11, color: '#888' }}>Date</label>\r\n                    <input\r\n                        type=\"date\"\r\n                        value={selectedDate}\r\n                        onChange={e => setSelectedDate(e.target.value)}\r\n                        style={{ padding: '5px 10px', background: '#333', color: '#fff', border: '1px solid #555', borderRadius: 4 }}\r\n                    />\r\n                </div>\r\n\r\n                <button\r\n                    onClick={() => window.location.reload()}\r\n                    style={{\r\n                        marginTop: 15,\r\n                        padding: '7px 15px',\r\n                        cursor: 'pointer',\r\n                        background: '#2ecc71',\r\n                        color: '#000',\r\n                        border: 'none',\r\n                        borderRadius: 4,\r\n                        fontWeight: 'bold'\r\n                    }}\r\n                >\r\n                    Refresh\r\n                </button>\r\n\r\n                <div style={{ flex: 1 }}></div>\r\n\r\n                {seekInfo && (\r\n                    <div style={{ color: '#f1c40f', fontWeight: 'bold', fontSize: 14, background: 'rgba(0,0,0,0.3)', padding: '5px 15px', borderRadius: 20 }}>\r\n                        {seekInfo}\r\n                    </div>\r\n                )}\r\n\r\n                {stats.first && stats.first > 1700000000000 && (\r\n                    <div style={{ fontSize: 12, color: '#2ecc71', textAlign: 'right' }}>\r\n                        <div>Archive range:</div>\r\n                        <div style={{ fontWeight: 'bold' }}>\r\n                            {new Date(stats.first).toLocaleString()} - {new Date(stats.last).toLocaleString()}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* PLAYER */}\r\n            <div className=\"video-container\" style={{ position: 'relative', background: '#000', borderRadius: 8, overflow: 'hidden', boxShadow: '0 10px 30px rgba(0,0,0,0.5)', width: '100%', height: '65vh', marginBottom: 15 }}>\r\n                {isLoading && (\r\n                    <div style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.6)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 10 }}>\r\n                        <div style={{ color: '#fff', fontSize: 18, fontWeight: 'bold' }}>Loading...</div>\r\n                    </div>\r\n                )}\r\n                <video\r\n                    ref={videoRef}\r\n                    id=\"player\"\r\n                    controls\r\n                    autoPlay\r\n                    preload=\"auto\"\r\n                    playsInline\r\n                    style={{ width: '100%', height: '100%' }}\r\n                    onError={(e) => {\r\n                        console.error(\"Video element error:\", e);\r\n                        // Optional: trigger a small retry/reload if stalled\r\n                    }}\r\n                    onStalled={() => {\r\n                        console.warn(\"Playback stalled, waiting for buffer...\");\r\n                    }}\r\n                />\r\n            </div>\r\n\r\n            {/* TIMELINE */}\r\n            <div\r\n                className=\"timeline-container\"\r\n                style={{\r\n                    width: '100%',\r\n                    height: 80,\r\n                    position: 'relative',\r\n                    border: '1px solid #333',\r\n                    borderRadius: 4,\r\n                    overflow: 'hidden'\r\n                }}\r\n            >\r\n                <canvas\r\n                    ref={canvasRef}\r\n                    id=\"timeline\"\r\n                    width={2000}\r\n                    height={80}\r\n                    style={{ width: '100%', height: '100%', cursor: 'crosshair' }}\r\n                    onClick={handleCanvasClick}\r\n                    onWheel={handleWheel}\r\n                />\r\n            </div>\r\n\r\n            <div style={{ marginTop: 10, display: 'flex', justifyContent: 'space-between', color: '#666', fontSize: 11 }}>\r\n                <div>* Use mouse wheel to ZOOM. Click to SEEK.</div>\r\n                <div>Zoom: {zoom.toFixed(1)}x</div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Playback;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,MAAM,CAAEC,QAAQ,CAAEC,WAAW,KAAQ,OAAO,CACvE,MAAO,CAAAC,GAAG,KAAM,QAAQ,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEzB,KAAM,CAAAC,MAAM,CAAG,QAAQ,CACvB,KAAM,CAAAC,OAAO,CAAG,OAAO,CACvB,KAAM,CAAAC,MAAM,CAAG,KAAK,CAEpB,KAAM,CAAAC,QAAQ,CAAGA,CAAA,GAAM,CACnB;AACA,KAAM,CAAAC,SAAS,CAAG,GAAI,CAAAC,eAAe,CAACC,MAAM,CAACC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CACzE,KAAM,CAAAC,OAAO,CAAGN,SAAS,CAACO,GAAG,CAAC,OAAO,CAAC,CAEtC;AACA,KAAM,CAACC,OAAO,CAAEC,UAAU,CAAC,CAAGpB,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACqB,KAAK,CAAEC,QAAQ,CAAC,CAAGtB,QAAQ,CAACiB,OAAO,EAAI,EAAE,CAAC,CACjD,KAAM,CAACM,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGxB,QAAQ,CAAC,EAAE,CAAC,CAC5D,KAAM,CAACyB,cAAc,CAAEC,iBAAiB,CAAC,CAAG1B,QAAQ,CAAC,CAAC,CAAC,CACvD,KAAM,CAAC2B,YAAY,CAAEC,eAAe,CAAC,CAAG5B,QAAQ,CAAC,GAAI,CAAA6B,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CAACd,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CACxF,KAAM,CAACe,KAAK,CAAEC,QAAQ,CAAC,CAAGhC,QAAQ,CAAC,CAAEiC,KAAK,CAAE,IAAI,CAAEC,IAAI,CAAE,IAAK,CAAC,CAAC,CAC/D,KAAM,CAACC,SAAS,CAAEC,YAAY,CAAC,CAAGpC,QAAQ,CAAC,KAAK,CAAC,CAEjD;AACA,KAAM,CAACqC,IAAI,CAAEC,OAAO,CAAC,CAAGtC,QAAQ,CAAC,CAAC,CAAC,CAAE;AACrC,KAAM,CAACuC,QAAQ,CAAEC,WAAW,CAAC,CAAGxC,QAAQ,CAAC,CAAC,CAAC,CAAE;AAC7C,KAAM,CAACyC,UAAU,CAAEC,aAAa,CAAC,CAAG1C,QAAQ,CAAC,IAAI,CAAC,CAAE;AACpD,KAAM,CAAC2C,QAAQ,CAAEC,WAAW,CAAC,CAAG5C,QAAQ,CAAC,IAAI,CAAC,CAAE;AAChD,KAAM,CAAC6C,SAAS,CAAEC,YAAY,CAAC,CAAG9C,QAAQ,CAAC,KAAK,CAAC,CAEjD;AACA,KAAM,CAAA+C,QAAQ,CAAGhD,MAAM,CAAC,IAAI,CAAC,CAC7B,KAAM,CAAAiD,SAAS,CAAGjD,MAAM,CAAC,IAAI,CAAC,CAC9B,KAAM,CAAAkD,cAAc,CAAGlD,MAAM,CAAC,CAAC,CAAC,CAAE;AAClC,KAAM,CAAAmD,SAAS,CAAGnD,MAAM,CAAC,KAAK,CAAC,CAC/B,KAAM,CAAAoD,kBAAkB,CAAGpD,MAAM,CAAC,IAAI,CAAC,CACvC,KAAM,CAAAqD,gBAAgB,CAAGrD,MAAM,CAAC,CAAC,CAAC,CAElC;AACAD,SAAS,CAAC,IAAM,CACZI,GAAG,CAACgB,GAAG,CAAC,UAAU,CAAC,CAACmC,IAAI,CAACC,GAAG,EAAI,CAC5BlC,UAAU,CAACkC,GAAG,CAACC,IAAI,CAAC,CACpB,GAAI,CAAClC,KAAK,EAAIiC,GAAG,CAACC,IAAI,CAACC,MAAM,CAAG,CAAC,CAAElC,QAAQ,CAACgC,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC,CAACE,EAAE,CAAC,CAC/D,CAAC,CAAC,CAACC,KAAK,CAACC,GAAG,EAAIC,OAAO,CAACC,KAAK,CAAC,oBAAoB,CAAEF,GAAG,CAAC,CAAC,CAC7D,CAAC,CAAE,CAACtC,KAAK,CAAC,CAAC,CAEX;AACAvB,SAAS,CAAC,IAAM,CACZ,GAAI,CAACuB,KAAK,CAAE,OACZnB,GAAG,CAACgB,GAAG,oBAAA4C,MAAA,CAAoBzC,KAAK,SAAAyC,MAAA,CAAOjC,IAAI,CAACkC,GAAG,CAAC,CAAC,CAAE,CAAC,CAC/CV,IAAI,CAACC,GAAG,EAAItB,QAAQ,CAACsB,GAAG,CAACC,IAAI,CAAC,CAAC,CAC/BG,KAAK,CAACE,OAAO,CAACC,KAAK,CAAC,CAC7B,CAAC,CAAE,CAACxC,KAAK,CAAC,CAAC,CAEX;AACAvB,SAAS,CAAC,IAAM,CACZ,GAAI,CAACuB,KAAK,CAAE,OACZnB,GAAG,CAACgB,GAAG,2BAAA4C,MAAA,CAA2BzC,KAAK,MAAAyC,MAAA,CAAInC,YAAY,UAAAmC,MAAA,CAAQjC,IAAI,CAACkC,GAAG,CAAC,CAAC,CAAE,CAAC,CACvEV,IAAI,CAACC,GAAG,EAAI,CACT,KAAM,CAAEU,QAAQ,CAAEC,QAAS,CAAC,CAAGX,GAAG,CAACC,IAAI,CACvC7B,iBAAiB,CAACuC,QAAQ,CAAC,CAC3BzC,mBAAmB,CAACwC,QAAQ,EAAI,EAAE,CAAC,CACnC;AACAxB,WAAW,CAAC,CAAC,CAAC,CACdF,OAAO,CAAC,CAAC,CAAC,CACd,CAAC,CAAC,CACDoB,KAAK,CAACC,GAAG,EAAIC,OAAO,CAACC,KAAK,CAAC,gBAAgB,CAAEF,GAAG,CAAC,CAAC,CAC3D,CAAC,CAAE,CAACtC,KAAK,CAAEM,YAAY,CAAC,CAAC,CAEzB;AACA,KAAM,CAAAuC,OAAO,CAAGA,CAACC,EAAE,CAAEC,KAAK,GAAK,CAC3B,KAAM,CAAAC,SAAS,CAAG9D,MAAM,CAAG8B,IAAI,CAC/B,MAAQ,CAAC8B,EAAE,CAAG5B,QAAQ,EAAI8B,SAAS,CAAID,KAAK,CAChD,CAAC,CAED,KAAM,CAAAE,OAAO,CAAGA,CAACC,CAAC,CAAEH,KAAK,GAAK,CAC1B,KAAM,CAAAC,SAAS,CAAG9D,MAAM,CAAG8B,IAAI,CAC/B,MAAO,CAAAE,QAAQ,CAAIgC,CAAC,CAAGH,KAAK,CAAIC,SAAS,CAC7C,CAAC,CAED,KAAM,CAAAG,UAAU,CAAIL,EAAE,EAAK,CACvB,KAAM,CAAAM,YAAY,CAAGC,IAAI,CAACC,KAAK,CAACR,EAAE,CAAG,IAAI,CAAC,CAC1C,KAAM,CAAAS,CAAC,CAAGF,IAAI,CAACC,KAAK,CAACF,YAAY,CAAG,IAAI,CAAC,CACzC,KAAM,CAAAI,CAAC,CAAGH,IAAI,CAACC,KAAK,CAAEF,YAAY,CAAG,IAAI,CAAI,EAAE,CAAC,CAChD,KAAM,CAAAK,CAAC,CAAGL,YAAY,CAAG,EAAE,CAC3B,SAAAX,MAAA,CAAUc,CAAC,CAACG,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,MAAAlB,MAAA,CAAIe,CAAC,CAACE,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,MAAAlB,MAAA,CAAIgB,CAAC,CAACC,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,EAC7G,CAAC,CAED;AACA,KAAM,CAAAC,IAAI,CAAGhF,WAAW,CAAC,IAAM,CAC3B,KAAM,CAAAiF,MAAM,CAAGlC,SAAS,CAACmC,OAAO,CAChC,GAAI,CAACD,MAAM,EAAI,CAACzD,cAAc,CAAE,OAEhC,KAAM,CAAA2D,GAAG,CAAGF,MAAM,CAACG,UAAU,CAAC,IAAI,CAAC,CACnC,KAAM,CAAAjB,KAAK,CAAGc,MAAM,CAACd,KAAK,CAC1B,KAAM,CAAAkB,MAAM,CAAGJ,MAAM,CAACI,MAAM,CAC5B,KAAM,CAAAjB,SAAS,CAAG9D,MAAM,CAAG8B,IAAI,CAE/B;AACA+C,GAAG,CAACG,SAAS,CAAG,MAAM,CACtBH,GAAG,CAACI,QAAQ,CAAC,CAAC,CAAE,CAAC,CAAEpB,KAAK,CAAEkB,MAAM,CAAC,CAEjC;AACA,GAAI,CAAAG,IAAI,CACR,GAAIpB,SAAS,CAAG,EAAE,CAAG7D,OAAO,CAAEiF,IAAI,CAAGjF,OAAO,CAAC,IACxC,IAAI6D,SAAS,CAAG,CAAC,CAAG7D,OAAO,CAAEiF,IAAI,CAAG,EAAE,CAAGhF,MAAM,CAAC,IAChD,IAAI4D,SAAS,CAAG,CAAC,CAAG7D,OAAO,CAAEiF,IAAI,CAAG,EAAE,CAAGhF,MAAM,CAAC,IAChD,CAAAgF,IAAI,CAAG,CAAC,CAAGhF,MAAM,CAEtB2E,GAAG,CAACM,SAAS,CAAG,CAAC,CACjB,IAAK,GAAI,CAAAC,CAAC,CAAGjB,IAAI,CAACC,KAAK,CAACpC,QAAQ,CAAGkD,IAAI,CAAC,CAAGA,IAAI,CAAEE,CAAC,CAAGpD,QAAQ,CAAG8B,SAAS,CAAEsB,CAAC,EAAIF,IAAI,CAAE,CAClF,KAAM,CAAAlB,CAAC,CAAGL,OAAO,CAACyB,CAAC,CAAEvB,KAAK,CAAC,CAC3B,GAAIG,CAAC,CAAG,CAAC,EAAIA,CAAC,CAAGH,KAAK,CAAE,SAExBgB,GAAG,CAACQ,WAAW,CAAG,MAAM,CACxBR,GAAG,CAACS,SAAS,CAAC,CAAC,CACfT,GAAG,CAACU,MAAM,CAACvB,CAAC,CAAE,CAAC,CAAC,CAChBa,GAAG,CAACW,MAAM,CAACxB,CAAC,CAAEe,MAAM,CAAC,CACrBF,GAAG,CAACY,MAAM,CAAC,CAAC,CAEZ;AACA,GAAIL,CAAC,CAAGnF,OAAO,GAAK,CAAC,EAAI6D,SAAS,CAAG,CAAC,CAAG7D,OAAO,CAAE,CAC9C4E,GAAG,CAACG,SAAS,CAAG,MAAM,CACtBH,GAAG,CAACa,IAAI,CAAG,YAAY,CACvB,KAAM,CAAArB,CAAC,CAAGF,IAAI,CAACC,KAAK,CAACgB,CAAC,CAAGnF,OAAO,CAAC,CACjC,KAAM,CAAAqE,CAAC,CAAGH,IAAI,CAACC,KAAK,CAAEgB,CAAC,CAAGnF,OAAO,CAAIC,MAAM,CAAC,CAC5C,GAAIkF,CAAC,EAAI,CAAC,EAAIA,CAAC,EAAIpF,MAAM,CAAE,CACvB6E,GAAG,CAACc,QAAQ,IAAApC,MAAA,CAAIqC,MAAM,CAACvB,CAAC,CAAC,CAACI,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,MAAAlB,MAAA,CAAIqC,MAAM,CAACtB,CAAC,CAAC,CAACG,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,EAAIT,CAAC,CAAG,CAAC,CAAE,EAAE,CAAC,CAC1F,CACJ,CACJ,CAEA;AACAa,GAAG,CAACG,SAAS,CAAG,SAAS,CACzBhE,gBAAgB,CAAC6E,OAAO,CAACtB,CAAC,EAAI,CAC1B,KAAM,CAAAuB,MAAM,CAAGC,MAAM,CAACxB,CAAC,CAACyB,QAAQ,CAAC,CAAG9E,cAAc,CAClD,KAAM,CAAA+E,IAAI,CAAG,CAAC1B,CAAC,CAAC2B,MAAM,GAAK,CAAC,CAAG5E,IAAI,CAACkC,GAAG,CAAC,CAAC,CAAGuC,MAAM,CAACxB,CAAC,CAAC2B,MAAM,CAAC,EAAIhF,cAAc,CAE9E,KAAM,CAAAiF,EAAE,CAAGxC,OAAO,CAACmC,MAAM,CAAEjC,KAAK,CAAC,CACjC,KAAM,CAAAuC,EAAE,CAAGzC,OAAO,CAACsC,IAAI,CAAEpC,KAAK,CAAC,CAC/B,KAAM,CAAAwC,CAAC,CAAGlC,IAAI,CAACmC,GAAG,CAACF,EAAE,CAAGD,EAAE,CAAE,CAAC,CAAC,CAE9B,GAAIA,EAAE,CAAGE,CAAC,CAAG,CAAC,EAAIF,EAAE,CAAGtC,KAAK,CAAE,OAC9BgB,GAAG,CAACI,QAAQ,CAACkB,EAAE,CAAE,EAAE,CAAEE,CAAC,CAAE,EAAE,CAAC,CAC/B,CAAC,CAAC,CAEF;AACA,GAAInE,UAAU,GAAK,IAAI,CAAE,CACrB,KAAM,CAAAqE,EAAE,CAAG5C,OAAO,CAACzB,UAAU,CAAE2B,KAAK,CAAC,CACrC,GAAI0C,EAAE,EAAI,CAAC,EAAIA,EAAE,EAAI1C,KAAK,CAAE,CACxBgB,GAAG,CAACQ,WAAW,CAAG,KAAK,CACvBR,GAAG,CAACM,SAAS,CAAG,CAAC,CACjBN,GAAG,CAACS,SAAS,CAAC,CAAC,CACfT,GAAG,CAACU,MAAM,CAACgB,EAAE,CAAE,CAAC,CAAC,CACjB1B,GAAG,CAACW,MAAM,CAACe,EAAE,CAAExB,MAAM,CAAC,CACtBF,GAAG,CAACY,MAAM,CAAC,CAAC,CAEZ;AACAZ,GAAG,CAACG,SAAS,CAAG,KAAK,CACrBH,GAAG,CAACS,SAAS,CAAC,CAAC,CACfT,GAAG,CAACU,MAAM,CAACgB,EAAE,CAAG,CAAC,CAAE,CAAC,CAAC,CACrB1B,GAAG,CAACW,MAAM,CAACe,EAAE,CAAG,CAAC,CAAE,CAAC,CAAC,CACrB1B,GAAG,CAACW,MAAM,CAACe,EAAE,CAAE,CAAC,CAAC,CACjB1B,GAAG,CAAC2B,IAAI,CAAC,CAAC,CACd,CACJ,CACJ,CAAC,CAAE,CAACxF,gBAAgB,CAAEE,cAAc,CAAEY,IAAI,CAAEE,QAAQ,CAAEE,UAAU,CAAC,CAAC,CAElE3C,SAAS,CAAC,IAAM,CACZmF,IAAI,CAAC,CAAC,CACV,CAAC,CAAE,CAACA,IAAI,CAAC,CAAC,CAEV;AACAnF,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAkH,KAAK,CAAGjE,QAAQ,CAACoC,OAAO,CAC9B,GAAI,CAAC6B,KAAK,CAAE,OAEZ,KAAM,CAAAC,gBAAgB,CAAGA,CAAA,GAAM,CAC3B,GAAI/D,SAAS,CAACiC,OAAO,CAAE,OACvB,GAAIlC,cAAc,CAACkC,OAAO,CAAG,CAAC,CAAE,CAC5B,KAAM,CAAA+B,iBAAiB,CAAGjE,cAAc,CAACkC,OAAO,CAAI6B,KAAK,CAACG,WAAW,CAAG,IAAK,CAC7E,KAAM,CAAAC,UAAU,CAAGF,iBAAiB,CAAGzF,cAAc,CACrDiB,aAAa,CAAC0E,UAAU,CAAC,CAC7B,CACJ,CAAC,CAED,KAAM,CAAAC,gBAAgB,CAAGA,CAAA,GAAM,CAC3BnE,SAAS,CAACiC,OAAO,CAAG,KAAK,CACzBrC,YAAY,CAAC,KAAK,CAAC,CACnBF,WAAW,CAAC,IAAI,CAAC,CACrB,CAAC,CAED,KAAM,CAAA0E,aAAa,CAAGA,CAAA,GAAMlF,YAAY,CAAC,IAAI,CAAC,CAC9C,KAAM,CAAAmF,WAAW,CAAGA,CAAA,GAAMnF,YAAY,CAAC,KAAK,CAAC,CAC7C,KAAM,CAAAoF,aAAa,CAAGA,CAAA,GAAM,CACxBtE,SAAS,CAACiC,OAAO,CAAG,IAAI,CAC5B,CAAC,CAED6B,KAAK,CAACS,gBAAgB,CAAC,YAAY,CAAER,gBAAgB,CAAC,CACtDD,KAAK,CAACS,gBAAgB,CAAC,YAAY,CAAEJ,gBAAgB,CAAC,CACtDL,KAAK,CAACS,gBAAgB,CAAC,SAAS,CAAED,aAAa,CAAC,CAChDR,KAAK,CAACS,gBAAgB,CAAC,SAAS,CAAEH,aAAa,CAAC,CAChDN,KAAK,CAACS,gBAAgB,CAAC,OAAO,CAAEF,WAAW,CAAC,CAE5C,MAAO,IAAM,CACTP,KAAK,CAACU,mBAAmB,CAAC,YAAY,CAAET,gBAAgB,CAAC,CACzDD,KAAK,CAACU,mBAAmB,CAAC,YAAY,CAAEL,gBAAgB,CAAC,CACzDL,KAAK,CAACU,mBAAmB,CAAC,SAAS,CAAEF,aAAa,CAAC,CACnDR,KAAK,CAACU,mBAAmB,CAAC,SAAS,CAAEJ,aAAa,CAAC,CACnDN,KAAK,CAACU,mBAAmB,CAAC,OAAO,CAAEH,WAAW,CAAC,CACnD,CAAC,CACL,CAAC,CAAE,CAAC9F,cAAc,CAAC,CAAC,CAEpB;AACA,KAAM,CAAAkG,WAAW,CAAIC,CAAC,EAAK,CACvB;AACAA,CAAC,CAACC,cAAc,CAAC,CAAC,CAClB,KAAM,CAAA3C,MAAM,CAAGlC,SAAS,CAACmC,OAAO,CAChC,KAAM,CAAA2C,IAAI,CAAG5C,MAAM,CAAC6C,qBAAqB,CAAC,CAAC,CAC3C,KAAM,CAAAC,MAAM,CAAGJ,CAAC,CAACK,OAAO,CAAGH,IAAI,CAACI,IAAI,CACpC,KAAM,CAAAC,SAAS,CAAG7D,OAAO,CAAC0D,MAAM,CAAEF,IAAI,CAAC1D,KAAK,CAAC,CAE7C,KAAM,CAAAgE,KAAK,CAAGR,CAAC,CAACS,MAAM,CAAG,CAAC,CAAG,GAAG,CAAG,GAAG,CACtC,GAAI,CAAAC,OAAO,CAAG5D,IAAI,CAAC6D,GAAG,CAAC,GAAG,CAAE7D,IAAI,CAACmC,GAAG,CAAC,CAAC,CAAExE,IAAI,EAAIuF,CAAC,CAACS,MAAM,CAAG,CAAC,CAAG,GAAG,CAAG,GAAG,CAAC,CAAC,CAAC,CAE3E,KAAM,CAAAG,YAAY,CAAGjI,MAAM,CAAG+H,OAAO,CACrC,GAAI,CAAAG,SAAS,CAAGN,SAAS,CAAIH,MAAM,CAAGF,IAAI,CAAC1D,KAAK,CAAIoE,YAAY,CAEhE;AACAC,SAAS,CAAG/D,IAAI,CAACmC,GAAG,CAAC,CAAC2B,YAAY,CAAG,GAAG,CAAE9D,IAAI,CAAC6D,GAAG,CAAChI,MAAM,CAAGiI,YAAY,CAAG,GAAG,CAAEC,SAAS,CAAC,CAAC,CAE3FnG,OAAO,CAACgG,OAAO,CAAC,CAChB9F,WAAW,CAACiG,SAAS,CAAC,CAC1B,CAAC,CAED;AACA,KAAM,CAAAC,iBAAiB,CAAId,CAAC,EAAK,CAC7B,GAAI,CAACnG,cAAc,CAAE,OACrB,KAAM,CAAAyD,MAAM,CAAGlC,SAAS,CAACmC,OAAO,CAChC,KAAM,CAAA2C,IAAI,CAAG5C,MAAM,CAAC6C,qBAAqB,CAAC,CAAC,CAC3C,KAAM,CAAAxD,CAAC,CAAGqD,CAAC,CAACK,OAAO,CAAGH,IAAI,CAACI,IAAI,CAC/B,KAAM,CAAAS,iBAAiB,CAAGrE,OAAO,CAACC,CAAC,CAAEuD,IAAI,CAAC1D,KAAK,CAAC,CAChD,KAAM,CAAAwE,UAAU,CAAGlE,IAAI,CAACC,KAAK,CAAClD,cAAc,CAAGkH,iBAAiB,CAAC,CAEjEjG,aAAa,CAACiG,iBAAiB,CAAC,CAChC/F,WAAW,gBAAAkB,MAAA,CAAgBnC,YAAY,MAAAmC,MAAA,CAAIU,UAAU,CAACmE,iBAAiB,CAAC,CAAE,CAAC,CAE3EE,YAAY,CAACD,UAAU,CAAC,CAC5B,CAAC,CAED,KAAM,CAAAC,YAAY,CAAG,KAAO,CAAAC,EAAE,EAAK,CAC/B,GAAI,CAAC/F,QAAQ,CAACoC,OAAO,EAAI,CAAC9D,KAAK,CAAE,OAEjC;AACA,GAAI8B,kBAAkB,CAACgC,OAAO,CAAE,CAC5BhC,kBAAkB,CAACgC,OAAO,CAAC4D,KAAK,CAAC,CAAC,CACtC,CACA,KAAM,CAAAC,OAAO,CAAG,GAAI,CAAAC,eAAe,CAAC,CAAC,CACrC9F,kBAAkB,CAACgC,OAAO,CAAG6D,OAAO,CAEpC,KAAM,CAAAE,SAAS,CAAG,EAAE9F,gBAAgB,CAAC+B,OAAO,CAE5C;AACArC,YAAY,CAAC,IAAI,CAAC,CAClBV,YAAY,CAAC,KAAK,CAAC,CACnBc,SAAS,CAACiC,OAAO,CAAG,IAAI,CACxBvC,WAAW,CAAC,IAAI,CAAC,CACjBK,cAAc,CAACkC,OAAO,CAAG2D,EAAE,CAE3B,KAAM,CAAA9B,KAAK,CAAGjE,QAAQ,CAACoC,OAAO,CAE9B,GAAItE,MAAM,CAACsI,WAAW,CAAE,CACpB,KAAM,CAAAhF,EAAE,CAAG,GAAI,CAAAgF,WAAW,CAAC,CAAC,CAC5BnC,KAAK,CAACoC,GAAG,CAAGC,GAAG,CAACC,eAAe,CAACnF,EAAE,CAAC,CAEnCA,EAAE,CAACsD,gBAAgB,CAAC,YAAY,CAAE,SAAY,CAC1C,GAAIyB,SAAS,GAAK9F,gBAAgB,CAAC+B,OAAO,CAAE,OAE5C;AACA,KAAM,CAAAoE,KAAK,CAAG,4CAA4C,CAC1D,GAAI,CAACJ,WAAW,CAACK,eAAe,CAACD,KAAK,CAAC,CAAE,CACrCvC,KAAK,CAACoC,GAAG,IAAAtF,MAAA,CAAM5D,GAAG,CAACuJ,QAAQ,CAACC,OAAO,sBAAA5F,MAAA,CAAoBzC,KAAK,SAAAyC,MAAA,CAAOgF,EAAE,eAAAhF,MAAA,CAAajC,IAAI,CAACkC,GAAG,CAAC,CAAC,CAAE,CAC9F,OACJ,CAEA,KAAM,CAAA4F,EAAE,CAAGxF,EAAE,CAACyF,eAAe,CAACL,KAAK,CAAC,CACpCI,EAAE,CAACE,IAAI,CAAG,UAAU,CAEpB,KAAM,CAAAC,GAAG,IAAAhG,MAAA,CAAM5D,GAAG,CAACuJ,QAAQ,CAACC,OAAO,sBAAA5F,MAAA,CAAoBzC,KAAK,SAAAyC,MAAA,CAAOgF,EAAE,eAAAhF,MAAA,CAAajC,IAAI,CAACkC,GAAG,CAAC,CAAC,CAAE,CAE9F,GAAI,CACA,KAAM,CAAAgG,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACF,GAAG,CAAE,CAAEG,MAAM,CAAEjB,OAAO,CAACiB,MAAO,CAAC,CAAC,CAC7D,GAAI,CAACF,QAAQ,CAACG,EAAE,CAAE,KAAM,IAAI,CAAAC,KAAK,SAAArG,MAAA,CAASiG,QAAQ,CAACK,MAAM,CAAE,CAAC,CAE5D,KAAM,CAAAC,MAAM,CAAGN,QAAQ,CAACO,IAAI,CAACC,SAAS,CAAC,CAAC,CACxC,GAAI,CAAAC,UAAU,CAAG,IAAI,CAErB,KAAM,CAAAC,IAAI,CAAG,KAAAA,CAAA,GAAY,CACrB,GAAIvB,SAAS,GAAK9F,gBAAgB,CAAC+B,OAAO,CAAE,CACxCvB,OAAO,CAAC8G,GAAG,CAAC,yCAAyC,CAAExB,SAAS,CAAC,CACjE,OACJ,CAEA,GAAI,CACA,KAAM,CAAEyB,IAAI,CAAEC,KAAM,CAAC,CAAG,KAAM,CAAAP,MAAM,CAACQ,IAAI,CAAC,CAAC,CAC3C,GAAIF,IAAI,CAAE,CACN,GAAIxG,EAAE,CAAC2G,UAAU,GAAK,MAAM,CAAE3G,EAAE,CAAC4G,WAAW,CAAC,CAAC,CAC9C,OACJ,CAEA,GAAIP,UAAU,CAAE,CACZA,UAAU,CAAG,KAAK,CAClB1H,YAAY,CAAC,KAAK,CAAC,CACvB,CAEA;AACA,GAAI,CACA,GAAI6G,EAAE,CAACqB,QAAQ,EAAKrB,EAAE,CAACsB,QAAQ,CAACzH,MAAM,CAAG,CAAC,EAAImG,EAAE,CAACsB,QAAQ,CAACC,GAAG,CAAC,CAAC,CAAC,CAAGlE,KAAK,CAACG,WAAW,CAAG,EAAG,CAAE,CACxFgE,UAAU,CAACV,IAAI,CAAE,GAAG,CAAC,CACzB,CAAC,IAAM,CACHd,EAAE,CAACyB,YAAY,CAACR,KAAK,CAAC,CACtBjB,EAAE,CAAClC,gBAAgB,CAAC,WAAW,CAAEgD,IAAI,CAAE,CAAEY,IAAI,CAAE,IAAK,CAAC,CAAC,CAC1D,CACJ,CAAE,MAAOC,KAAK,CAAE,CACZ1H,OAAO,CAAC2H,IAAI,CAAC,4CAA4C,CAAED,KAAK,CAAC,CACrE,CACJ,CAAE,MAAO1D,CAAC,CAAE,CACR,GAAIA,CAAC,CAAC4D,IAAI,GAAK,YAAY,CAAE5H,OAAO,CAACC,KAAK,CAAC,mBAAmB,CAAE+D,CAAC,CAAC,CACtE,CACJ,CAAC,CAED6C,IAAI,CAAC,CAAC,CACV,CAAE,MAAO9G,GAAG,CAAE,CACV,GAAIA,GAAG,CAAC6H,IAAI,GAAK,YAAY,CAAE,CAC3B5H,OAAO,CAACC,KAAK,CAAC,qBAAqB,CAAEF,GAAG,CAAC,CACzCb,YAAY,CAAC,KAAK,CAAC,CACvB,CACJ,CACJ,CAAC,CAAC,CAEFkE,KAAK,CAACyE,IAAI,CAAC,CAAC,CAAC/H,KAAK,CAAC,IAAM,CAAE,CAAC,CAAC,CACjC,CAAC,IAAM,CACHsD,KAAK,CAACoC,GAAG,IAAAtF,MAAA,CAAM5D,GAAG,CAACuJ,QAAQ,CAACC,OAAO,sBAAA5F,MAAA,CAAoBzC,KAAK,SAAAyC,MAAA,CAAOgF,EAAE,eAAAhF,MAAA,CAAajC,IAAI,CAACkC,GAAG,CAAC,CAAC,CAAE,CAC9FiD,KAAK,CAAC0E,IAAI,CAAC,CAAC,CACZ1E,KAAK,CAACyE,IAAI,CAAC,CAAC,CAAC/H,KAAK,CAACkE,CAAC,EAAIhE,OAAO,CAACC,KAAK,CAAC+D,CAAC,CAAC,CAAC,CAC7C,CACJ,CAAC,CAED,mBACItH,KAAA,QAAKqL,SAAS,CAAC,eAAe,CAACC,KAAK,CAAE,CAAEC,OAAO,CAAE,EAAE,CAAEC,UAAU,CAAE,SAAS,CAAEC,KAAK,CAAE,MAAM,CAAEC,SAAS,CAAE,OAAQ,CAAE,CAAAC,QAAA,eAE5G3L,KAAA,QAAKsL,KAAK,CAAE,CAAEM,YAAY,CAAE,EAAE,CAAEC,OAAO,CAAE,MAAM,CAAEC,GAAG,CAAE,EAAE,CAAEC,UAAU,CAAE,QAAQ,CAAEC,QAAQ,CAAE,MAAO,CAAE,CAAAL,QAAA,eAC/F3L,KAAA,QAAKsL,KAAK,CAAE,CAAEO,OAAO,CAAE,MAAM,CAAEI,aAAa,CAAE,QAAS,CAAE,CAAAN,QAAA,eACrD7L,IAAA,UAAOwL,KAAK,CAAE,CAAEY,QAAQ,CAAE,EAAE,CAAET,KAAK,CAAE,MAAO,CAAE,CAAAE,QAAA,CAAC,QAAM,CAAO,CAAC,cAC7D7L,IAAA,WACIwK,KAAK,CAAEvJ,KAAM,CACboL,QAAQ,CAAE7E,CAAC,EAAItG,QAAQ,CAACsG,CAAC,CAAC8E,MAAM,CAAC9B,KAAK,CAAE,CACxCgB,KAAK,CAAE,CAAEC,OAAO,CAAE,UAAU,CAAEC,UAAU,CAAE,MAAM,CAAEC,KAAK,CAAE,MAAM,CAAEY,MAAM,CAAE,gBAAgB,CAAEC,YAAY,CAAE,CAAE,CAAE,CAAAX,QAAA,CAE5G9K,OAAO,CAAC0L,GAAG,CAACC,CAAC,eAAI1M,IAAA,WAAmBwK,KAAK,CAAEkC,CAAC,CAACrJ,EAAG,CAAAwI,QAAA,CAAEa,CAAC,CAACtB,IAAI,EAAIsB,CAAC,CAACC,EAAE,EAAlCD,CAAC,CAACrJ,EAAyC,CAAC,CAAC,CACxE,CAAC,EACR,CAAC,cAENnD,KAAA,QAAKsL,KAAK,CAAE,CAAEO,OAAO,CAAE,MAAM,CAAEI,aAAa,CAAE,QAAS,CAAE,CAAAN,QAAA,eACrD7L,IAAA,UAAOwL,KAAK,CAAE,CAAEY,QAAQ,CAAE,EAAE,CAAET,KAAK,CAAE,MAAO,CAAE,CAAAE,QAAA,CAAC,MAAI,CAAO,CAAC,cAC3D7L,IAAA,UACI4M,IAAI,CAAC,MAAM,CACXpC,KAAK,CAAEjJ,YAAa,CACpB8K,QAAQ,CAAE7E,CAAC,EAAIhG,eAAe,CAACgG,CAAC,CAAC8E,MAAM,CAAC9B,KAAK,CAAE,CAC/CgB,KAAK,CAAE,CAAEC,OAAO,CAAE,UAAU,CAAEC,UAAU,CAAE,MAAM,CAAEC,KAAK,CAAE,MAAM,CAAEY,MAAM,CAAE,gBAAgB,CAAEC,YAAY,CAAE,CAAE,CAAE,CAChH,CAAC,EACD,CAAC,cAENxM,IAAA,WACI6M,OAAO,CAAEA,CAAA,GAAMpM,MAAM,CAACC,QAAQ,CAACoM,MAAM,CAAC,CAAE,CACxCtB,KAAK,CAAE,CACHuB,SAAS,CAAE,EAAE,CACbtB,OAAO,CAAE,UAAU,CACnBuB,MAAM,CAAE,SAAS,CACjBtB,UAAU,CAAE,SAAS,CACrBC,KAAK,CAAE,MAAM,CACbY,MAAM,CAAE,MAAM,CACdC,YAAY,CAAE,CAAC,CACfS,UAAU,CAAE,MAChB,CAAE,CAAApB,QAAA,CACL,SAED,CAAQ,CAAC,cAET7L,IAAA,QAAKwL,KAAK,CAAE,CAAE0B,IAAI,CAAE,CAAE,CAAE,CAAM,CAAC,CAE9B3K,QAAQ,eACLvC,IAAA,QAAKwL,KAAK,CAAE,CAAEG,KAAK,CAAE,SAAS,CAAEsB,UAAU,CAAE,MAAM,CAAEb,QAAQ,CAAE,EAAE,CAAEV,UAAU,CAAE,iBAAiB,CAAED,OAAO,CAAE,UAAU,CAAEe,YAAY,CAAE,EAAG,CAAE,CAAAX,QAAA,CACpItJ,QAAQ,CACR,CACR,CAEAZ,KAAK,CAACE,KAAK,EAAIF,KAAK,CAACE,KAAK,CAAG,aAAa,eACvC3B,KAAA,QAAKsL,KAAK,CAAE,CAAEY,QAAQ,CAAE,EAAE,CAAET,KAAK,CAAE,SAAS,CAAEwB,SAAS,CAAE,OAAQ,CAAE,CAAAtB,QAAA,eAC/D7L,IAAA,QAAA6L,QAAA,CAAK,gBAAc,CAAK,CAAC,cACzB3L,KAAA,QAAKsL,KAAK,CAAE,CAAEyB,UAAU,CAAE,MAAO,CAAE,CAAApB,QAAA,EAC9B,GAAI,CAAApK,IAAI,CAACE,KAAK,CAACE,KAAK,CAAC,CAACuL,cAAc,CAAC,CAAC,CAAC,KAAG,CAAC,GAAI,CAAA3L,IAAI,CAACE,KAAK,CAACG,IAAI,CAAC,CAACsL,cAAc,CAAC,CAAC,EAChF,CAAC,EACL,CACR,EACA,CAAC,cAGNlN,KAAA,QAAKqL,SAAS,CAAC,iBAAiB,CAACC,KAAK,CAAE,CAAE6B,QAAQ,CAAE,UAAU,CAAE3B,UAAU,CAAE,MAAM,CAAEc,YAAY,CAAE,CAAC,CAAEc,QAAQ,CAAE,QAAQ,CAAEC,SAAS,CAAE,6BAA6B,CAAEvJ,KAAK,CAAE,MAAM,CAAEkB,MAAM,CAAE,MAAM,CAAE4G,YAAY,CAAE,EAAG,CAAE,CAAAD,QAAA,EAChNpJ,SAAS,eACNzC,IAAA,QAAKwL,KAAK,CAAE,CAAE6B,QAAQ,CAAE,UAAU,CAAEG,GAAG,CAAE,CAAC,CAAE1F,IAAI,CAAE,CAAC,CAAE2F,KAAK,CAAE,CAAC,CAAEC,MAAM,CAAE,CAAC,CAAEhC,UAAU,CAAE,iBAAiB,CAAEK,OAAO,CAAE,MAAM,CAAEE,UAAU,CAAE,QAAQ,CAAE0B,cAAc,CAAE,QAAQ,CAAEC,MAAM,CAAE,EAAG,CAAE,CAAA/B,QAAA,cACnL7L,IAAA,QAAKwL,KAAK,CAAE,CAAEG,KAAK,CAAE,MAAM,CAAES,QAAQ,CAAE,EAAE,CAAEa,UAAU,CAAE,MAAO,CAAE,CAAApB,QAAA,CAAC,YAAU,CAAK,CAAC,CAChF,CACR,cACD7L,IAAA,UACI6N,GAAG,CAAElL,QAAS,CACdU,EAAE,CAAC,QAAQ,CACXyK,QAAQ,MACRC,QAAQ,MACRC,OAAO,CAAC,MAAM,CACdC,WAAW,MACXzC,KAAK,CAAE,CAAExH,KAAK,CAAE,MAAM,CAAEkB,MAAM,CAAE,MAAO,CAAE,CACzCgJ,OAAO,CAAG1G,CAAC,EAAK,CACZhE,OAAO,CAACC,KAAK,CAAC,sBAAsB,CAAE+D,CAAC,CAAC,CACxC;AACJ,CAAE,CACF2G,SAAS,CAAEA,CAAA,GAAM,CACb3K,OAAO,CAAC2H,IAAI,CAAC,yCAAyC,CAAC,CAC3D,CAAE,CACL,CAAC,EACD,CAAC,cAGNnL,IAAA,QACIuL,SAAS,CAAC,oBAAoB,CAC9BC,KAAK,CAAE,CACHxH,KAAK,CAAE,MAAM,CACbkB,MAAM,CAAE,EAAE,CACVmI,QAAQ,CAAE,UAAU,CACpBd,MAAM,CAAE,gBAAgB,CACxBC,YAAY,CAAE,CAAC,CACfc,QAAQ,CAAE,QACd,CAAE,CAAAzB,QAAA,cAEF7L,IAAA,WACI6N,GAAG,CAAEjL,SAAU,CACfS,EAAE,CAAC,UAAU,CACbW,KAAK,CAAE,IAAK,CACZkB,MAAM,CAAE,EAAG,CACXsG,KAAK,CAAE,CAAExH,KAAK,CAAE,MAAM,CAAEkB,MAAM,CAAE,MAAM,CAAE8H,MAAM,CAAE,WAAY,CAAE,CAC9DH,OAAO,CAAEvE,iBAAkB,CAC3B8F,OAAO,CAAE7G,WAAY,CACxB,CAAC,CACD,CAAC,cAENrH,KAAA,QAAKsL,KAAK,CAAE,CAAEuB,SAAS,CAAE,EAAE,CAAEhB,OAAO,CAAE,MAAM,CAAE4B,cAAc,CAAE,eAAe,CAAEhC,KAAK,CAAE,MAAM,CAAES,QAAQ,CAAE,EAAG,CAAE,CAAAP,QAAA,eACzG7L,IAAA,QAAA6L,QAAA,CAAK,2CAAyC,CAAK,CAAC,cACpD3L,KAAA,QAAA2L,QAAA,EAAK,QAAM,CAAC5J,IAAI,CAACoM,OAAO,CAAC,CAAC,CAAC,CAAC,GAAC,EAAK,CAAC,EAClC,CAAC,EACL,CAAC,CAEd,CAAC,CAED,cAAe,CAAA/N,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}