{"ast":null,"code":"import _objectSpread from\"I:/dispecerat/github_release/dss-edge/local-ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";export default function RecorderPlayer(_ref){let{camId,streamType,style}=_ref;const videoRef=useRef(null);const hlsRef=useRef(null);useEffect(()=>{const video=videoRef.current;if(!video)return;const hlsUrl=\"/api/playback/live/\".concat(camId,\".m3u8\");const initHls=()=>{if(window.Hls&&window.Hls.isSupported()){if(hlsRef.current)hlsRef.current.destroy();const hls=new window.Hls({debug:false,enableWorker:true,// CRITICAL FOR LIVE STREAMING\n// Force HLS.js to treat this as a live stream that never ends\nliveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,liveDurationInfinity:true,// Aggressive manifest reloading\nmanifestLoadingTimeOut:10000,manifestLoadingMaxRetry:Infinity,manifestLoadingRetryDelay:1000,levelLoadingTimeOut:10000,levelLoadingMaxRetry:Infinity,// Buffer management\nmaxBufferLength:30,maxMaxBufferLength:60,backBufferLength:10});hls.loadSource(hlsUrl);hls.attachMedia(video);hls.on(window.Hls.Events.MANIFEST_PARSED,()=>{console.log('[RecorderPlayer] Manifest parsed');video.play().catch(e=>console.warn(\"Autoplay blocked\",e));});hls.on(window.Hls.Events.MANIFEST_LOADED,(event,data)=>{console.log('[RecorderPlayer] Manifest loaded, live:',data.details.live);});hls.on(window.Hls.Events.ERROR,(event,data)=>{if(data.fatal){console.error('[RecorderPlayer] Fatal error:',data.type,data.details);switch(data.type){case window.Hls.ErrorTypes.NETWORK_ERROR:console.log('[RecorderPlayer] Recovering from network error...');setTimeout(()=>hls.startLoad(),1000);break;case window.Hls.ErrorTypes.MEDIA_ERROR:console.log('[RecorderPlayer] Recovering from media error...');hls.recoverMediaError();break;default:console.error('[RecorderPlayer] Unrecoverable error');hls.destroy();break;}}});hlsRef.current=hls;}else if(video.canPlayType('application/vnd.apple.mpegurl')){video.src=hlsUrl;video.addEventListener('loadedmetadata',()=>video.play());}};if(!window.Hls&&typeof Hls==='undefined'){const script=document.createElement('script');script.src=\"https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js\";script.onload=initHls;document.head.appendChild(script);}else{initHls();}return()=>{if(hlsRef.current)hlsRef.current.destroy();};},[camId]);return/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},style),{},{position:'relative',background:'#000',overflow:'hidden'}),children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,style:{width:'100%',height:'100%',objectFit:'contain',display:'block'},autoPlay:true,muted:true,playsInline:true})});}","map":{"version":3,"names":["React","useEffect","useRef","jsx","_jsx","RecorderPlayer","_ref","camId","streamType","style","videoRef","hlsRef","video","current","hlsUrl","concat","initHls","window","Hls","isSupported","destroy","hls","debug","enableWorker","liveSyncDurationCount","liveMaxLatencyDurationCount","Infinity","liveDurationInfinity","manifestLoadingTimeOut","manifestLoadingMaxRetry","manifestLoadingRetryDelay","levelLoadingTimeOut","levelLoadingMaxRetry","maxBufferLength","maxMaxBufferLength","backBufferLength","loadSource","attachMedia","on","Events","MANIFEST_PARSED","console","log","play","catch","e","warn","MANIFEST_LOADED","event","data","details","live","ERROR","fatal","error","type","ErrorTypes","NETWORK_ERROR","setTimeout","startLoad","MEDIA_ERROR","recoverMediaError","canPlayType","src","addEventListener","script","document","createElement","onload","head","appendChild","_objectSpread","position","background","overflow","children","ref","width","height","objectFit","display","autoPlay","muted","playsInline"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/components/RecorderPlayer.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\n\r\nexport default function RecorderPlayer({ camId, streamType, style }) {\r\n    const videoRef = useRef(null);\r\n    const hlsRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        const video = videoRef.current;\r\n        if (!video) return;\r\n\r\n        const hlsUrl = `/api/playback/live/${camId}.m3u8`;\r\n\r\n        const initHls = () => {\r\n            if (window.Hls && window.Hls.isSupported()) {\r\n                if (hlsRef.current) hlsRef.current.destroy();\r\n\r\n                const hls = new window.Hls({\r\n                    debug: false,\r\n                    enableWorker: true,\r\n\r\n                    // CRITICAL FOR LIVE STREAMING\r\n                    // Force HLS.js to treat this as a live stream that never ends\r\n                    liveSyncDurationCount: 3,\r\n                    liveMaxLatencyDurationCount: Infinity,\r\n                    liveDurationInfinity: true,\r\n\r\n                    // Aggressive manifest reloading\r\n                    manifestLoadingTimeOut: 10000,\r\n                    manifestLoadingMaxRetry: Infinity,\r\n                    manifestLoadingRetryDelay: 1000,\r\n                    levelLoadingTimeOut: 10000,\r\n                    levelLoadingMaxRetry: Infinity,\r\n\r\n                    // Buffer management\r\n                    maxBufferLength: 30,\r\n                    maxMaxBufferLength: 60,\r\n                    backBufferLength: 10,\r\n                });\r\n\r\n                hls.loadSource(hlsUrl);\r\n                hls.attachMedia(video);\r\n\r\n                hls.on(window.Hls.Events.MANIFEST_PARSED, () => {\r\n                    console.log('[RecorderPlayer] Manifest parsed');\r\n                    video.play().catch(e => console.warn(\"Autoplay blocked\", e));\r\n                });\r\n\r\n                hls.on(window.Hls.Events.MANIFEST_LOADED, (event, data) => {\r\n                    console.log('[RecorderPlayer] Manifest loaded, live:', data.details.live);\r\n                });\r\n\r\n                hls.on(window.Hls.Events.ERROR, (event, data) => {\r\n                    if (data.fatal) {\r\n                        console.error('[RecorderPlayer] Fatal error:', data.type, data.details);\r\n                        switch (data.type) {\r\n                            case window.Hls.ErrorTypes.NETWORK_ERROR:\r\n                                console.log('[RecorderPlayer] Recovering from network error...');\r\n                                setTimeout(() => hls.startLoad(), 1000);\r\n                                break;\r\n                            case window.Hls.ErrorTypes.MEDIA_ERROR:\r\n                                console.log('[RecorderPlayer] Recovering from media error...');\r\n                                hls.recoverMediaError();\r\n                                break;\r\n                            default:\r\n                                console.error('[RecorderPlayer] Unrecoverable error');\r\n                                hls.destroy();\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                hlsRef.current = hls;\r\n            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {\r\n                video.src = hlsUrl;\r\n                video.addEventListener('loadedmetadata', () => video.play());\r\n            }\r\n        };\r\n\r\n        if (!window.Hls && typeof Hls === 'undefined') {\r\n            const script = document.createElement('script');\r\n            script.src = \"https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js\";\r\n            script.onload = initHls;\r\n            document.head.appendChild(script);\r\n        } else {\r\n            initHls();\r\n        }\r\n\r\n        return () => {\r\n            if (hlsRef.current) hlsRef.current.destroy();\r\n        };\r\n    }, [camId]);\r\n\r\n    return (\r\n        <div style={{ ...style, position: 'relative', background: '#000', overflow: 'hidden' }}>\r\n            <video\r\n                ref={videoRef}\r\n                style={{\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    objectFit: 'contain',\r\n                    display: 'block'\r\n                }}\r\n                autoPlay\r\n                muted\r\n                playsInline\r\n            />\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}