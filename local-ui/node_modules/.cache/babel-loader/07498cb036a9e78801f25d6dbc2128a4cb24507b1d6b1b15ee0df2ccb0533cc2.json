{"ast":null,"code":"import React,{useEffect,useState,useRef,useCallback}from\"react\";import{useSearchParams}from\"react-router-dom\";import API from\"../api\";import Hls from'hls.js';/* STYLES */import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const styles=\"\\n* { box-sizing: border-box; margin: 0; padding: 0; }\\nbody { background: #1a1a1a; color: #ccc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }\\n.playback-page { height: 100vh; display: flex; flex-direction: column; background: #1a1a1a; }\\n\\n/* HEADER */\\n.playback-header { \\n    height: 48px; background: #111; border-bottom: 1px solid #333; \\n    display: flex; align-items: center; padding: 0 16px; gap: 16px; \\n}\\n.header-title { font-size: 14px; font-weight: 600; color: #fff; margin-right: auto; }\\n.date-selector { \\n    background: #222; border: 1px solid #444; color: #fff; \\n    padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 13px;\\n    display: flex; align-items: center; gap: 8px;\\n}\\n.date-selector:hover { background: #333; border-color: #666; }\\n\\n/* CALENDAR POPUP */\\n.calendar-popup {\\n    position: absolute; top: 50px; left: 50%; transform: translateX(-50%);\\n    width: 280px; background: #222; border: 1px solid #555; border-radius: 6px;\\n    box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 2000;\\n    padding: 10px;\\n}\\n.cal-header { display: flex; justify-content: space-between; margin-bottom: 10px; color: #fff; }\\n.cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }\\n.cal-day { \\n    height: 30px; display: flex; align-items: center; justify-content: center; \\n    font-size: 12px; border-radius: 3px; cursor: default; color: #555;\\n}\\n.cal-day.has-data { \\n    color: #4da6ff; font-weight: bold; cursor: pointer; background: rgba(77, 166, 255, 0.1); \\n}\\n.cal-day.has-data:hover { background: #4da6ff; color: #000; }\\n.cal-day.selected { background: #fff; color: #000; border: 1px solid #4da6ff; }\\n.cal-btn { background: none; border: none; color: #aaa; cursor: pointer; }\\n.cal-btn:hover { color: #fff; }\\n\\n/* VIDEO */\\n.video-viewport { flex: 1; background: #000; position: relative; display:flex; align-items:center; justify-content:center; }\\nvideo { width: 100%; height: 100%; object-fit: contain; }\\n\\n/* CONTROLS & TIMELINE */\\n.timeline-area { height: 100px; background: #0f0f0f; border-top: 1px solid #333; position: relative; user-select: none; cursor: crosshair; }\\n.time-ticks { position: absolute; top: 0; width: 100%; height: 20px; display: flex; pointer-events: none; }\\n.tick { flex: 1; border-left: 1px solid #333; font-size: 10px; color: #666; padding-left: 2px; }\\n.segments-track { position: absolute; top: 25px; bottom: 0; width: 100%; background: rgba(255,255,255,0.01); }\\n.segment { position: absolute; top: 5px; height: 30px; background: #1f9d55; min-width: 2px; opacity: 0.9; }\\n.playhead { position: absolute; top: 0; bottom: 0; width: 2px; background: #f00; z-index: 50; pointer-events: none; }\\n.controls { height: 40px; background: #111; display: flex; align-items: center; gap: 10px; padding: 0 10px; border-top: 1px solid #222; }\\n.btn { background: #333; color: #eee; border: 1px solid #444; padding: 4px 12px; cursor: pointer; font-size: 12px; }\\n.btn:hover { background: #444; }\\n.btn-primary { background: #0055aa; border-color: #004488; }\\n.backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; }\\n\";export default function Playback(){const[params]=useSearchParams();const camId=params.get(\"camId\");const[selectedDate,setSelectedDate]=useState(()=>{const d=new Date();const offset=d.getTimezoneOffset()*60000;return new Date(d.getTime()-offset).toISOString().split('T')[0];});const[timelineSegments,setTimelineSegments]=useState([]);const[serverDayStart,setServerDayStart]=useState(0);const[isPlaying,setIsPlaying]=useState(false);// Calendar State\nconst[showCal,setShowCal]=useState(false);const[calYear,setCalYear]=useState(new Date().getFullYear());const[calMonth,setCalMonth]=useState(new Date().getMonth()+1);const[daysWithData,setDaysWithData]=useState([]);const videoRef=useRef(null);const hlsRef=useRef(null);const cursorRef=useRef(null);const timelineRef=useRef(null);// FETCH CALENDAR DATA\nuseEffect(()=>{if(!showCal||!camId)return;API.get(\"/playback/calendar-month/\".concat(camId,\"/\").concat(calYear,\"/\").concat(calMonth,\"?_ts=\").concat(Date.now())).then(res=>setDaysWithData(res.data.days||[])).catch(console.error);},[showCal,calYear,calMonth,camId]);// FETCH TIMELINE\nuseEffect(()=>{if(!camId||!selectedDate)return;console.log(\"Fetching timeline: \".concat(selectedDate));API.get(\"/playback/timeline-day/\".concat(camId,\"/\").concat(selectedDate,\"?_ts=\").concat(Date.now())).then(res=>{const{segments:raw,dayStart}=res.data;setServerDayStart(dayStart);const dayEnd=dayStart+86400000;const norm=raw.map(e=>{const s=Math.max(Number(e.start_ts),dayStart);const end=Math.min(Number(e.end_ts),dayEnd);if(end<=s)return null;return{left:(s-dayStart)/86400000,width:(end-s)/86400000,ts:Number(e.start_ts)};}).filter(Boolean);setTimelineSegments(norm);}).catch(console.error);},[camId,selectedDate]);// PLAYBACK LOGIC\nconst waitForHls=async url=>{for(let i=0;i<30;i++){try{if((await fetch(url,{method:'HEAD'})).ok)return true;}catch(_unused){}await new Promise(r=>setTimeout(r,200));}return false;};const play=useCallback(async startTime=>{if(!startTime)return;try{try{API.post('/playback/stop',{camId});}catch(_unused2){}if(hlsRef.current){hlsRef.current.destroy();hlsRef.current=null;}const res=await API.post('/playback/start',{camId,from:startTime,to:Date.now(),speed:1});const hlsUrl=\"http://192.168.120.208:8080\".concat(res.data.hlsUrl,\"?t=\").concat(Date.now());if(!(await waitForHls(hlsUrl.split('?')[0])))throw new Error(\"Stream Timeout\");if(Hls.isSupported()){const hls=new Hls();hls.loadSource(hlsUrl);hls.attachMedia(videoRef.current);hlsRef.current=hls;hls.on(Hls.Events.MANIFEST_PARSED,()=>videoRef.current.play().catch(()=>{}));}else{videoRef.current.src=hlsUrl;videoRef.current.play();}setIsPlaying(true);}catch(e){alert(\"Error: \"+e.message);}},[camId]);const stop=()=>{try{API.post('/playback/stop',{camId});}catch(_unused3){}if(hlsRef.current)hlsRef.current.destroy();videoRef.current.pause();setIsPlaying(false);};const handleSeek=e=>{if(!serverDayStart)return;const rect=timelineRef.current.getBoundingClientRect();const ratio=Math.max(0,Math.min(1,(e.clientX-rect.left)/rect.width));if(cursorRef.current)cursorRef.current.style.left=ratio*100+\"%\";play(Math.floor(serverDayStart+ratio*86400000));};// CALENDAR RENDER\nconst renderCalendar=()=>{const daysInMonth=new Date(calYear,calMonth,0).getDate();const firstDay=new Date(calYear,calMonth-1,1).getDay();// 0(Sun)..6(Sat)\nconst offset=firstDay===0?6:firstDay-1;// Mon=0\nconst grid=[];for(let i=0;i<offset;i++)grid.push(/*#__PURE__*/_jsx(\"div\",{},\"empty-\".concat(i)));for(let d=1;d<=daysInMonth;d++){const hasData=daysWithData.includes(d);const isSelected=d===new Date(selectedDate).getDate()&&calMonth===new Date(selectedDate).getMonth()+1;grid.push(/*#__PURE__*/_jsx(\"div\",{className:\"cal-day \".concat(hasData?'has-data':'',\" \").concat(isSelected?'selected':''),onClick:()=>{if(hasData){const m=String(calMonth).padStart(2,'0');const day=String(d).padStart(2,'0');setSelectedDate(\"\".concat(calYear,\"-\").concat(m,\"-\").concat(day));setShowCal(false);}},children:d},d));}return grid;};return/*#__PURE__*/_jsxs(\"div\",{className:\"playback-page\",children:[/*#__PURE__*/_jsx(\"style\",{children:styles}),showCal&&/*#__PURE__*/_jsx(\"div\",{className:\"backdrop\",onClick:()=>setShowCal(false)}),/*#__PURE__*/_jsxs(\"div\",{className:\"playback-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:()=>window.location.href='/',children:\"\\u2190 Back\"}),/*#__PURE__*/_jsx(\"div\",{className:\"header-title\",children:camId}),/*#__PURE__*/_jsxs(\"div\",{className:\"date-selector\",onClick:()=>setShowCal(!showCal),children:[\"\\uD83D\\uDCC5 \",selectedDate]}),showCal&&/*#__PURE__*/_jsxs(\"div\",{className:\"calendar-popup\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cal-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"cal-btn\",onClick:()=>setCalMonth(m=>m===1?12:m-1),children:\"\\u25C0\"}),/*#__PURE__*/_jsxs(\"span\",{children:[calYear,\" - \",calMonth]}),/*#__PURE__*/_jsx(\"button\",{className:\"cal-btn\",onClick:()=>setCalMonth(m=>m===12?1:m+1),children:\"\\u25B6\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cal-grid\",children:[['L','M','M','J','V','S','D'].map(d=>/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',fontSize:10,color:'#666'},children:d},d)),renderCalendar()]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"video-viewport\",children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,controls:true,autoPlay:true,muted:true,playsInline:true})}),/*#__PURE__*/_jsxs(\"div\",{className:\"controls\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>timelineSegments[0]&&play(timelineSegments[0].ts),children:\"Play All\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:stop,children:\"Stop\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"timeline-area\",ref:timelineRef,onClick:handleSeek,children:[/*#__PURE__*/_jsx(\"div\",{className:\"time-ticks\",children:Array.from({length:24},(_,i)=>i).map(h=>/*#__PURE__*/_jsx(\"div\",{className:\"tick\",children:h},h))}),/*#__PURE__*/_jsx(\"div\",{className:\"segments-track\",children:timelineSegments.map((s,i)=>/*#__PURE__*/_jsx(\"div\",{className:\"segment\",style:{left:\"\".concat(s.left*100,\"%\"),width:\"\".concat(s.width*100,\"%\")}},i))}),/*#__PURE__*/_jsx(\"div\",{ref:cursorRef,className:\"playhead\",style:{left:'0%'}})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useRef","useCallback","useSearchParams","API","Hls","jsx","_jsx","jsxs","_jsxs","styles","Playback","params","camId","get","selectedDate","setSelectedDate","d","Date","offset","getTimezoneOffset","getTime","toISOString","split","timelineSegments","setTimelineSegments","serverDayStart","setServerDayStart","isPlaying","setIsPlaying","showCal","setShowCal","calYear","setCalYear","getFullYear","calMonth","setCalMonth","getMonth","daysWithData","setDaysWithData","videoRef","hlsRef","cursorRef","timelineRef","concat","now","then","res","data","days","catch","console","error","log","segments","raw","dayStart","dayEnd","norm","map","e","s","Math","max","Number","start_ts","end","min","end_ts","left","width","ts","filter","Boolean","waitForHls","url","i","fetch","method","ok","_unused","Promise","r","setTimeout","play","startTime","post","_unused2","current","destroy","from","to","speed","hlsUrl","Error","isSupported","hls","loadSource","attachMedia","on","Events","MANIFEST_PARSED","src","alert","message","stop","_unused3","pause","handleSeek","rect","getBoundingClientRect","ratio","clientX","style","floor","renderCalendar","daysInMonth","getDate","firstDay","getDay","grid","push","hasData","includes","isSelected","className","onClick","m","String","padStart","day","children","window","location","href","textAlign","fontSize","color","ref","controls","autoPlay","muted","playsInline","Array","length","_","h"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/pages/Playback.js"],"sourcesContent":["import React, { useEffect, useState, useRef, useCallback } from \"react\";\r\nimport { useSearchParams } from \"react-router-dom\";\r\nimport API from \"../api\";\r\nimport Hls from 'hls.js';\r\n\r\n/* STYLES */\r\nconst styles = `\r\n* { box-sizing: border-box; margin: 0; padding: 0; }\r\nbody { background: #1a1a1a; color: #ccc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }\r\n.playback-page { height: 100vh; display: flex; flex-direction: column; background: #1a1a1a; }\r\n\r\n/* HEADER */\r\n.playback-header { \r\n    height: 48px; background: #111; border-bottom: 1px solid #333; \r\n    display: flex; align-items: center; padding: 0 16px; gap: 16px; \r\n}\r\n.header-title { font-size: 14px; font-weight: 600; color: #fff; margin-right: auto; }\r\n.date-selector { \r\n    background: #222; border: 1px solid #444; color: #fff; \r\n    padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 13px;\r\n    display: flex; align-items: center; gap: 8px;\r\n}\r\n.date-selector:hover { background: #333; border-color: #666; }\r\n\r\n/* CALENDAR POPUP */\r\n.calendar-popup {\r\n    position: absolute; top: 50px; left: 50%; transform: translateX(-50%);\r\n    width: 280px; background: #222; border: 1px solid #555; border-radius: 6px;\r\n    box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 2000;\r\n    padding: 10px;\r\n}\r\n.cal-header { display: flex; justify-content: space-between; margin-bottom: 10px; color: #fff; }\r\n.cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }\r\n.cal-day { \r\n    height: 30px; display: flex; align-items: center; justify-content: center; \r\n    font-size: 12px; border-radius: 3px; cursor: default; color: #555;\r\n}\r\n.cal-day.has-data { \r\n    color: #4da6ff; font-weight: bold; cursor: pointer; background: rgba(77, 166, 255, 0.1); \r\n}\r\n.cal-day.has-data:hover { background: #4da6ff; color: #000; }\r\n.cal-day.selected { background: #fff; color: #000; border: 1px solid #4da6ff; }\r\n.cal-btn { background: none; border: none; color: #aaa; cursor: pointer; }\r\n.cal-btn:hover { color: #fff; }\r\n\r\n/* VIDEO */\r\n.video-viewport { flex: 1; background: #000; position: relative; display:flex; align-items:center; justify-content:center; }\r\nvideo { width: 100%; height: 100%; object-fit: contain; }\r\n\r\n/* CONTROLS & TIMELINE */\r\n.timeline-area { height: 100px; background: #0f0f0f; border-top: 1px solid #333; position: relative; user-select: none; cursor: crosshair; }\r\n.time-ticks { position: absolute; top: 0; width: 100%; height: 20px; display: flex; pointer-events: none; }\r\n.tick { flex: 1; border-left: 1px solid #333; font-size: 10px; color: #666; padding-left: 2px; }\r\n.segments-track { position: absolute; top: 25px; bottom: 0; width: 100%; background: rgba(255,255,255,0.01); }\r\n.segment { position: absolute; top: 5px; height: 30px; background: #1f9d55; min-width: 2px; opacity: 0.9; }\r\n.playhead { position: absolute; top: 0; bottom: 0; width: 2px; background: #f00; z-index: 50; pointer-events: none; }\r\n.controls { height: 40px; background: #111; display: flex; align-items: center; gap: 10px; padding: 0 10px; border-top: 1px solid #222; }\r\n.btn { background: #333; color: #eee; border: 1px solid #444; padding: 4px 12px; cursor: pointer; font-size: 12px; }\r\n.btn:hover { background: #444; }\r\n.btn-primary { background: #0055aa; border-color: #004488; }\r\n.backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; }\r\n`;\r\n\r\nexport default function Playback() {\r\n    const [params] = useSearchParams();\r\n    const camId = params.get(\"camId\");\r\n\r\n    const [selectedDate, setSelectedDate] = useState(() => {\r\n        const d = new Date();\r\n        const offset = d.getTimezoneOffset() * 60000;\r\n        return new Date(d.getTime() - offset).toISOString().split('T')[0];\r\n    });\r\n\r\n    const [timelineSegments, setTimelineSegments] = useState([]);\r\n    const [serverDayStart, setServerDayStart] = useState(0);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n\r\n    // Calendar State\r\n    const [showCal, setShowCal] = useState(false);\r\n    const [calYear, setCalYear] = useState(new Date().getFullYear());\r\n    const [calMonth, setCalMonth] = useState(new Date().getMonth() + 1);\r\n    const [daysWithData, setDaysWithData] = useState([]);\r\n\r\n    const videoRef = useRef(null);\r\n    const hlsRef = useRef(null);\r\n    const cursorRef = useRef(null);\r\n    const timelineRef = useRef(null);\r\n\r\n    // FETCH CALENDAR DATA\r\n    useEffect(() => {\r\n        if (!showCal || !camId) return;\r\n        API.get(`/playback/calendar-month/${camId}/${calYear}/${calMonth}?_ts=${Date.now()}`)\r\n            .then(res => setDaysWithData(res.data.days || []))\r\n            .catch(console.error);\r\n    }, [showCal, calYear, calMonth, camId]);\r\n\r\n    // FETCH TIMELINE\r\n    useEffect(() => {\r\n        if (!camId || !selectedDate) return;\r\n        console.log(`Fetching timeline: ${selectedDate}`);\r\n        API.get(`/playback/timeline-day/${camId}/${selectedDate}?_ts=${Date.now()}`)\r\n            .then(res => {\r\n                const { segments: raw, dayStart } = res.data;\r\n                setServerDayStart(dayStart);\r\n                const dayEnd = dayStart + 86400000;\r\n\r\n                const norm = raw.map(e => {\r\n                    const s = Math.max(Number(e.start_ts), dayStart);\r\n                    const end = Math.min(Number(e.end_ts), dayEnd);\r\n                    if (end <= s) return null;\r\n                    return { left: (s - dayStart) / 86400000, width: (end - s) / 86400000, ts: Number(e.start_ts) };\r\n                }).filter(Boolean);\r\n\r\n                setTimelineSegments(norm);\r\n            })\r\n            .catch(console.error);\r\n    }, [camId, selectedDate]);\r\n\r\n    // PLAYBACK LOGIC\r\n    const waitForHls = async (url) => {\r\n        for (let i = 0; i < 30; i++) {\r\n            try { if ((await fetch(url, { method: 'HEAD' })).ok) return true; } catch { }\r\n            await new Promise(r => setTimeout(r, 200));\r\n        }\r\n        return false;\r\n    };\r\n\r\n    const play = useCallback(async (startTime) => {\r\n        if (!startTime) return;\r\n        try {\r\n            try { API.post('/playback/stop', { camId }); } catch { }\r\n            if (hlsRef.current) { hlsRef.current.destroy(); hlsRef.current = null; }\r\n\r\n            const res = await API.post('/playback/start', { camId, from: startTime, to: Date.now(), speed: 1 });\r\n            const hlsUrl = `http://192.168.120.208:8080${res.data.hlsUrl}?t=${Date.now()}`;\r\n\r\n            if (!await waitForHls(hlsUrl.split('?')[0])) throw new Error(\"Stream Timeout\");\r\n\r\n            if (Hls.isSupported()) {\r\n                const hls = new Hls();\r\n                hls.loadSource(hlsUrl);\r\n                hls.attachMedia(videoRef.current);\r\n                hlsRef.current = hls;\r\n                hls.on(Hls.Events.MANIFEST_PARSED, () => videoRef.current.play().catch(() => { }));\r\n            } else {\r\n                videoRef.current.src = hlsUrl;\r\n                videoRef.current.play();\r\n            }\r\n            setIsPlaying(true);\r\n        } catch (e) { alert(\"Error: \" + e.message); }\r\n    }, [camId]);\r\n\r\n    const stop = () => {\r\n        try { API.post('/playback/stop', { camId }); } catch { }\r\n        if (hlsRef.current) hlsRef.current.destroy();\r\n        videoRef.current.pause();\r\n        setIsPlaying(false);\r\n    };\r\n\r\n    const handleSeek = (e) => {\r\n        if (!serverDayStart) return;\r\n        const rect = timelineRef.current.getBoundingClientRect();\r\n        const ratio = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));\r\n        if (cursorRef.current) cursorRef.current.style.left = (ratio * 100) + \"%\";\r\n        play(Math.floor(serverDayStart + ratio * 86400000));\r\n    };\r\n\r\n    // CALENDAR RENDER\r\n    const renderCalendar = () => {\r\n        const daysInMonth = new Date(calYear, calMonth, 0).getDate();\r\n        const firstDay = new Date(calYear, calMonth - 1, 1).getDay(); // 0(Sun)..6(Sat)\r\n        const offset = firstDay === 0 ? 6 : firstDay - 1; // Mon=0\r\n\r\n        const grid = [];\r\n        for (let i = 0; i < offset; i++) grid.push(<div key={`empty-${i}`} />);\r\n\r\n        for (let d = 1; d <= daysInMonth; d++) {\r\n            const hasData = daysWithData.includes(d);\r\n            const isSelected = (d === new Date(selectedDate).getDate()) &&\r\n                (calMonth === new Date(selectedDate).getMonth() + 1);\r\n\r\n            grid.push(\r\n                <div key={d}\r\n                    className={`cal-day ${hasData ? 'has-data' : ''} ${isSelected ? 'selected' : ''}`}\r\n                    onClick={() => {\r\n                        if (hasData) {\r\n                            const m = String(calMonth).padStart(2, '0');\r\n                            const day = String(d).padStart(2, '0');\r\n                            setSelectedDate(`${calYear}-${m}-${day}`);\r\n                            setShowCal(false);\r\n                        }\r\n                    }}\r\n                >\r\n                    {d}\r\n                </div>\r\n            );\r\n        }\r\n        return grid;\r\n    };\r\n\r\n    return (\r\n        <div className=\"playback-page\">\r\n            <style>{styles}</style>\r\n            {showCal && <div className=\"backdrop\" onClick={() => setShowCal(false)} />}\r\n\r\n            <div className=\"playback-header\">\r\n                <button className=\"btn\" onClick={() => window.location.href = '/'}>‚Üê Back</button>\r\n                <div className=\"header-title\">{camId}</div>\r\n\r\n                <div className=\"date-selector\" onClick={() => setShowCal(!showCal)}>\r\n                    üìÖ {selectedDate}\r\n                </div>\r\n\r\n                {showCal && (\r\n                    <div className=\"calendar-popup\">\r\n                        <div className=\"cal-header\">\r\n                            <button className=\"cal-btn\" onClick={() => setCalMonth(m => m === 1 ? 12 : m - 1)}>‚óÄ</button>\r\n                            <span>{calYear} - {calMonth}</span>\r\n                            <button className=\"cal-btn\" onClick={() => setCalMonth(m => m === 12 ? 1 : m + 1)}>‚ñ∂</button>\r\n                        </div>\r\n                        <div className=\"cal-grid\">\r\n                            {['L', 'M', 'M', 'J', 'V', 'S', 'D'].map(d => <div key={d} style={{ textAlign: 'center', fontSize: 10, color: '#666' }}>{d}</div>)}\r\n                            {renderCalendar()}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"video-viewport\">\r\n                <video ref={videoRef} controls autoPlay muted playsInline />\r\n            </div>\r\n\r\n            <div className=\"controls\">\r\n                <button className=\"btn btn-primary\" onClick={() => timelineSegments[0] && play(timelineSegments[0].ts)}>Play All</button>\r\n                <button className=\"btn\" onClick={stop}>Stop</button>\r\n            </div>\r\n\r\n            <div className=\"timeline-area\" ref={timelineRef} onClick={handleSeek}>\r\n                <div className=\"time-ticks\">\r\n                    {Array.from({ length: 24 }, (_, i) => i).map(h => <div key={h} className=\"tick\">{h}</div>)}\r\n                </div>\r\n                <div className=\"segments-track\">\r\n                    {timelineSegments.map((s, i) => (\r\n                        <div key={i} className=\"segment\" style={{ left: `${s.left * 100}%`, width: `${s.width * 100}%` }} />\r\n                    ))}\r\n                </div>\r\n                <div ref={cursorRef} className=\"playhead\" style={{ left: '0%' }} />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}