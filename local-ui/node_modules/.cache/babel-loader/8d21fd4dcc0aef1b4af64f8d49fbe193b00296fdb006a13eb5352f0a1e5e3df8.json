{"ast":null,"code":"import _objectSpread from\"I:/dispecerat/github_release/dss-edge/local-ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState}from'react';import{MediaStreamManager}from'./MediaStreamManager';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Go2RTCPlayer(_ref){let{camId,streamType='hd',style,onClick,onDoubleClick,isHidden}=_ref;const videoRef=useRef(null);const[status,setStatus]=useState(\"init\");// Fallback logic for stream suffix\nconst suffix=streamType==='low'?'sub':streamType==='hd'?'hd':'sub';useEffect(()=>{if(isHidden)return;let mounted=true;const manager=MediaStreamManager.getInstance();// Check if stream is already hot to avoid UI flicker\nif(manager.hasActiveStream(camId,suffix)){setStatus(\"playing\");}else{setStatus(\"connecting\");}const attachStream=async()=>{try{// Request persistent stream from singleton\nconst stream=await manager.getStream(camId,suffix);if(mounted&&videoRef.current){videoRef.current.srcObject=stream;videoRef.current.play().catch(e=>console.warn(\"Autoplay blocked\",e));// Ensure status is playing\nsetStatus(\"playing\");}}catch(e){console.error(\"[Go2RTCPlayer] Failed to get stream:\",e);if(mounted)setStatus(\"error\");}};attachStream();return()=>{mounted=false;// Detach but don't close the connection\nif(videoRef.current){videoRef.current.srcObject=null;}manager.releaseStream(camId,suffix);};},[camId,suffix,isHidden]);return/*#__PURE__*/_jsxs(\"div\",{className:\"rtc-player\",style:_objectSpread(_objectSpread({},style),{},{position:\"relative\",background:\"#000\",width:\"100%\",height:\"100%\",overflow:\"hidden\"}),onClick:onClick,onDoubleClick:onDoubleClick,children:[/*#__PURE__*/_jsx(\"div\",{style:{position:\"absolute\",top:0,left:0,right:0,bottom:0},children:/*#__PURE__*/_jsx(\"video\",{className:\"rtc-player-el\",ref:videoRef,style:{width:\"100%\",height:\"100%\",objectFit:\"fill\",display:\"block\"},playsInline:true,muted:true,autoPlay:true})}),status==='connecting'&&/*#__PURE__*/_jsx(\"div\",{style:{position:\"absolute\",top:0,left:0,width:\"100%\",height:\"100%\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",color:\"rgba(255,255,255,0.4)\",fontSize:10,zIndex:2},children:\"...\"})]});}export default/*#__PURE__*/React.memo(Go2RTCPlayer);","map":{"version":3,"names":["React","useEffect","useRef","useState","MediaStreamManager","jsx","_jsx","jsxs","_jsxs","Go2RTCPlayer","_ref","camId","streamType","style","onClick","onDoubleClick","isHidden","videoRef","status","setStatus","suffix","mounted","manager","getInstance","hasActiveStream","attachStream","stream","getStream","current","srcObject","play","catch","e","console","warn","error","releaseStream","className","_objectSpread","position","background","width","height","overflow","children","top","left","right","bottom","ref","objectFit","display","playsInline","muted","autoPlay","alignItems","justifyContent","color","fontSize","zIndex","memo"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/components/Go2RTCPlayer.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { MediaStreamManager } from './MediaStreamManager';\r\n\r\nfunction Go2RTCPlayer({ camId, streamType = 'hd', style, onClick, onDoubleClick, isHidden }) {\r\n    const videoRef = useRef(null);\r\n    const [status, setStatus] = useState(\"init\");\r\n\r\n    // Fallback logic for stream suffix\r\n    const suffix =\r\n        streamType === 'low' ? 'sub' :\r\n            streamType === 'hd' ? 'hd' :\r\n                'sub';\r\n\r\n    useEffect(() => {\r\n        if (isHidden) return;\r\n\r\n        let mounted = true;\r\n        const manager = MediaStreamManager.getInstance();\r\n\r\n        // Check if stream is already hot to avoid UI flicker\r\n        if (manager.hasActiveStream(camId, suffix)) {\r\n            setStatus(\"playing\");\r\n        } else {\r\n            setStatus(\"connecting\");\r\n        }\r\n\r\n        const attachStream = async () => {\r\n            try {\r\n                // Request persistent stream from singleton\r\n                const stream = await manager.getStream(camId, suffix);\r\n\r\n                if (mounted && videoRef.current) {\r\n                    videoRef.current.srcObject = stream;\r\n                    videoRef.current.play().catch(e => console.warn(\"Autoplay blocked\", e));\r\n                    // Ensure status is playing\r\n                    setStatus(\"playing\");\r\n                }\r\n            } catch (e) {\r\n                console.error(\"[Go2RTCPlayer] Failed to get stream:\", e);\r\n                if (mounted) setStatus(\"error\");\r\n            }\r\n        };\r\n\r\n        attachStream();\r\n\r\n        return () => {\r\n            mounted = false;\r\n            // Detach but don't close the connection\r\n            if (videoRef.current) {\r\n                videoRef.current.srcObject = null;\r\n            }\r\n            manager.releaseStream(camId, suffix);\r\n        };\r\n    }, [camId, suffix, isHidden]);\r\n\r\n    return (\r\n        <div className=\"rtc-player\" style={{ ...style, position: \"relative\", background: \"#000\", width: \"100%\", height: \"100%\", overflow: \"hidden\" }}\r\n            onClick={onClick} onDoubleClick={onDoubleClick}>\r\n            <div style={{ position: \"absolute\", top: 0, left: 0, right: 0, bottom: 0 }}>\r\n                <video\r\n                    className=\"rtc-player-el\"\r\n                    ref={videoRef}\r\n                    style={{ width: \"100%\", height: \"100%\", objectFit: \"fill\", display: \"block\" }}\r\n                    playsInline muted autoPlay\r\n                />\r\n            </div>\r\n            {status === 'connecting' && (\r\n                <div style={{ position: \"absolute\", top: 0, left: 0, width: \"100%\", height: \"100%\", display: \"flex\", alignItems: \"center\", justifyContent: \"center\", color: \"rgba(255,255,255,0.4)\", fontSize: 10, zIndex: 2 }}>\r\n                    ...\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default React.memo(Go2RTCPlayer);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}