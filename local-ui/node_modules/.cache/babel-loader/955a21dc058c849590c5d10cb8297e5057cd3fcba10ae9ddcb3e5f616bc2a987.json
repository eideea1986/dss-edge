{"ast":null,"code":"import _objectSpread from\"I:/dispecerat/github_release/dss-edge/local-ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";export default function RecorderPlayer(_ref){let{camId,streamType,style}=_ref;const videoRef=useRef(null);const hlsRef=useRef(null);useEffect(()=>{const video=videoRef.current;if(!video)return;// Direct path - no API prefix needed since we're on same origin\nconst hlsUrl=\"/api/playback/live/\".concat(camId,\".m3u8\");const initHls=()=>{if(window.Hls&&window.Hls.isSupported()){if(hlsRef.current)hlsRef.current.destroy();const hls=new window.Hls({debug:true,// Enable debug to see what's happening\nenableWorker:true,lowLatencyMode:false,maxBufferLength:20,maxMaxBufferLength:40,backBufferLength:10});hls.loadSource(hlsUrl);hls.attachMedia(video);hls.on(window.Hls.Events.MANIFEST_PARSED,()=>{console.log('[RecorderPlayer] Manifest parsed, starting playback');video.play().catch(e=>console.warn(\"Autoplay block\",e));});hls.on(window.Hls.Events.ERROR,(event,data)=>{console.error('[RecorderPlayer] HLS Error:',data);if(data.fatal){switch(data.type){case window.Hls.ErrorTypes.NETWORK_ERROR:console.log('[RecorderPlayer] Network error, trying to recover...');hls.startLoad();break;case window.Hls.ErrorTypes.MEDIA_ERROR:console.log('[RecorderPlayer] Media error, trying to recover...');hls.recoverMediaError();break;default:console.error('[RecorderPlayer] Fatal error, destroying player');hls.destroy();break;}}});hlsRef.current=hls;}else if(video.canPlayType('application/vnd.apple.mpegurl')){// Safari Native\nvideo.src=hlsUrl;video.addEventListener('loadedmetadata',()=>{video.play();});}};// Load Hls.js if not available\nif(!window.Hls&&typeof Hls==='undefined'){const script=document.createElement('script');script.src=\"https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js\";script.onload=initHls;document.head.appendChild(script);}else{initHls();}return()=>{if(hlsRef.current)hlsRef.current.destroy();};},[camId]);return/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},style),{},{position:'relative',background:'#000',overflow:'hidden'}),children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,style:{width:'100%',height:'100%',objectFit:'contain'},autoPlay:true,muted:true,playsInline:true})});}","map":{"version":3,"names":["React","useEffect","useRef","jsx","_jsx","RecorderPlayer","_ref","camId","streamType","style","videoRef","hlsRef","video","current","hlsUrl","concat","initHls","window","Hls","isSupported","destroy","hls","debug","enableWorker","lowLatencyMode","maxBufferLength","maxMaxBufferLength","backBufferLength","loadSource","attachMedia","on","Events","MANIFEST_PARSED","console","log","play","catch","e","warn","ERROR","event","data","error","fatal","type","ErrorTypes","NETWORK_ERROR","startLoad","MEDIA_ERROR","recoverMediaError","canPlayType","src","addEventListener","script","document","createElement","onload","head","appendChild","_objectSpread","position","background","overflow","children","ref","width","height","objectFit","autoPlay","muted","playsInline"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/components/RecorderPlayer.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\n\r\nexport default function RecorderPlayer({ camId, streamType, style }) {\r\n    const videoRef = useRef(null);\r\n    const hlsRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        const video = videoRef.current;\r\n        if (!video) return;\r\n\r\n        // Direct path - no API prefix needed since we're on same origin\r\n        const hlsUrl = `/api/playback/live/${camId}.m3u8`;\r\n\r\n        const initHls = () => {\r\n            if (window.Hls && window.Hls.isSupported()) {\r\n                if (hlsRef.current) hlsRef.current.destroy();\r\n\r\n                const hls = new window.Hls({\r\n                    debug: true, // Enable debug to see what's happening\r\n                    enableWorker: true,\r\n                    lowLatencyMode: false,\r\n                    maxBufferLength: 20,\r\n                    maxMaxBufferLength: 40,\r\n                    backBufferLength: 10,\r\n                });\r\n\r\n                hls.loadSource(hlsUrl);\r\n                hls.attachMedia(video);\r\n\r\n                hls.on(window.Hls.Events.MANIFEST_PARSED, () => {\r\n                    console.log('[RecorderPlayer] Manifest parsed, starting playback');\r\n                    video.play().catch(e => console.warn(\"Autoplay block\", e));\r\n                });\r\n\r\n                hls.on(window.Hls.Events.ERROR, (event, data) => {\r\n                    console.error('[RecorderPlayer] HLS Error:', data);\r\n                    if (data.fatal) {\r\n                        switch (data.type) {\r\n                            case window.Hls.ErrorTypes.NETWORK_ERROR:\r\n                                console.log('[RecorderPlayer] Network error, trying to recover...');\r\n                                hls.startLoad();\r\n                                break;\r\n                            case window.Hls.ErrorTypes.MEDIA_ERROR:\r\n                                console.log('[RecorderPlayer] Media error, trying to recover...');\r\n                                hls.recoverMediaError();\r\n                                break;\r\n                            default:\r\n                                console.error('[RecorderPlayer] Fatal error, destroying player');\r\n                                hls.destroy();\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                hlsRef.current = hls;\r\n            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {\r\n                // Safari Native\r\n                video.src = hlsUrl;\r\n                video.addEventListener('loadedmetadata', () => {\r\n                    video.play();\r\n                });\r\n            }\r\n        };\r\n\r\n        // Load Hls.js if not available\r\n        if (!window.Hls && typeof Hls === 'undefined') {\r\n            const script = document.createElement('script');\r\n            script.src = \"https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js\";\r\n            script.onload = initHls;\r\n            document.head.appendChild(script);\r\n        } else {\r\n            initHls();\r\n        }\r\n\r\n        return () => {\r\n            if (hlsRef.current) hlsRef.current.destroy();\r\n        };\r\n    }, [camId]);\r\n\r\n    return (\r\n        <div style={{ ...style, position: 'relative', background: '#000', overflow: 'hidden' }}>\r\n            <video\r\n                ref={videoRef}\r\n                style={{ width: '100%', height: '100%', objectFit: 'contain' }}\r\n                autoPlay\r\n                muted\r\n                playsInline\r\n            />\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}