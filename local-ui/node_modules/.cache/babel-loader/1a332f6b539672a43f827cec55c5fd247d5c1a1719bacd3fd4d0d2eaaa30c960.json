{"ast":null,"code":"import _objectSpread from\"I:/dispecerat/github_release/dss-edge/local-ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState}from'react';import{API}from'../api';// We assume Hls is available via window.Hls or installed. \n// Since we don't have package.json control easily, we'll try to use window.Hls if loaded from CDN, \n// or import it if the environment supports it. The previous code used a CDN script injection fallback.\n// Let's stick to the previous robust pattern but simpler.\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function RecorderPlayer(_ref){let{camId,streamType,style}=_ref;const videoRef=useRef(null);const hlsRef=useRef(null);const[hlsUrl,setHlsUrl]=useState(null);const[error,setError]=useState(null);const[loading,setLoading]=useState(true);// 1. Fetch HLS URL\nuseEffect(()=>{setLoading(true);setError(null);const mode=streamType==='hd'?'main':'sub';API.get(\"/recorder/live-url/\".concat(camId,\"/\").concat(mode)).then(res=>{// Determine full URL\nlet url=res.data.url;if(url.startsWith(\"/\"))url=API.defaults.baseURL+url;setHlsUrl(url);}).catch(e=>{setError(\"Nu există flux live.\");setLoading(false);});},[camId,streamType]);// 2. Init Player\nuseEffect(()=>{if(!hlsUrl)return;const video=videoRef.current;const initHls=()=>{if(window.Hls&&window.Hls.isSupported()){if(hlsRef.current)hlsRef.current.destroy();const hls=new window.Hls({enableWorker:true,lowLatencyMode:true,backBufferLength:90});hls.loadSource(hlsUrl);hls.attachMedia(video);hls.on(window.Hls.Events.MANIFEST_PARSED,()=>{video.play().catch(e=>console.warn(\"Autoplay block\",e));setLoading(false);});hls.on(window.Hls.Events.ERROR,(event,data)=>{if(data.fatal){switch(data.type){case window.Hls.ErrorTypes.NETWORK_ERROR:hls.startLoad();break;case window.Hls.ErrorTypes.MEDIA_ERROR:hls.recoverMediaError();break;default:hls.destroy();break;}}});hlsRef.current=hls;}else if(video.canPlayType('application/vnd.apple.mpegurl')){// iOS / Safari\nvideo.src=hlsUrl;video.addEventListener('loadedmetadata',()=>{video.play();setLoading(false);});}};// Load Lib if missing\nif(!window.Hls&&typeof Hls==='undefined'){const script=document.createElement('script');script.src=\"https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js\";script.onload=initHls;document.head.appendChild(script);}else{initHls();}return()=>{if(hlsRef.current)hlsRef.current.destroy();};},[hlsUrl]);return/*#__PURE__*/_jsxs(\"div\",{style:_objectSpread(_objectSpread({},style),{},{position:'relative',background:'#000',overflow:'hidden'}),children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,style:{width:'100%',height:'100%',objectFit:'contain'},autoPlay:true,muted:true,playsInline:true}),(loading||!hlsUrl)&&!error&&/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',top:0,left:0,right:0,bottom:0,display:'flex',alignItems:'center',justifyContent:'center',color:'#fff',background:'rgba(0,0,0,0.5)'},children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner\",children:\"Live Buffer...\"})}),error&&/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',top:0,left:0,right:0,bottom:0,display:'flex',alignItems:'center',justifyContent:'center',color:'#ff5555'},children:error})]});}","map":{"version":3,"names":["React","useEffect","useRef","useState","API","jsx","_jsx","jsxs","_jsxs","RecorderPlayer","_ref","camId","streamType","style","videoRef","hlsRef","hlsUrl","setHlsUrl","error","setError","loading","setLoading","mode","get","concat","then","res","url","data","startsWith","defaults","baseURL","catch","e","video","current","initHls","window","Hls","isSupported","destroy","hls","enableWorker","lowLatencyMode","backBufferLength","loadSource","attachMedia","on","Events","MANIFEST_PARSED","play","console","warn","ERROR","event","fatal","type","ErrorTypes","NETWORK_ERROR","startLoad","MEDIA_ERROR","recoverMediaError","canPlayType","src","addEventListener","script","document","createElement","onload","head","appendChild","_objectSpread","position","background","overflow","children","ref","width","height","objectFit","autoPlay","muted","playsInline","top","left","right","bottom","display","alignItems","justifyContent","color","className"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/components/RecorderPlayer.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { API } from '../api';\r\n// We assume Hls is available via window.Hls or installed. \r\n// Since we don't have package.json control easily, we'll try to use window.Hls if loaded from CDN, \r\n// or import it if the environment supports it. The previous code used a CDN script injection fallback.\r\n// Let's stick to the previous robust pattern but simpler.\r\n\r\nexport default function RecorderPlayer({ camId, streamType, style }) {\r\n    const videoRef = useRef(null);\r\n    const hlsRef = useRef(null);\r\n    const [hlsUrl, setHlsUrl] = useState(null);\r\n    const [error, setError] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // 1. Fetch HLS URL\r\n    useEffect(() => {\r\n        setLoading(true);\r\n        setError(null);\r\n        const mode = streamType === 'hd' ? 'main' : 'sub';\r\n\r\n        API.get(`/recorder/live-url/${camId}/${mode}`)\r\n            .then(res => {\r\n                // Determine full URL\r\n                let url = res.data.url;\r\n                if (url.startsWith(\"/\")) url = API.defaults.baseURL + url;\r\n                setHlsUrl(url);\r\n            })\r\n            .catch(e => {\r\n                setError(\"Nu există flux live.\");\r\n                setLoading(false);\r\n            });\r\n    }, [camId, streamType]);\r\n\r\n    // 2. Init Player\r\n    useEffect(() => {\r\n        if (!hlsUrl) return;\r\n\r\n        const video = videoRef.current;\r\n\r\n        const initHls = () => {\r\n            if (window.Hls && window.Hls.isSupported()) {\r\n                if (hlsRef.current) hlsRef.current.destroy();\r\n\r\n                const hls = new window.Hls({\r\n                    enableWorker: true,\r\n                    lowLatencyMode: true,\r\n                    backBufferLength: 90\r\n                });\r\n\r\n                hls.loadSource(hlsUrl);\r\n                hls.attachMedia(video);\r\n\r\n                hls.on(window.Hls.Events.MANIFEST_PARSED, () => {\r\n                    video.play().catch(e => console.warn(\"Autoplay block\", e));\r\n                    setLoading(false);\r\n                });\r\n\r\n                hls.on(window.Hls.Events.ERROR, (event, data) => {\r\n                    if (data.fatal) {\r\n                        switch (data.type) {\r\n                            case window.Hls.ErrorTypes.NETWORK_ERROR:\r\n                                hls.startLoad();\r\n                                break;\r\n                            case window.Hls.ErrorTypes.MEDIA_ERROR:\r\n                                hls.recoverMediaError();\r\n                                break;\r\n                            default:\r\n                                hls.destroy();\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                hlsRef.current = hls;\r\n            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {\r\n                // iOS / Safari\r\n                video.src = hlsUrl;\r\n                video.addEventListener('loadedmetadata', () => {\r\n                    video.play();\r\n                    setLoading(false);\r\n                });\r\n            }\r\n        };\r\n\r\n        // Load Lib if missing\r\n        if (!window.Hls && typeof Hls === 'undefined') {\r\n            const script = document.createElement('script');\r\n            script.src = \"https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js\";\r\n            script.onload = initHls;\r\n            document.head.appendChild(script);\r\n        } else {\r\n            initHls();\r\n        }\r\n\r\n        return () => {\r\n            if (hlsRef.current) hlsRef.current.destroy();\r\n        };\r\n    }, [hlsUrl]);\r\n\r\n    return (\r\n        <div style={{ ...style, position: 'relative', background: '#000', overflow: 'hidden' }}>\r\n            <video\r\n                ref={videoRef}\r\n                style={{ width: '100%', height: '100%', objectFit: 'contain' }}\r\n                autoPlay\r\n                muted\r\n                playsInline\r\n            />\r\n            {(loading || !hlsUrl) && !error && (\r\n                <div style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', background: 'rgba(0,0,0,0.5)' }}>\r\n                    <div className=\"spinner\">Live Buffer...</div>\r\n                </div>\r\n            )}\r\n            {error && (\r\n                <div style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#ff5555' }}>\r\n                    {error}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}