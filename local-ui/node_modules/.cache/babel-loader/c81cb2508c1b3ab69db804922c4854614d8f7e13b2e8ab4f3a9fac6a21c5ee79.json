{"ast":null,"code":"import React,{useEffect,useState,useRef,useCallback}from\"react\";import{useSearchParams}from\"react-router-dom\";import API from\"../api\";import Hls from'hls.js';/* STILURI FINALE CURATE & VIZIBILE */import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const styles=\"\\n* { box-sizing: border-box; margin: 0; padding: 0; }\\nbody { background: #1a1a1a; color: #fff; }\\n.playback-page { height: 100vh; display: flex; flex-direction: column; background: #1a1a1a; font-family: 'Segoe UI', Arial, sans-serif; }\\n\\n/* HEADER */\\n.playback-header { \\n    height: 40px; \\n    background: #000; \\n    display: flex; \\n    align-items: center; \\n    padding: 0 15px; \\n    gap: 15px; \\n    border-bottom: 1px solid #333; \\n}\\n.playback-header h3 { font-size: 14px; margin: 0; color: #ddd; }\\n.tag { background: #333; padding: 2px 8px; border-radius: 4px; font-size: 11px; color: #0f0; }\\n\\n/* VIDEO */\\n.video-viewport { \\n    flex: 1; \\n    background: #000; \\n    display: flex; \\n    align-items: center; \\n    justify-content: center; \\n    position: relative; \\n    overflow: hidden;\\n}\\nvideo { width: 100%; height: 100%; object-fit: contain; }\\n\\n/* CONTROLS */\\n.controls { \\n    height: 50px; \\n    background: #111; \\n    display: flex; \\n    align-items: center; \\n    gap: 15px; \\n    padding: 0 20px; \\n    border-top: 1px solid #333; \\n}\\n.btn {\\n    background: #333; border: 1px solid #555; color: #eee;\\n    padding: 6px 14px; cursor: pointer; font-size: 12px;\\n    border-radius: 4px; transition: 0.2s;\\n}\\n.btn:hover { background: #444; border-color: #777; }\\n.btn-primary { background: #0066cc; border-color: #0055aa; }\\n.btn-primary:hover { background: #0077dd; }\\n\\n/* TIMELINE (TRASSIR STYLE) */\\n.timeline-area { \\n    height: 90px; \\n    background: #181818; \\n    position: relative; \\n    border-top: 1px solid #444; \\n    overflow: hidden;\\n    user-select: none;\\n    cursor: crosshair;\\n}\\n\\n/* ORE */\\n.time-ticks {\\n    position: absolute; top: 0; left: 0; width: 100%; height: 25px;\\n    display: flex; border-bottom: 1px solid #333;\\n    pointer-events: none;\\n}\\n.tick {\\n    flex: 1; border-left: 1px solid #444;\\n    font-size: 10px; color: #888;\\n    padding-left: 4px; padding-top: 4px;\\n}\\n\\n/* TRACK */\\n.segments-track {\\n    position: absolute; top: 25px; bottom: 0; width: 100%;\\n    background: rgba(255,255,255,0.02);\\n}\\n\\n/* SEGMENTE VERZI */\\n.segment {\\n    position: absolute; top: 5px; height: 30px;\\n    background: #2ecc71; /* Green */\\n    opacity: 0.9;\\n    border-radius: 2px;\\n    min-width: 2px;\\n}\\n.segment:hover { background: #27ae60; z-index: 10; }\\n\\n/* CURSOR RO\\u0218U */\\n.playhead {\\n    position: absolute; top: 0; bottom: 0; width: 2px;\\n    background: #e74c3c; z-index: 50;\\n    pointer-events: none;\\n    box-shadow: 0 0 4px rgba(231, 76, 60, 0.5);\\n}\\n\";export default function Playback(){const[params]=useSearchParams();const camId=params.get(\"camId\");const[timelineSegments,setTimelineSegments]=useState([]);const[serverDayStart,setServerDayStart]=useState(0);// Default to Today Local String\nconst[selectedDate,setSelectedDate]=useState(()=>{const d=new Date();const offset=d.getTimezoneOffset()*60000;const local=new Date(d.getTime()-offset);return local.toISOString().split('T')[0];});const[isPlaying,setIsPlaying]=useState(false);const videoRef=useRef(null);const hlsRef=useRef(null);const cursorRef=useRef(null);const timelineRef=useRef(null);// 1. FETCH & PROCESS DATA\nuseEffect(()=>{document.title=\"Playback - \".concat(camId);if(!camId||!selectedDate)return;console.log(\"[Playback] Fetching for \".concat(selectedDate));API.get(\"/playback/timeline-day/\".concat(camId,\"/\").concat(selectedDate)).then(res=>{const{segments:raw,dayStart}=res.data;setServerDayStart(dayStart);const DAY_MS=86400000;const dayEnd=dayStart+DAY_MS;// FIX: CLAMP & NORMALIZE\nconst norm=raw.map(e=>{const sTs=Number(e.start_ts);const eTs=Number(e.end_ts);// Clamp to Day Boundaries\nconst start=Math.max(sTs,dayStart);const end=Math.min(eTs,dayEnd);if(end<=start)return null;// Outside day\nreturn{left:(start-dayStart)/DAY_MS,width:(end-start)/DAY_MS,ts:sTs// Original TS for seeking\n};}).filter(Boolean);setTimelineSegments(norm);console.log(\"[Playback] Loaded \".concat(norm.length,\" segments.\"));}).catch(e=>console.error(e));},[camId,selectedDate]);// 2. PLAYBACK CONTROL\nconst waitForHls=async url=>{for(let i=0;i<30;i++){// 6s timeout\ntry{if((await fetch(url,{method:'HEAD'})).ok)return true;}catch(_unused){}await new Promise(r=>setTimeout(r,200));}return false;};const play=useCallback(async startTime=>{if(!startTime)return;try{// Stop previous\ntry{API.post('/playback/stop',{camId});}catch(_unused2){}if(hlsRef.current){hlsRef.current.destroy();hlsRef.current=null;}// Request Stream\nconst res=await API.post('/playback/start',{camId,from:startTime,to:Date.now(),speed:1});// Anti-Cache URL\nconst hlsUrl=\"http://192.168.120.208:8080\".concat(res.data.hlsUrl,\"?t=\").concat(Date.now());// Wait for file\nif(!(await waitForHls(hlsUrl.split('?')[0])))throw new Error(\"Stream Timeout\");// Init Player\nif(Hls.isSupported()){const hls=new Hls();hls.loadSource(hlsUrl);hls.attachMedia(videoRef.current);hlsRef.current=hls;hls.on(Hls.Events.MANIFEST_PARSED,()=>videoRef.current.play().catch(()=>{}));}else if(videoRef.current.canPlayType('application/vnd.apple.mpegurl')){videoRef.current.src=hlsUrl;videoRef.current.play();}setIsPlaying(true);}catch(e){console.error(e);alert(\"Eroare stream: \"+e.message);}},[camId]);const stop=()=>{try{API.post('/playback/stop',{camId});if(hlsRef.current)hlsRef.current.destroy();videoRef.current.pause();setIsPlaying(false);}catch(_unused3){}};// 3. SEEK HANDLER (Strict Server Time)\nconst handleSeek=e=>{if(!serverDayStart)return;const rect=timelineRef.current.getBoundingClientRect();const ratio=Math.max(0,Math.min(1,(e.clientX-rect.left)/rect.width));// Update Cursor UI\nif(cursorRef.current)cursorRef.current.style.left=ratio*100+\"%\";// Calculate Time\nconst seekTs=Math.floor(serverDayStart+ratio*86400000);console.log(\"[Seek] Ratio: \".concat(ratio.toFixed(4),\" -> Time: \").concat(new Date(seekTs).toLocaleTimeString()));play(seekTs);};return/*#__PURE__*/_jsxs(\"div\",{className:\"playback-page\",children:[/*#__PURE__*/_jsx(\"style\",{children:styles}),/*#__PURE__*/_jsxs(\"div\",{className:\"playback-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:()=>window.location.href='/',children:\"\\u2190 \\xCEnapoi\"}),/*#__PURE__*/_jsx(\"h3\",{children:camId}),/*#__PURE__*/_jsx(\"span\",{className:\"tag\",children:selectedDate}),/*#__PURE__*/_jsxs(\"span\",{className:\"tag\",style:{background:'#555'},children:[timelineSegments.length,\" Evenimente\"]}),/*#__PURE__*/_jsx(\"span\",{style:{fontSize:10,color:'#666',marginLeft:'auto'},children:\"vFINAL.1\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"video-viewport\",children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,controls:true,autoPlay:true,muted:true,playsInline:true})}),/*#__PURE__*/_jsxs(\"div\",{className:\"controls\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>timelineSegments[0]&&play(timelineSegments[0].ts),children:\"\\u25B6 Play All\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:stop,children:\"\\u25A0 Stop\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"timeline-area\",ref:timelineRef,onClick:handleSeek,children:[/*#__PURE__*/_jsx(\"div\",{className:\"time-ticks\",children:Array.from({length:24},(_,i)=>i).map(h=>/*#__PURE__*/_jsxs(\"div\",{className:\"tick\",children:[h,\":00\"]},h))}),/*#__PURE__*/_jsx(\"div\",{className:\"segments-track\",children:timelineSegments.map((s,i)=>/*#__PURE__*/_jsx(\"div\",{className:\"segment\",style:{left:\"\".concat(s.left*100,\"%\"),width:\"\".concat(s.width*100,\"%\")},title:new Date(s.ts).toLocaleTimeString()},i))}),/*#__PURE__*/_jsx(\"div\",{ref:cursorRef,className:\"playhead\",style:{left:'0%'}})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useRef","useCallback","useSearchParams","API","Hls","jsx","_jsx","jsxs","_jsxs","styles","Playback","params","camId","get","timelineSegments","setTimelineSegments","serverDayStart","setServerDayStart","selectedDate","setSelectedDate","d","Date","offset","getTimezoneOffset","local","getTime","toISOString","split","isPlaying","setIsPlaying","videoRef","hlsRef","cursorRef","timelineRef","document","title","concat","console","log","then","res","segments","raw","dayStart","data","DAY_MS","dayEnd","norm","map","e","sTs","Number","start_ts","eTs","end_ts","start","Math","max","end","min","left","width","ts","filter","Boolean","length","catch","error","waitForHls","url","i","fetch","method","ok","_unused","Promise","r","setTimeout","play","startTime","post","_unused2","current","destroy","from","to","now","speed","hlsUrl","Error","isSupported","hls","loadSource","attachMedia","on","Events","MANIFEST_PARSED","canPlayType","src","alert","message","stop","pause","_unused3","handleSeek","rect","getBoundingClientRect","ratio","clientX","style","seekTs","floor","toFixed","toLocaleTimeString","className","children","onClick","window","location","href","background","fontSize","color","marginLeft","ref","controls","autoPlay","muted","playsInline","Array","_","h","s"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/pages/Playback.js"],"sourcesContent":["import React, { useEffect, useState, useRef, useCallback } from \"react\";\r\nimport { useSearchParams } from \"react-router-dom\";\r\nimport API from \"../api\";\r\nimport Hls from 'hls.js';\r\n\r\n/* STILURI FINALE CURATE & VIZIBILE */\r\nconst styles = `\r\n* { box-sizing: border-box; margin: 0; padding: 0; }\r\nbody { background: #1a1a1a; color: #fff; }\r\n.playback-page { height: 100vh; display: flex; flex-direction: column; background: #1a1a1a; font-family: 'Segoe UI', Arial, sans-serif; }\r\n\r\n/* HEADER */\r\n.playback-header { \r\n    height: 40px; \r\n    background: #000; \r\n    display: flex; \r\n    align-items: center; \r\n    padding: 0 15px; \r\n    gap: 15px; \r\n    border-bottom: 1px solid #333; \r\n}\r\n.playback-header h3 { font-size: 14px; margin: 0; color: #ddd; }\r\n.tag { background: #333; padding: 2px 8px; border-radius: 4px; font-size: 11px; color: #0f0; }\r\n\r\n/* VIDEO */\r\n.video-viewport { \r\n    flex: 1; \r\n    background: #000; \r\n    display: flex; \r\n    align-items: center; \r\n    justify-content: center; \r\n    position: relative; \r\n    overflow: hidden;\r\n}\r\nvideo { width: 100%; height: 100%; object-fit: contain; }\r\n\r\n/* CONTROLS */\r\n.controls { \r\n    height: 50px; \r\n    background: #111; \r\n    display: flex; \r\n    align-items: center; \r\n    gap: 15px; \r\n    padding: 0 20px; \r\n    border-top: 1px solid #333; \r\n}\r\n.btn {\r\n    background: #333; border: 1px solid #555; color: #eee;\r\n    padding: 6px 14px; cursor: pointer; font-size: 12px;\r\n    border-radius: 4px; transition: 0.2s;\r\n}\r\n.btn:hover { background: #444; border-color: #777; }\r\n.btn-primary { background: #0066cc; border-color: #0055aa; }\r\n.btn-primary:hover { background: #0077dd; }\r\n\r\n/* TIMELINE (TRASSIR STYLE) */\r\n.timeline-area { \r\n    height: 90px; \r\n    background: #181818; \r\n    position: relative; \r\n    border-top: 1px solid #444; \r\n    overflow: hidden;\r\n    user-select: none;\r\n    cursor: crosshair;\r\n}\r\n\r\n/* ORE */\r\n.time-ticks {\r\n    position: absolute; top: 0; left: 0; width: 100%; height: 25px;\r\n    display: flex; border-bottom: 1px solid #333;\r\n    pointer-events: none;\r\n}\r\n.tick {\r\n    flex: 1; border-left: 1px solid #444;\r\n    font-size: 10px; color: #888;\r\n    padding-left: 4px; padding-top: 4px;\r\n}\r\n\r\n/* TRACK */\r\n.segments-track {\r\n    position: absolute; top: 25px; bottom: 0; width: 100%;\r\n    background: rgba(255,255,255,0.02);\r\n}\r\n\r\n/* SEGMENTE VERZI */\r\n.segment {\r\n    position: absolute; top: 5px; height: 30px;\r\n    background: #2ecc71; /* Green */\r\n    opacity: 0.9;\r\n    border-radius: 2px;\r\n    min-width: 2px;\r\n}\r\n.segment:hover { background: #27ae60; z-index: 10; }\r\n\r\n/* CURSOR ROȘU */\r\n.playhead {\r\n    position: absolute; top: 0; bottom: 0; width: 2px;\r\n    background: #e74c3c; z-index: 50;\r\n    pointer-events: none;\r\n    box-shadow: 0 0 4px rgba(231, 76, 60, 0.5);\r\n}\r\n`;\r\n\r\nexport default function Playback() {\r\n    const [params] = useSearchParams();\r\n    const camId = params.get(\"camId\");\r\n\r\n    const [timelineSegments, setTimelineSegments] = useState([]);\r\n    const [serverDayStart, setServerDayStart] = useState(0);\r\n\r\n    // Default to Today Local String\r\n    const [selectedDate, setSelectedDate] = useState(() => {\r\n        const d = new Date();\r\n        const offset = d.getTimezoneOffset() * 60000;\r\n        const local = new Date(d.getTime() - offset);\r\n        return local.toISOString().split('T')[0];\r\n    });\r\n\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const videoRef = useRef(null);\r\n    const hlsRef = useRef(null);\r\n    const cursorRef = useRef(null);\r\n    const timelineRef = useRef(null);\r\n\r\n    // 1. FETCH & PROCESS DATA\r\n    useEffect(() => {\r\n        document.title = `Playback - ${camId}`;\r\n        if (!camId || !selectedDate) return;\r\n\r\n        console.log(`[Playback] Fetching for ${selectedDate}`);\r\n\r\n        API.get(`/playback/timeline-day/${camId}/${selectedDate}`)\r\n            .then(res => {\r\n                const { segments: raw, dayStart } = res.data;\r\n                setServerDayStart(dayStart);\r\n\r\n                const DAY_MS = 86400000;\r\n                const dayEnd = dayStart + DAY_MS;\r\n\r\n                // FIX: CLAMP & NORMALIZE\r\n                const norm = raw.map(e => {\r\n                    const sTs = Number(e.start_ts);\r\n                    const eTs = Number(e.end_ts);\r\n\r\n                    // Clamp to Day Boundaries\r\n                    const start = Math.max(sTs, dayStart);\r\n                    const end = Math.min(eTs, dayEnd);\r\n\r\n                    if (end <= start) return null; // Outside day\r\n\r\n                    return {\r\n                        left: (start - dayStart) / DAY_MS,\r\n                        width: (end - start) / DAY_MS,\r\n                        ts: sTs // Original TS for seeking\r\n                    };\r\n                }).filter(Boolean);\r\n\r\n                setTimelineSegments(norm);\r\n                console.log(`[Playback] Loaded ${norm.length} segments.`);\r\n            })\r\n            .catch(e => console.error(e));\r\n    }, [camId, selectedDate]);\r\n\r\n    // 2. PLAYBACK CONTROL\r\n    const waitForHls = async (url) => {\r\n        for (let i = 0; i < 30; i++) { // 6s timeout\r\n            try { if ((await fetch(url, { method: 'HEAD' })).ok) return true; } catch { }\r\n            await new Promise(r => setTimeout(r, 200));\r\n        }\r\n        return false;\r\n    };\r\n\r\n    const play = useCallback(async (startTime) => {\r\n        if (!startTime) return;\r\n        try {\r\n            // Stop previous\r\n            try { API.post('/playback/stop', { camId }); } catch { }\r\n            if (hlsRef.current) { hlsRef.current.destroy(); hlsRef.current = null; }\r\n\r\n            // Request Stream\r\n            const res = await API.post('/playback/start', {\r\n                camId, from: startTime, to: Date.now(), speed: 1\r\n            });\r\n\r\n            // Anti-Cache URL\r\n            const hlsUrl = `http://192.168.120.208:8080${res.data.hlsUrl}?t=${Date.now()}`;\r\n\r\n            // Wait for file\r\n            if (!await waitForHls(hlsUrl.split('?')[0])) throw new Error(\"Stream Timeout\");\r\n\r\n            // Init Player\r\n            if (Hls.isSupported()) {\r\n                const hls = new Hls();\r\n                hls.loadSource(hlsUrl);\r\n                hls.attachMedia(videoRef.current);\r\n                hlsRef.current = hls;\r\n                hls.on(Hls.Events.MANIFEST_PARSED, () => videoRef.current.play().catch(() => { }));\r\n            } else if (videoRef.current.canPlayType('application/vnd.apple.mpegurl')) {\r\n                videoRef.current.src = hlsUrl;\r\n                videoRef.current.play();\r\n            }\r\n            setIsPlaying(true);\r\n        } catch (e) { console.error(e); alert(\"Eroare stream: \" + e.message); }\r\n    }, [camId]);\r\n\r\n    const stop = () => {\r\n        try {\r\n            API.post('/playback/stop', { camId });\r\n            if (hlsRef.current) hlsRef.current.destroy();\r\n            videoRef.current.pause();\r\n            setIsPlaying(false);\r\n        } catch { }\r\n    };\r\n\r\n    // 3. SEEK HANDLER (Strict Server Time)\r\n    const handleSeek = (e) => {\r\n        if (!serverDayStart) return;\r\n\r\n        const rect = timelineRef.current.getBoundingClientRect();\r\n        const ratio = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));\r\n\r\n        // Update Cursor UI\r\n        if (cursorRef.current) cursorRef.current.style.left = (ratio * 100) + \"%\";\r\n\r\n        // Calculate Time\r\n        const seekTs = Math.floor(serverDayStart + ratio * 86400000);\r\n        console.log(`[Seek] Ratio: ${ratio.toFixed(4)} -> Time: ${new Date(seekTs).toLocaleTimeString()}`);\r\n\r\n        play(seekTs);\r\n    };\r\n\r\n    return (\r\n        <div className=\"playback-page\">\r\n            <style>{styles}</style>\r\n\r\n            <div className=\"playback-header\">\r\n                <button className=\"btn\" onClick={() => window.location.href = '/'}>← Înapoi</button>\r\n                <h3>{camId}</h3>\r\n                <span className=\"tag\">{selectedDate}</span>\r\n                <span className=\"tag\" style={{ background: '#555' }}>{timelineSegments.length} Evenimente</span>\r\n                <span style={{ fontSize: 10, color: '#666', marginLeft: 'auto' }}>vFINAL.1</span>\r\n            </div>\r\n\r\n            <div className=\"video-viewport\">\r\n                <video ref={videoRef} controls autoPlay muted playsInline />\r\n            </div>\r\n\r\n            <div className=\"controls\">\r\n                <button className=\"btn btn-primary\" onClick={() => timelineSegments[0] && play(timelineSegments[0].ts)}>\r\n                    ▶ Play All\r\n                </button>\r\n                <button className=\"btn\" onClick={stop}>■ Stop</button>\r\n            </div>\r\n\r\n            <div className=\"timeline-area\" ref={timelineRef} onClick={handleSeek}>\r\n                {/* Ore */}\r\n                <div className=\"time-ticks\">\r\n                    {Array.from({ length: 24 }, (_, i) => i).map(h => (\r\n                        <div key={h} className=\"tick\">{h}:00</div>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Segmente */}\r\n                <div className=\"segments-track\">\r\n                    {timelineSegments.map((s, i) => (\r\n                        <div key={i} className=\"segment\"\r\n                            style={{\r\n                                left: `${s.left * 100}%`,\r\n                                width: `${s.width * 100}%`\r\n                            }}\r\n                            title={new Date(s.ts).toLocaleTimeString()}\r\n                        />\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Playhead */}\r\n                <div ref={cursorRef} className=\"playhead\" style={{ left: '0%' }} />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}