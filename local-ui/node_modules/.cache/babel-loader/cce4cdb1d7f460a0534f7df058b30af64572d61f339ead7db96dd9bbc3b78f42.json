{"ast":null,"code":"import React,{useEffect,useState,useRef}from\"react\";import{useSearchParams}from\"react-router-dom\";import API from\"../api\";import Hls from'hls.js';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const styles=\"\\n* { box-sizing: border-box; margin: 0; padding: 0; }\\nbody { background: #cfd2d6; }\\n\\n.playback-page {\\n  height: 100vh;\\n  display: flex;\\n  flex-direction: column;\\n  background: #cfd2d6;\\n  font-family: Arial, sans-serif;\\n}\\n\\n.playback-header {\\n  height: 40px;\\n  background: #d9d9d9;\\n  display: flex;\\n  align-items: center;\\n  padding: 0 10px;\\n  gap: 8px;\\n  border-bottom: 1px solid #999;\\n}\\n\\n.video-viewport {\\n  height: calc(100vh - 140px);\\n  background: #000;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n}\\n\\nvideo {\\n  width: 100%;\\n  height: 100%;\\n  object-fit: contain;\\n  background: #000;\\n}\\n\\n.controls {\\n  height: 60px;\\n  background: #d9d9d9;\\n  display: flex;\\n  align-items: center;\\n  gap: 6px;\\n  padding: 0 8px;\\n  border-bottom: 1px solid #999;\\n}\\n\\n.timeline-area {\\n  height: 80px;\\n  background: #e6e6e6;\\n  border-top: 1px solid #999;\\n  position: relative;\\n  overflow: hidden;\\n  cursor: crosshair;\\n}\\n\\n.segments-track {\\n  position: absolute;\\n  top: 34px;\\n  height: 12px;\\n  left: 0;\\n  right: 0;\\n}\\n\\n.segment {\\n  position: absolute;\\n  height: 100%;\\n  background: #2ecc71;\\n  border-left: 1px solid rgba(0,0,0,0.1);\\n}\\n\\nbutton {\\n  padding: 4px 10px;\\n  border: 1px solid #555;\\n  background: #f0f0f0;\\n  cursor: pointer;\\n  font-size: 13px;\\n}\\n\\nbutton:hover { background: #fff; }\\nbutton:active { background: #ddd; }\\n\\n.time-display {\\n  margin-left: auto;\\n  font-weight: bold;\\n}\\n\";export default function Playback(){const[params]=useSearchParams();const camId=params.get(\"camId\");const[segments,setSegments]=useState([]);const[isPlaying,setIsPlaying]=useState(false);const[currentTime,setCurrentTime]=useState(\"00:00:00\");const[isLoading,setIsLoading]=useState(false);const videoRef=useRef(null);const hlsRef=useRef(null);const[timeRange]=useState(()=>{const now=Date.now();const from=now-24*60*60*1000;return{from,to:now};});// Load timeline\nuseEffect(()=>{if(!camId)return;console.log(\"Fetching timeline for range:\",new Date(timeRange.from),\"->\",new Date(timeRange.to));API.get(\"/playback/timeline/\".concat(camId,\"?from=\").concat(timeRange.from,\"&to=\").concat(timeRange.to)).then(res=>{const segs=res.data.segments||[];console.log(\"Received Segments:\",segs.length);// Debug first segment\nif(segs.length>0){console.log(\"First Seg:\",segs[0]);}// Filter & Set\nconst valid=segs.filter(s=>s.start_ts>0);setSegments(valid);}).catch(e=>console.error(\"Timeline error:\",e));},[camId,timeRange]);// Check for HLS availability with retry\nconst waitForHls=async function(url){let retries=arguments.length>1&&arguments[1]!==undefined?arguments[1]:20;console.log(\"Waiting for HLS: \".concat(url));for(let i=0;i<retries;i++){try{const res=await fetch(url,{method:'HEAD'});if(res.ok){console.log(\"HLS Ready!\");return true;}}catch(e){/* ignore */}await new Promise(r=>setTimeout(r,500));// wait 500ms\n}console.error(\"HLS Timeout\");return false;};//Start playback\nconst startPlayback=async()=>{if(segments.length===0){alert(\"Nicio înregistrare disponibilă pentru intervalul selectat.\");return;}setIsLoading(true);try{// Start from FIRST segment\nconst res=await API.post('/playback/start',{camId,from:segments[0].start_ts,to:segments[segments.length-1].end_ts||Date.now(),speed:1});console.log('[Playback] Response:',res.data);const hlsUrl=\"http://192.168.120.208:8080\".concat(res.data.hlsUrl);// Wait for playlist to be generated\nconst ready=await waitForHls(hlsUrl);if(!ready)throw new Error(\"HLS playlist generation timed out. Please try again.\");// Init Player\nif(Hls.isSupported()){if(hlsRef.current)hlsRef.current.destroy();const hls=new Hls({debug:false,enableWorker:true});hls.loadSource(hlsUrl);hls.attachMedia(videoRef.current);hls.on(Hls.Events.MANIFEST_PARSED,()=>{videoRef.current.play().catch(e=>console.error(\"Auto-play blocked:\",e));});hls.on(Hls.Events.ERROR,(event,data)=>{console.error(\"HLS Error:\",data);if(data.fatal){switch(data.type){case Hls.ErrorTypes.NETWORK_ERROR:hls.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:hls.recoverMediaError();break;default:hls.destroy();break;}}});hlsRef.current=hls;}else if(videoRef.current.canPlayType('application/vnd.apple.mpegurl')){videoRef.current.src=hlsUrl;videoRef.current.addEventListener('loadedmetadata',()=>{videoRef.current.play();});}setIsPlaying(true);}catch(e){var _e$response,_e$response$data;console.error('[Playback] Error:',e);alert('Eroare: '+(((_e$response=e.response)===null||_e$response===void 0?void 0:(_e$response$data=_e$response.data)===null||_e$response$data===void 0?void 0:_e$response$data.error)||e.message));}finally{setIsLoading(false);}};const stopPlayback=async()=>{try{await API.post('/playback/stop',{camId});if(hlsRef.current){hlsRef.current.destroy();hlsRef.current=null;}if(videoRef.current){videoRef.current.pause();videoRef.current.removeAttribute('src');videoRef.current.load();}setIsPlaying(false);}catch(e){console.error(e);}};// Update time\nuseEffect(()=>{const interval=setInterval(()=>{if(videoRef.current){const t=Math.floor(videoRef.current.currentTime);const h=String(Math.floor(t/3600)).padStart(2,'0');const m=String(Math.floor(t%3600/60)).padStart(2,'0');const s=String(t%60).padStart(2,'0');setCurrentTime(\"\".concat(h,\":\").concat(m,\":\").concat(s));}},500);return()=>clearInterval(interval);},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"playback-page\",children:[/*#__PURE__*/_jsx(\"style\",{children:styles}),/*#__PURE__*/_jsxs(\"div\",{className:\"playback-header\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.href='/',children:\"\\u2190 \\xCEnapoi\"}),/*#__PURE__*/_jsxs(\"span\",{style:{fontWeight:600},children:[camId,\" - PLAYBACK\"]}),/*#__PURE__*/_jsxs(\"span\",{style:{fontSize:11,color:'#555'},children:[segments.length,\" segmente | \",new Date(timeRange.from).toLocaleTimeString(),\" - \",new Date(timeRange.to).toLocaleTimeString()]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"video-viewport\",children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,controls:true,autoPlay:true,muted:true,playsInline:true})}),/*#__PURE__*/_jsxs(\"div\",{className:\"controls\",children:[!isPlaying?/*#__PURE__*/_jsx(\"button\",{onClick:startPlayback,disabled:isLoading,children:isLoading?\"Încărcare...\":\"▶ REDĂ\"}):/*#__PURE__*/_jsx(\"button\",{onClick:stopPlayback,children:\"\\u25A0 OPRIRE\"}),/*#__PURE__*/_jsx(\"div\",{className:\"time-display\",children:currentTime})]}),/*#__PURE__*/_jsx(\"div\",{className:\"timeline-area\",children:/*#__PURE__*/_jsx(\"div\",{className:\"segments-track\",children:segments.map((seg,i)=>/*#__PURE__*/_jsx(\"div\",{className:\"segment\",title:\"Start: \".concat(new Date(seg.start_ts).toLocaleTimeString()),style:{left:\"\".concat(seg.s*100,\"%\"),// Force visible width (min 2px) for very short segments\nwidth:\"max(\".concat((seg.e-seg.s)*100,\"%, 2px)\")}},i))})})]});}","map":{"version":3,"names":["React","useEffect","useState","useRef","useSearchParams","API","Hls","jsx","_jsx","jsxs","_jsxs","styles","Playback","params","camId","get","segments","setSegments","isPlaying","setIsPlaying","currentTime","setCurrentTime","isLoading","setIsLoading","videoRef","hlsRef","timeRange","now","Date","from","to","console","log","concat","then","res","segs","data","length","valid","filter","s","start_ts","catch","e","error","waitForHls","url","retries","arguments","undefined","i","fetch","method","ok","Promise","r","setTimeout","startPlayback","alert","post","end_ts","speed","hlsUrl","ready","Error","isSupported","current","destroy","hls","debug","enableWorker","loadSource","attachMedia","on","Events","MANIFEST_PARSED","play","ERROR","event","fatal","type","ErrorTypes","NETWORK_ERROR","startLoad","MEDIA_ERROR","recoverMediaError","canPlayType","src","addEventListener","_e$response","_e$response$data","response","message","stopPlayback","pause","removeAttribute","load","interval","setInterval","t","Math","floor","h","String","padStart","m","clearInterval","className","children","onClick","window","location","href","style","fontWeight","fontSize","color","toLocaleTimeString","ref","controls","autoPlay","muted","playsInline","disabled","map","seg","title","left","width"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/pages/Playback.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport { useSearchParams } from \"react-router-dom\";\r\nimport API from \"../api\";\r\nimport Hls from 'hls.js';\r\n\r\nconst styles = `\r\n* { box-sizing: border-box; margin: 0; padding: 0; }\r\nbody { background: #cfd2d6; }\r\n\r\n.playback-page {\r\n  height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  background: #cfd2d6;\r\n  font-family: Arial, sans-serif;\r\n}\r\n\r\n.playback-header {\r\n  height: 40px;\r\n  background: #d9d9d9;\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 0 10px;\r\n  gap: 8px;\r\n  border-bottom: 1px solid #999;\r\n}\r\n\r\n.video-viewport {\r\n  height: calc(100vh - 140px);\r\n  background: #000;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\nvideo {\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: contain;\r\n  background: #000;\r\n}\r\n\r\n.controls {\r\n  height: 60px;\r\n  background: #d9d9d9;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 6px;\r\n  padding: 0 8px;\r\n  border-bottom: 1px solid #999;\r\n}\r\n\r\n.timeline-area {\r\n  height: 80px;\r\n  background: #e6e6e6;\r\n  border-top: 1px solid #999;\r\n  position: relative;\r\n  overflow: hidden;\r\n  cursor: crosshair;\r\n}\r\n\r\n.segments-track {\r\n  position: absolute;\r\n  top: 34px;\r\n  height: 12px;\r\n  left: 0;\r\n  right: 0;\r\n}\r\n\r\n.segment {\r\n  position: absolute;\r\n  height: 100%;\r\n  background: #2ecc71;\r\n  border-left: 1px solid rgba(0,0,0,0.1);\r\n}\r\n\r\nbutton {\r\n  padding: 4px 10px;\r\n  border: 1px solid #555;\r\n  background: #f0f0f0;\r\n  cursor: pointer;\r\n  font-size: 13px;\r\n}\r\n\r\nbutton:hover { background: #fff; }\r\nbutton:active { background: #ddd; }\r\n\r\n.time-display {\r\n  margin-left: auto;\r\n  font-weight: bold;\r\n}\r\n`;\r\n\r\nexport default function Playback() {\r\n    const [params] = useSearchParams();\r\n    const camId = params.get(\"camId\");\r\n\r\n    const [segments, setSegments] = useState([]);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [currentTime, setCurrentTime] = useState(\"00:00:00\");\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const videoRef = useRef(null);\r\n    const hlsRef = useRef(null);\r\n\r\n    const [timeRange] = useState(() => {\r\n        const now = Date.now();\r\n        const from = now - 24 * 60 * 60 * 1000;\r\n        return { from, to: now };\r\n    });\r\n\r\n    // Load timeline\r\n    useEffect(() => {\r\n        if (!camId) return;\r\n\r\n        console.log(\"Fetching timeline for range:\", new Date(timeRange.from), \"->\", new Date(timeRange.to));\r\n\r\n        API.get(`/playback/timeline/${camId}?from=${timeRange.from}&to=${timeRange.to}`)\r\n            .then(res => {\r\n                const segs = res.data.segments || [];\r\n                console.log(\"Received Segments:\", segs.length);\r\n\r\n                // Debug first segment\r\n                if (segs.length > 0) {\r\n                    console.log(\"First Seg:\", segs[0]);\r\n                }\r\n\r\n                // Filter & Set\r\n                const valid = segs.filter(s => s.start_ts > 0);\r\n                setSegments(valid);\r\n            })\r\n            .catch(e => console.error(\"Timeline error:\", e));\r\n    }, [camId, timeRange]);\r\n\r\n    // Check for HLS availability with retry\r\n    const waitForHls = async (url, retries = 20) => {\r\n        console.log(`Waiting for HLS: ${url}`);\r\n        for (let i = 0; i < retries; i++) {\r\n            try {\r\n                const res = await fetch(url, { method: 'HEAD' });\r\n                if (res.ok) {\r\n                    console.log(\"HLS Ready!\");\r\n                    return true;\r\n                }\r\n            } catch (e) { /* ignore */ }\r\n            await new Promise(r => setTimeout(r, 500)); // wait 500ms\r\n        }\r\n        console.error(\"HLS Timeout\");\r\n        return false;\r\n    };\r\n\r\n    //Start playback\r\n    const startPlayback = async () => {\r\n        if (segments.length === 0) {\r\n            alert(\"Nicio înregistrare disponibilă pentru intervalul selectat.\");\r\n            return;\r\n        }\r\n\r\n        setIsLoading(true);\r\n\r\n        try {\r\n            // Start from FIRST segment\r\n            const res = await API.post('/playback/start', {\r\n                camId,\r\n                from: segments[0].start_ts,\r\n                to: segments[segments.length - 1].end_ts || Date.now(),\r\n                speed: 1\r\n            });\r\n\r\n            console.log('[Playback] Response:', res.data);\r\n\r\n            const hlsUrl = `http://192.168.120.208:8080${res.data.hlsUrl}`;\r\n\r\n            // Wait for playlist to be generated\r\n            const ready = await waitForHls(hlsUrl);\r\n            if (!ready) throw new Error(\"HLS playlist generation timed out. Please try again.\");\r\n\r\n            // Init Player\r\n            if (Hls.isSupported()) {\r\n                if (hlsRef.current) hlsRef.current.destroy();\r\n\r\n                const hls = new Hls({\r\n                    debug: false,\r\n                    enableWorker: true\r\n                });\r\n                hls.loadSource(hlsUrl);\r\n                hls.attachMedia(videoRef.current);\r\n                hls.on(Hls.Events.MANIFEST_PARSED, () => {\r\n                    videoRef.current.play().catch(e => console.error(\"Auto-play blocked:\", e));\r\n                });\r\n                hls.on(Hls.Events.ERROR, (event, data) => {\r\n                    console.error(\"HLS Error:\", data);\r\n                    if (data.fatal) {\r\n                        switch (data.type) {\r\n                            case Hls.ErrorTypes.NETWORK_ERROR:\r\n                                hls.startLoad();\r\n                                break;\r\n                            case Hls.ErrorTypes.MEDIA_ERROR:\r\n                                hls.recoverMediaError();\r\n                                break;\r\n                            default:\r\n                                hls.destroy();\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n                hlsRef.current = hls;\r\n            } else if (videoRef.current.canPlayType('application/vnd.apple.mpegurl')) {\r\n                videoRef.current.src = hlsUrl;\r\n                videoRef.current.addEventListener('loadedmetadata', () => {\r\n                    videoRef.current.play();\r\n                });\r\n            }\r\n\r\n            setIsPlaying(true);\r\n        } catch (e) {\r\n            console.error('[Playback] Error:', e);\r\n            alert('Eroare: ' + (e.response?.data?.error || e.message));\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const stopPlayback = async () => {\r\n        try {\r\n            await API.post('/playback/stop', { camId });\r\n\r\n            if (hlsRef.current) {\r\n                hlsRef.current.destroy();\r\n                hlsRef.current = null;\r\n            }\r\n\r\n            if (videoRef.current) {\r\n                videoRef.current.pause();\r\n                videoRef.current.removeAttribute('src');\r\n                videoRef.current.load();\r\n            }\r\n\r\n            setIsPlaying(false);\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    };\r\n\r\n    // Update time\r\n    useEffect(() => {\r\n        const interval = setInterval(() => {\r\n            if (videoRef.current) {\r\n                const t = Math.floor(videoRef.current.currentTime);\r\n                const h = String(Math.floor(t / 3600)).padStart(2, '0');\r\n                const m = String(Math.floor((t % 3600) / 60)).padStart(2, '0');\r\n                const s = String(t % 60).padStart(2, '0');\r\n                setCurrentTime(`${h}:${m}:${s}`);\r\n            }\r\n        }, 500);\r\n\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"playback-page\">\r\n            <style>{styles}</style>\r\n\r\n            <div className=\"playback-header\">\r\n                <button onClick={() => window.location.href = '/'}>← Înapoi</button>\r\n                <span style={{ fontWeight: 600 }}>{camId} - PLAYBACK</span>\r\n                <span style={{ fontSize: 11, color: '#555' }}>\r\n                    {segments.length} segmente | {new Date(timeRange.from).toLocaleTimeString()} - {new Date(timeRange.to).toLocaleTimeString()}\r\n                </span>\r\n            </div>\r\n\r\n            <div className=\"video-viewport\">\r\n                <video ref={videoRef} controls autoPlay muted playsInline />\r\n            </div>\r\n\r\n            <div className=\"controls\">\r\n                {!isPlaying ? (\r\n                    <button onClick={startPlayback} disabled={isLoading}>\r\n                        {isLoading ? \"Încărcare...\" : \"▶ REDĂ\"}\r\n                    </button>\r\n                ) : (\r\n                    <button onClick={stopPlayback}>■ OPRIRE</button>\r\n                )}\r\n                <div className=\"time-display\">{currentTime}</div>\r\n            </div>\r\n\r\n            <div className=\"timeline-area\">\r\n                <div className=\"segments-track\">\r\n                    {segments.map((seg, i) => (\r\n                        <div\r\n                            key={i}\r\n                            className=\"segment\"\r\n                            title={`Start: ${new Date(seg.start_ts).toLocaleTimeString()}`}\r\n                            style={{\r\n                                left: `${seg.s * 100}%`,\r\n                                // Force visible width (min 2px) for very short segments\r\n                                width: `max(${(seg.e - seg.s) * 100}%, 2px)`\r\n                            }}\r\n                        />\r\n                    ))}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}