{"ast":null,"code":"import _objectSpread from\"I:/dispecerat/github_release/dss-edge/local-ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState}from'react';import{API}from'../api';import{jsx as _jsx}from\"react/jsx-runtime\";export default function RecorderPlayer(_ref){let{camId,streamType,style}=_ref;const videoRef=useRef(null);const hlsRef=useRef(null);const[hlsUrl,setHlsUrl]=useState(null);// 1. Construct HLS URL for Live Delay\nuseEffect(()=>{let baseUrl=API.defaults.baseURL||'';// If baseURL is empty (relative), assume /api is proxied or root\nif(!baseUrl)baseUrl='/api';if(baseUrl.endsWith('/'))baseUrl=baseUrl.slice(0,-1);// This is the new endpoint: /playback/live/:camId.m3u8\nsetHlsUrl(\"\".concat(baseUrl,\"/playback/live/\").concat(camId,\".m3u8\"));},[camId]);// 2. Init Player\nuseEffect(()=>{if(!hlsUrl)return;const video=videoRef.current;const initHls=()=>{if(window.Hls&&window.Hls.isSupported()){if(hlsRef.current)hlsRef.current.destroy();const hls=new window.Hls({enableWorker:true,// STABILITY SETTINGS requested by USER\nlowLatencyMode:false,maxBufferLength:20,maxMaxBufferLength:40,backBufferLength:10// liveSyncDurationCount: 3, // Auto sync\n});hls.loadSource(hlsUrl);hls.attachMedia(video);hls.on(window.Hls.Events.MANIFEST_PARSED,()=>{video.play().catch(e=>console.warn(\"Autoplay block\",e));});hls.on(window.Hls.Events.ERROR,(event,data)=>{// console.warn(\"HLS Error\", data);\nif(data.fatal){switch(data.type){case window.Hls.ErrorTypes.NETWORK_ERROR:hls.startLoad();break;case window.Hls.ErrorTypes.MEDIA_ERROR:hls.recoverMediaError();break;default:hls.destroy();break;}}});hlsRef.current=hls;}else if(video.canPlayType('application/vnd.apple.mpegurl')){// Safari Native\nvideo.src=hlsUrl;video.addEventListener('loadedmetadata',()=>{video.play();});}};// Standard Hls.js loader check\nif(!window.Hls&&typeof Hls==='undefined'){const script=document.createElement('script');script.src=\"https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js\";script.onload=initHls;document.head.appendChild(script);}else{initHls();}return()=>{if(hlsRef.current)hlsRef.current.destroy();};},[hlsUrl]);return/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},style),{},{position:'relative',background:'#000',overflow:'hidden'}),children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,style:{width:'100%',height:'100%',objectFit:'contain'},autoPlay:true,muted:true,playsInline:true})});}","map":{"version":3,"names":["React","useEffect","useRef","useState","API","jsx","_jsx","RecorderPlayer","_ref","camId","streamType","style","videoRef","hlsRef","hlsUrl","setHlsUrl","baseUrl","defaults","baseURL","endsWith","slice","concat","video","current","initHls","window","Hls","isSupported","destroy","hls","enableWorker","lowLatencyMode","maxBufferLength","maxMaxBufferLength","backBufferLength","loadSource","attachMedia","on","Events","MANIFEST_PARSED","play","catch","e","console","warn","ERROR","event","data","fatal","type","ErrorTypes","NETWORK_ERROR","startLoad","MEDIA_ERROR","recoverMediaError","canPlayType","src","addEventListener","script","document","createElement","onload","head","appendChild","_objectSpread","position","background","overflow","children","ref","width","height","objectFit","autoPlay","muted","playsInline"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/components/RecorderPlayer.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { API } from '../api';\r\n\r\nexport default function RecorderPlayer({ camId, streamType, style }) {\r\n    const videoRef = useRef(null);\r\n    const hlsRef = useRef(null);\r\n    const [hlsUrl, setHlsUrl] = useState(null);\r\n\r\n    // 1. Construct HLS URL for Live Delay\r\n    useEffect(() => {\r\n        let baseUrl = API.defaults.baseURL || '';\r\n        // If baseURL is empty (relative), assume /api is proxied or root\r\n        if (!baseUrl) baseUrl = '/api';\r\n        if (baseUrl.endsWith('/')) baseUrl = baseUrl.slice(0, -1);\r\n\r\n        // This is the new endpoint: /playback/live/:camId.m3u8\r\n        setHlsUrl(`${baseUrl}/playback/live/${camId}.m3u8`);\r\n    }, [camId]);\r\n\r\n    // 2. Init Player\r\n    useEffect(() => {\r\n        if (!hlsUrl) return;\r\n\r\n        const video = videoRef.current;\r\n\r\n        const initHls = () => {\r\n            if (window.Hls && window.Hls.isSupported()) {\r\n                if (hlsRef.current) hlsRef.current.destroy();\r\n\r\n                const hls = new window.Hls({\r\n                    enableWorker: true,\r\n                    // STABILITY SETTINGS requested by USER\r\n                    lowLatencyMode: false,\r\n                    maxBufferLength: 20,\r\n                    maxMaxBufferLength: 40,\r\n                    backBufferLength: 10,\r\n                    // liveSyncDurationCount: 3, // Auto sync\r\n                });\r\n\r\n                hls.loadSource(hlsUrl);\r\n                hls.attachMedia(video);\r\n\r\n                hls.on(window.Hls.Events.MANIFEST_PARSED, () => {\r\n                    video.play().catch(e => console.warn(\"Autoplay block\", e));\r\n                });\r\n\r\n                hls.on(window.Hls.Events.ERROR, (event, data) => {\r\n                    // console.warn(\"HLS Error\", data);\r\n                    if (data.fatal) {\r\n                        switch (data.type) {\r\n                            case window.Hls.ErrorTypes.NETWORK_ERROR:\r\n                                hls.startLoad();\r\n                                break;\r\n                            case window.Hls.ErrorTypes.MEDIA_ERROR:\r\n                                hls.recoverMediaError();\r\n                                break;\r\n                            default:\r\n                                hls.destroy();\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                hlsRef.current = hls;\r\n            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {\r\n                // Safari Native\r\n                video.src = hlsUrl;\r\n                video.addEventListener('loadedmetadata', () => {\r\n                    video.play();\r\n                });\r\n            }\r\n        };\r\n\r\n        // Standard Hls.js loader check\r\n        if (!window.Hls && typeof Hls === 'undefined') {\r\n            const script = document.createElement('script');\r\n            script.src = \"https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js\";\r\n            script.onload = initHls;\r\n            document.head.appendChild(script);\r\n        } else {\r\n            initHls();\r\n        }\r\n\r\n        return () => {\r\n            if (hlsRef.current) hlsRef.current.destroy();\r\n        };\r\n    }, [hlsUrl]);\r\n\r\n    return (\r\n        <div style={{ ...style, position: 'relative', background: '#000', overflow: 'hidden' }}>\r\n            <video\r\n                ref={videoRef}\r\n                style={{ width: '100%', height: '100%', objectFit: 'contain' }}\r\n                autoPlay\r\n                muted\r\n                playsInline\r\n            />\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}