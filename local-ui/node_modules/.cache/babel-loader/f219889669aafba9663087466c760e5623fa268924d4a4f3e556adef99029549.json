{"ast":null,"code":"export const PlayerStates=Object.freeze({IDLE:\"IDLE\",LOADING:\"LOADING\",READY:\"READY\",PLAYING:\"PLAYING\",PAUSED:\"PAUSED\",BUFFERING:\"BUFFERING\",GAP:\"GAP\",ERROR:\"ERROR\"});export const PlayerEvents=Object.freeze({LOAD_LIVE:\"LOAD_LIVE\",LOAD_PLAYBACK:\"LOAD_PLAYBACK\",METADATA_READY:\"METADATA_READY\",VIDEO_TRACK_READY:\"VIDEO_TRACK_READY\",PLAY:\"PLAY\",PAUSE:\"PAUSE\",SEEK:\"SEEK\",BUFFER_EMPTY:\"BUFFER_EMPTY\",BUFFER_FULL:\"BUFFER_FULL\",GAP_DETECTED:\"GAP_DETECTED\",GAP_RESOLVED:\"GAP_RESOLVED\",END:\"END\",ERROR:\"ERROR\",RESET:\"RESET\"});export class PlayerStateMachine{constructor(_ref){let{onStateChange,onAction,logger=console}=_ref;this.state=PlayerStates.IDLE;this.onStateChange=onStateChange;this.onAction=onAction;this.log=logger;}transition(next,payload){if(this.log&&this.log.debug){this.log.debug(\"[PLAYER FSM] \".concat(this.state,\" -> \").concat(next),payload||\"\");}else{// Fallback if logger doesn't have debug\nconsole.log(\"[PLAYER FSM] \".concat(this.state,\" -> \").concat(next),payload||\"\");}this.state=next;if(this.onStateChange)this.onStateChange(next,payload);}dispatch(event){let payload=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this.log&&this.log.debug){this.log.debug(\"[PLAYER FSM EVENT] \".concat(event),payload);}switch(this.state){case PlayerStates.IDLE:if(event===PlayerEvents.LOAD_LIVE||event===PlayerEvents.LOAD_PLAYBACK){this.transition(PlayerStates.LOADING,payload);if(this.onAction)this.onAction(\"initStream\",payload);}break;case PlayerStates.LOADING:if(event===PlayerEvents.METADATA_READY){// metadata ok, but video not yet\nreturn;}if(event===PlayerEvents.VIDEO_TRACK_READY){this.transition(PlayerStates.READY);}if(event===PlayerEvents.ERROR){this.transition(PlayerStates.ERROR,payload);}break;case PlayerStates.READY:if(event===PlayerEvents.PLAY){this.transition(PlayerStates.PLAYING);if(this.onAction)this.onAction(\"play\");}if(event===PlayerEvents.SEEK){if(this.onAction)this.onAction(\"seek\",payload);}if(event===PlayerEvents.ERROR){this.transition(PlayerStates.ERROR,payload);}break;case PlayerStates.PLAYING:if(event===PlayerEvents.PAUSE){this.transition(PlayerStates.PAUSED);if(this.onAction)this.onAction(\"pause\");}if(event===PlayerEvents.BUFFER_EMPTY){this.transition(PlayerStates.BUFFERING);}if(event===PlayerEvents.GAP_DETECTED){this.transition(PlayerStates.GAP,payload);if(this.onAction)this.onAction(\"skipGap\",payload);}if(event===PlayerEvents.END){this.transition(PlayerStates.IDLE);}if(event===PlayerEvents.ERROR){this.transition(PlayerStates.ERROR,payload);}break;case PlayerStates.BUFFERING:if(event===PlayerEvents.BUFFER_FULL){this.transition(PlayerStates.PLAYING);}if(event===PlayerEvents.GAP_DETECTED){this.transition(PlayerStates.GAP,payload);}if(event===PlayerEvents.ERROR){this.transition(PlayerStates.ERROR,payload);}break;case PlayerStates.GAP:if(event===PlayerEvents.GAP_RESOLVED){this.transition(PlayerStates.BUFFERING);}if(event===PlayerEvents.END){this.transition(PlayerStates.IDLE);}break;case PlayerStates.PAUSED:if(event===PlayerEvents.PLAY){this.transition(PlayerStates.PLAYING);if(this.onAction)this.onAction(\"play\");}if(event===PlayerEvents.SEEK){if(this.onAction)this.onAction(\"seek\",payload);}break;case PlayerStates.ERROR:if(event===PlayerEvents.RESET){this.transition(PlayerStates.IDLE);}break;default:console.error(\"Unknown state\",this.state);}}}","map":{"version":3,"names":["PlayerStates","Object","freeze","IDLE","LOADING","READY","PLAYING","PAUSED","BUFFERING","GAP","ERROR","PlayerEvents","LOAD_LIVE","LOAD_PLAYBACK","METADATA_READY","VIDEO_TRACK_READY","PLAY","PAUSE","SEEK","BUFFER_EMPTY","BUFFER_FULL","GAP_DETECTED","GAP_RESOLVED","END","RESET","PlayerStateMachine","constructor","_ref","onStateChange","onAction","logger","console","state","log","transition","next","payload","debug","concat","dispatch","event","arguments","length","undefined","error"],"sources":["I:/dispecerat/github_release/dss-edge/local-ui/src/services/PlayerStateMachine.js"],"sourcesContent":["export const PlayerStates = Object.freeze({\r\n    IDLE: \"IDLE\",\r\n    LOADING: \"LOADING\",\r\n    READY: \"READY\",\r\n    PLAYING: \"PLAYING\",\r\n    PAUSED: \"PAUSED\",\r\n    BUFFERING: \"BUFFERING\",\r\n    GAP: \"GAP\",\r\n    ERROR: \"ERROR\"\r\n});\r\n\r\nexport const PlayerEvents = Object.freeze({\r\n    LOAD_LIVE: \"LOAD_LIVE\",\r\n    LOAD_PLAYBACK: \"LOAD_PLAYBACK\",\r\n    METADATA_READY: \"METADATA_READY\",\r\n    VIDEO_TRACK_READY: \"VIDEO_TRACK_READY\",\r\n    PLAY: \"PLAY\",\r\n    PAUSE: \"PAUSE\",\r\n    SEEK: \"SEEK\",\r\n    BUFFER_EMPTY: \"BUFFER_EMPTY\",\r\n    BUFFER_FULL: \"BUFFER_FULL\",\r\n    GAP_DETECTED: \"GAP_DETECTED\",\r\n    GAP_RESOLVED: \"GAP_RESOLVED\",\r\n    END: \"END\",\r\n    ERROR: \"ERROR\",\r\n    RESET: \"RESET\"\r\n});\r\n\r\nexport class PlayerStateMachine {\r\n    constructor({ onStateChange, onAction, logger = console }) {\r\n        this.state = PlayerStates.IDLE;\r\n        this.onStateChange = onStateChange;\r\n        this.onAction = onAction;\r\n        this.log = logger;\r\n    }\r\n\r\n    transition(next, payload) {\r\n        if (this.log && this.log.debug) {\r\n            this.log.debug(`[PLAYER FSM] ${this.state} -> ${next}`, payload || \"\");\r\n        } else {\r\n            // Fallback if logger doesn't have debug\r\n            console.log(`[PLAYER FSM] ${this.state} -> ${next}`, payload || \"\");\r\n        }\r\n        this.state = next;\r\n        if (this.onStateChange) this.onStateChange(next, payload);\r\n    }\r\n\r\n    dispatch(event, payload = {}) {\r\n        if (this.log && this.log.debug) {\r\n            this.log.debug(`[PLAYER FSM EVENT] ${event}`, payload);\r\n        }\r\n\r\n        switch (this.state) {\r\n            case PlayerStates.IDLE:\r\n                if (event === PlayerEvents.LOAD_LIVE || event === PlayerEvents.LOAD_PLAYBACK) {\r\n                    this.transition(PlayerStates.LOADING, payload);\r\n                    if (this.onAction) this.onAction(\"initStream\", payload);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.LOADING:\r\n                if (event === PlayerEvents.METADATA_READY) {\r\n                    // metadata ok, but video not yet\r\n                    return;\r\n                }\r\n                if (event === PlayerEvents.VIDEO_TRACK_READY) {\r\n                    this.transition(PlayerStates.READY);\r\n                }\r\n                if (event === PlayerEvents.ERROR) {\r\n                    this.transition(PlayerStates.ERROR, payload);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.READY:\r\n                if (event === PlayerEvents.PLAY) {\r\n                    this.transition(PlayerStates.PLAYING);\r\n                    if (this.onAction) this.onAction(\"play\");\r\n                }\r\n                if (event === PlayerEvents.SEEK) {\r\n                    if (this.onAction) this.onAction(\"seek\", payload);\r\n                }\r\n                if (event === PlayerEvents.ERROR) {\r\n                    this.transition(PlayerStates.ERROR, payload);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.PLAYING:\r\n                if (event === PlayerEvents.PAUSE) {\r\n                    this.transition(PlayerStates.PAUSED);\r\n                    if (this.onAction) this.onAction(\"pause\");\r\n                }\r\n                if (event === PlayerEvents.BUFFER_EMPTY) {\r\n                    this.transition(PlayerStates.BUFFERING);\r\n                }\r\n                if (event === PlayerEvents.GAP_DETECTED) {\r\n                    this.transition(PlayerStates.GAP, payload);\r\n                    if (this.onAction) this.onAction(\"skipGap\", payload);\r\n                }\r\n                if (event === PlayerEvents.END) {\r\n                    this.transition(PlayerStates.IDLE);\r\n                }\r\n                if (event === PlayerEvents.ERROR) {\r\n                    this.transition(PlayerStates.ERROR, payload);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.BUFFERING:\r\n                if (event === PlayerEvents.BUFFER_FULL) {\r\n                    this.transition(PlayerStates.PLAYING);\r\n                }\r\n                if (event === PlayerEvents.GAP_DETECTED) {\r\n                    this.transition(PlayerStates.GAP, payload);\r\n                }\r\n                if (event === PlayerEvents.ERROR) {\r\n                    this.transition(PlayerStates.ERROR, payload);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.GAP:\r\n                if (event === PlayerEvents.GAP_RESOLVED) {\r\n                    this.transition(PlayerStates.BUFFERING);\r\n                }\r\n                if (event === PlayerEvents.END) {\r\n                    this.transition(PlayerStates.IDLE);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.PAUSED:\r\n                if (event === PlayerEvents.PLAY) {\r\n                    this.transition(PlayerStates.PLAYING);\r\n                    if (this.onAction) this.onAction(\"play\");\r\n                }\r\n                if (event === PlayerEvents.SEEK) {\r\n                    if (this.onAction) this.onAction(\"seek\", payload);\r\n                }\r\n                break;\r\n\r\n            case PlayerStates.ERROR:\r\n                if (event === PlayerEvents.RESET) {\r\n                    this.transition(PlayerStates.IDLE);\r\n                }\r\n                break;\r\n\r\n            default:\r\n                console.error(\"Unknown state\", this.state);\r\n        }\r\n    }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}